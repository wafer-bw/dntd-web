!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(14),o=n(13),a=n(4);t.syncer=new a.Syncer,t.search=new a.Search,t.refines=new a.Refines,t.journal=new a.Journal,t.serviceWorker=new a.ServiceWorker;let u=document.getElementById("root");null!==u&&r.default.route(u,"/",{"/":o.app,"/signin":i.signinView,"/demo":o.app,"/about":o.about})},function(e,t){e.exports=m},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(22)),s(n(23)),s(n(24)),s(n(25)),s(n(26)),s(n(27))},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(9)),s(n(10)),s(n(11)),s(n(12))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(15);t.Tag=s.Tag;var r=n(33);t.Entry=r.Entry;var i=n(34);t.Sheet=i.Sheet;var o=n(35);t.Syncer=o.Syncer;var a=n(36);t.Search=a.Search;var u=n(37);t.Refines=u.Refines;var l=n(38);t.Journal=l.Journal;var d=n(39);t.Spreadsheet=d.Spreadsheet;var c=n(40);t.ServiceWorker=c.ServiceWorker},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(7)),s(n(8))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(18))},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.MockGapi=class{constructor(){this.auth2=new r}load(e,t){t()}};class r{getAuthInstance(){return new a}init(e){return s(this,void 0,void 0,(function*(){}))}}class i{get(){return new o}}class o{getAuthResponse(){return{expires_in:9999,access_token:"faketoken"}}reloadAuthResponse(){return s(this,void 0,void 0,(function*(){return{expires_in:9999,access_token:"faketoken"}}))}}t.MockGoogleUser=o;class a{constructor(){this.isSignedIn=new u,this.currentUser=new i}signOut(){}signIn(){}}class u{constructor(){this.listen=e=>{},this.get=()=>!0}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);t.SyncerTasksMock=class{constructor(e){this.testMode=e,this.extendSheetLength=100}getSheets(e,t){return s(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_GET_SPREADSHEET_SHEETS)throw new Error("mock fail");return[{properties:{sheetId:0,title:"Sheet1",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}},{properties:{sheetId:1,title:"Sheet2",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}}]}))}getRows(e,t){return s(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_GET_RANGE)throw new Error("mock fail");return this.testMode===r.TestMode.RETURN_ROWS?["aaa","bbb","ccc","@tag","@key:value"]:[]}))}updateRow(e,t){return s(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_UPDATE_RANGE)throw new Error("mock fail")}))}deleteRow(e,t){return s(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_DELETE_ROW)throw new Error("mock fail")}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE"}(t.SyncerTaskType||(t.SyncerTaskType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROWS=0]="ROWS",e[e.SHEETS=1]="SHEETS",e[e.SYNCER_STATE=2]="SYNCER_STATE",e[e.ERROR=3]="ERROR",e[e.REAUTH=4]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done"}(t.SyncerState||(t.SyncerState={}))},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(28)),s(n(29)),s(n(30)),s(n(31)),s(n(32)),s(n(41)),s(n(42)),s(n(43)),s(n(44)),s(n(45)),s(n(46))},function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(17)),s(n(19)),s(n(52))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2);t.Tag=class{constructor(e,t,n,s,r){this.frq=1,this.raw=e,this.flag=t,this.key=n,this.separator=void 0!==s?s:null,this.val=void 0!==r?r:null,this.clean=this.cleanTagString(this.raw),this.cleanKey=this.cleanTagString(this.key),this.cleanVal=null!==this.val?this.cleanTagString(this.val):null}renderKey(){return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+(this.separator?this.separator:"")+'\')" class="'+(this.separator?"tagKey":null===this.val?"simpleTag":"roundTagVal")+'">'+this.flag+this.key+"</span>"}renderVal(e){var t;return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+this.separator+(null===(t=this.cleanVal)||void 0===t?void 0:t.replace(/'/,"\\'"))+'\')" class="'+(e?"roundTagVal":"tagVal")+'">'+(e?"":this.separator)+(this.val||"")+"</span>"}render(e){return this.separator?e?this.renderVal(e):this.renderKey()+this.renderVal(e):this.renderKey()}cleanTagString(e){return e=(e=(e=s.escapeHtml(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}}},,function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(6),o=n(14);t.signinView=function(){return{view:function(){return r.default("#auth",[r.default(o.preambleComponent),r.default(o.googleComponent)])},onupdate:function(){i.googleModel.isSignedIn&&(window.location.hash="/")}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.googleModel=new class{constructor(e){this.isSignedIn=e,this.src="https://apis.google.com/js/api.js",this.scope=["https://www.googleapis.com/auth/spreadsheets"].join(" "),this.clientId="893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(6),o=n(20);t.googleComponent=function(){return{view:function(){return r.default("#googleApi",[i.googleModel.isSignedIn?r.default("button",{onclick:()=>o.googleController.signOut(),class:"authButton"},"Sign Out"):r.default("button",{onclick:()=>o.googleController.signIn(),class:"authButton"},"Sign In"),r.default("script",{async:!0,defer:!0,src:i.googleModel.src,onload:()=>{o.googleController.setGapi()}})])}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(21))},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(5),o=n(3),a=n(6),u=n(2);function l(e){a.googleModel.isSignedIn=e,r.default.redraw()}t.googleController={signIn:function(){a.googleModel.gapi_.auth2.getAuthInstance().signIn()},signOut:function(){a.googleModel.gapi_.auth2.getAuthInstance().signOut()},setGapi:function(){let e=u.getTestMode()===o.TestMode.OFF?gapi:new i.MockGapi;e.load("auth2",()=>{e.auth2.init({scope:a.googleModel.scope,client_id:a.googleModel.clientId}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(l),l(e.auth2.getAuthInstance().isSignedIn.get())})}),a.googleModel.gapi_=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.getHash=function(){return new URL(window.location.href).hash},t.getTestMode=function(){let e=new URL(window.location.href);if("#!demo"===e.hash)return s.TestMode.DEMO;let t=e.searchParams.get("test");return null!==t&&(n=t,Object.values(s.TestMode).includes(n))?t:s.TestMode.OFF;var n}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0);class o extends Error{constructor(e,t){super(e),this.friendlyMsg=t,i.journal.errors.push(t),console.warn(e),r.default.redraw()}}t.FriendlyError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCaretPosition=function(e){var t=window.getSelection(),n=[0,0];if(t.anchorNode==e)n=[t.anchorNode.innerText.length,t.extentNode.innerText.length];else{var s=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var r,i=[0,0];!function e(t,n){var s=n(t);for(t=t.firstChild;!1!==s&&t;t=t.nextSibling)s=e(t,n)}(e,(function(e){for(r=0;r<2;r++)if(e==s[r]&&(i[r]=1,i[0==r?1:0]))return;if(e.textContent&&!e.firstChild)for(r=0;r<2;r++)i[r]||(n[r]+=e.textContent.length)})),n[0]+=t.anchorOffset,n[1]+=t.extentOffset}return n[0]<=n[1]?n:[n[1],n[0]]},t.setCaretPosition=function e(t,n){if(null!==t&&null!==n){for(var s of t.childNodes)if(3==s.nodeType){if(s.length>=n){let e=document.createRange(),t=window.getSelection();return e.setStart(s,n),e.collapse(!0),t.removeAllRanges(),t.addRange(e),-1}n-=s.length}else if(-1==(n=e(s,n)))return-1;return n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagPattern=/(\@)([\w-']+)+(:)?([\w-'\*]+)?/g,t.spreadsheetIdPattern=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setStoredSpreadsheetId=function(e){localStorage.setItem("spreadsheetId",e)},t.getStoredSpreadsheetId=function(){return localStorage.getItem("spreadsheetId")||void 0},t.setStoredSpreadsheetUrls=function(e){localStorage.setItem("spreadsheetUrls",e)},t.getStoredSpreadsheetUrls=function(){return localStorage.getItem("spreadsheetUrls")||void 0},t.setStoredHideEntriesKeys=function(e){localStorage.setItem("hideEntriesKeys",e?"1":"0")},t.getStoredHideEntriesKeys=function(){return"1"===localStorage.getItem("hideEntriesKeys")},t.setStoredHideTagRefines=function(e){localStorage.setItem("hideTagRefines",e?"1":"0")},t.getStoredHideTagRefines=function(){return"1"===localStorage.getItem("hideTagRefines")},t.getStoredSpreadsheetSheetId=function(e){let t=localStorage.getItem(e+"-sheetId")||void 0;return void 0!==t?parseInt(t):void 0},t.setStoredSpreadsheetSheetId=function(e,t){localStorage.setItem(e+"-sheetId",t.toString())},t.delStoredSpreadsheetSheetId=function(e){localStorage.removeItem(e+"-sheetId")}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(2),a=n(13);t.app=function(){return{view:function(){let e=o.getHash();return["#!"===e||""===e?null:r.default(a.links),r.default(a.syncStateIndicator),r.default(a.googleAPI),r.default("#errorsWrap",r.default(a.errors)),i.journal.isActive?[r.default("#searchWrap",[r.default(a.searchbar),r.default(a.toggles)]),r.default(a.refinesPane),r.default("#entriesWrap",{class:i.journal.hideTagRefines?"fullWidth":""},[r.default(a.entries),r.default(a.compose)])]:[]]}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(3),a=n(2);t.links=function(){return{view:function(){let e=a.getHash(),t=[];return"#!about"!==e&&t.push(r.default("a",{href:"/#!about"},"About")),"#!demo"!==e&&t.push(r.default("a",{href:"/#!demo",onclick:()=>i.syncer.updateTestMode(o.TestMode.DEMO)},"Demo")),"#!"!==e&&""!==e&&t.push(r.default("a",{href:"/#!",onclick:()=>i.syncer.updateTestMode(o.TestMode.OFF)},"Start")),r.default("#navLinks",function(e){let t=[];for(let[n,s]of e.entries())t.push(s),n!==e.length-1&&t.push(" | ");return t}(t))}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(13);t.about=function(){return{view:function(){return r.default("#callToAction",[r.default(i.links),r.default("#about","About page will be filled when the visual overhaul is complete.")])}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0);t.errors=function(){function e(e){return{class:"dismissErrorButton",onclick:()=>i.journal.errors.splice(e,1)}}return{view:function(){return 0===i.journal.errors.length?[]:r.default("#errors",i.journal.errors.map((t,n)=>[r.default(".error",[r.default("span",t),r.default("button",e(n),"dismiss")])]))}}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(1)),o=n(0),a=n(4),u=n(2);t.compose=function(){var e={el:null,pos:null};const t=new a.Entry(""),n=new a.Entry(""),r=new a.Entry(""),l={placeholder:"Static Entry Prefix"},d={placeholder:"Entry Content"},c={placeholder:"Static Entry Suffix"};function h(t,r){let l={contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>s(this,void 0,void 0,(function*(){return yield function(e){return s(this,void 0,void 0,(function*(){if(13==e.keyCode&&!e.shiftKey){e.preventDefault();let t=[document.getElementById("prefix"),document.getElementById("content"),document.getElementById("suffix")].map(e=>e.innerText).join("");n.raw="";let s=new a.Entry(t,""),r=o.journal.spreadsheet.sheet.entries.length;o.journal.spreadsheet.sheet.entries.push(s),i.default.redraw(),yield o.journal.saveEntry(r)}}))}(e)})),oninput:n=>function(t,n){let s=u.getCaretPosition(t.target);e=s?{pos:s[1],el:t.target}:{pos:null,el:null},n.raw=t.target.innerText}(n,t),onupdate:()=>(u.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null}))};return Object.assign(l,r)}return{view:function(){return i.default("#compose",[i.default("#prefix",h(t,l),i.default.trust(t.rendered)),i.default("#content",h(n,d),i.default.trust(n.rendered)),i.default("#suffix",h(r,c),i.default.trust(r.rendered))])}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(15),r=n(2);t.Entry=class{constructor(e,t){this.tags=new Map,this.hovered=!1,this.focused=!1,this.clean="",this.tokens=[],this.rendered="",this.savedClean="",this.tagMatches=[],this.readableRendered="",this.rawText="",this.savedText="",this.raw=e||"",this.saved=void 0!==t?t:this.raw}get saved(){return this.savedText}set saved(e){this.savedText=e,this.savedClean=e.toLowerCase(),this.tags=this.getTags(this.tagMatches)}get raw(){return this.rawText}set raw(e){this.rawText=e,this.clean=this.raw.toLowerCase();let t=r.escapeHtml(this.rawText);this.tokens=this.getTokens(this.clean),this.tagMatches=this.getTagMatches(t),this.rendered=this.render(t,this.tagMatches),this.readableRendered=this.render(t,this.tagMatches,!0)}render(e,t,n){for(let{tag:s,match:r}of t){let t=e.split("");t.splice(r.index,r[0].length,s.render(n)),e=t.join("")}return e}getTags(e){let t=new Map;for(let{tag:n}of e)t.has(n.clean)?t.get(n.clean).frq+=1:t.set(n.clean,n);return t}getTagMatches(e){let t=[],n=e.matchAll(r.tagPattern);for(let e of n){let n=new s.Tag(e[0],e[1],e[2],e[3],e[4]);t.push({tag:n,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}getTokens(e){return e.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0);t.Sheet=class{constructor(e,t,n){this.entries=[],this.id=e,this.title=t,this.spreadsheet=n,n.sheets.set(this.id,this),i.syncer.getRows(this.spreadsheet.id,this.id,this.title)}load(e){return s(this,void 0,void 0,(function*(){e.map(e=>this.entries.push(new r.Entry(e))),i.journal.switch(),null!==i.journal.spreadsheet&&null!==i.journal.spreadsheet.sheet&&i.journal.spreadsheet.sheet.id===this.id&&i.refines.build()}))}get tags(){let e=new Map;for(let t of Array.from(this.entries.values()).reverse())for(let[n,s]of t.tags)e.has(n)?e.get(n).frq+=s.frq:e.set(n,new r.Tag(s.raw,s.flag,s.key,s.separator,s.val));return e}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(2),a=n(3);t.Syncer=class{constructor(){this.state=a.SyncerState.DOWNLOADING,this.user=null,this.worker=new Worker("./js/syncWebWorker.js"),this.updateTestMode(o.getTestMode()),this.worker.onmessage=e=>this.onMessage(e)}updateTestMode(e){this.pushSyncerTask({testMode:e,type:a.SyncerTaskType.TEST_MODE_UPDATE})}updateAuth(e){this.pushSyncerTask({token:e,type:a.SyncerTaskType.AUTH_UPDATE})}getSheets(e){this.pushSyncerTask({spreadsheetId:e,type:a.SyncerTaskType.GET_SHEETS})}getRows(e,t,n){this.pushSyncerTask({spreadsheetId:e,sheetId:t,sheetTitle:n,type:a.SyncerTaskType.GET_ROWS})}deleteRow(e,t,n){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:n,type:a.SyncerTaskType.DELETE_ROW})}updateRow(e,t,n,s,r){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:n,sheetTitle:s,content:r,type:a.SyncerTaskType.UPDATE_ROW})}unpause(){this.pushSyncerTask({type:a.SyncerTaskType.UNPAUSE})}pushSyncerTask(e){this.worker.postMessage(e)}onMessage(e){let t=e.data;switch(t.type){case a.SyncerResponseType.SYNCER_STATE:t.state!==i.syncer.state&&(i.syncer.state=t.state,r.default.redraw());break;case a.SyncerResponseType.SHEETS:i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).load(t.sheets);break;case a.SyncerResponseType.ROWS:i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.has(t.sheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.get(t.sheetId).load(t.rows);break;case a.SyncerResponseType.ERROR:new o.FriendlyError(t.error.message,"Sync Error - "+t.friendlyMsg);break;case a.SyncerResponseType.REAUTH:null!==i.syncer.user&&i.syncer.user.reloadAuthResponse().then(e=>{i.syncer.updateAuth(e.access_token)}).catch(e=>{new o.FriendlyError(e,"You're signed out and need to sign back in.")})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),r=n(4),i=n(3);t.Search=class{constructor(){this.barQuery=new r.Entry(""),this.searchType=i.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}get query(){return new r.Entry([this.barQuery.raw,...Array.from(this.refinesQuery.keys.values()),...Array.from(this.refinesQuery.vals.keys()),...Array.from(this.refinesQuery.simpleKeys.keys())].join(" "))}reset(){this.barQuery=new r.Entry(""),this.searchType=i.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}entries(){let e=null;return 0===this.query.tokens.length?this.searchType=i.SearchType.NONE:(this.searchType=i.SearchType.AND,e=this.search(),0===e.length&&(this.searchType=i.SearchType.OR,e=this.search())),e}search(){let e=this.query,t=[],n=s.journal.spreadsheet.sheet.entries;for(let[s,r]of n.entries())switch(this.searchType){case i.SearchType.AND:e.tokens.every(e=>this.match(e,r))&&t.push({idx:s,entry:r});break;case i.SearchType.OR:e.tokens.some(e=>this.match(e,r))&&t.push({idx:s,entry:r})}return t}match(e,t){return e.startsWith("-@")&&!e.endsWith(":")?void 0===t.tags.get(e.substring(1)):e.startsWith("-")?!t.savedClean.includes(e.substring(1)):e.startsWith("@")&&!e.endsWith(":")?void 0!==t.tags.get(e):t.savedClean.includes(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0);t.Refines=class{constructor(){this.simple=new Map,this.complex=new Map}build(){let e=new Map,t=new Map;for(let n of s.journal.spreadsheet.sheet.tags.values())if(null===n.val){let t=`${n.flag}${n.cleanKey}`;e.has(t)||e.set(t,n)}else{let e=`${n.flag}${n.cleanKey}${n.separator}`;t.has(e)||t.set(e,[]),t.get(e).push(n)}this.simple=new Map([...e.entries()]),this.complex=new Map([...t.entries()].sort()),this.cleanRefines()}cleanRefines(){for(let[e]of s.search.refinesQuery.simpleKeys)this.simple.has(e)||s.search.refinesQuery.simpleKeys.delete(e);for(let e of s.search.refinesQuery.keys)this.complex.has(e)||s.search.refinesQuery.keys.delete(e);for(let[e]of s.search.refinesQuery.vals)Array.from(this.complex.values()).some(t=>t.some(t=>t.clean===e))||s.search.refinesQuery.vals.delete(e)}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(1)),o=n(4),a=n(0),u=n(2);t.Journal=class{constructor(){this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}load(e){return s(this,void 0,void 0,(function*(){this.hideTagRefines=u.getStoredHideTagRefines(),this.hideEntriesKeys=u.getStoredHideEntriesKeys();let t=this.getSpreadsheetIdsFromUrls(e);yield this.loadNewSpreadsheets(t),yield this.removeOldSpreadsheets(t)}))}unload(){this.removeOldSpreadsheets([]),this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}get isActive(){return null!==this.spreadsheet&&null!==this.spreadsheet.sheet&&this.isSignedIn}switch(e,t){var n,s,r;void 0!==e&&void 0!==t&&(null===(n=this.spreadsheet)||void 0===n?void 0:n.id)===e&&(null===(r=null===(s=this.spreadsheet)||void 0===s?void 0:s.sheet)||void 0===r?void 0:r.id)===t||(void 0===e&&void 0===t&&(e=u.getStoredSpreadsheetId(),t=u.getStoredSpreadsheetSheetId(e)),a.search.reset(),this.spreadsheet=void 0!==e&&this.spreadsheets.has(e)?this.spreadsheets.get(e):Array.from(this.spreadsheets.values())[0]||null,null!==this.spreadsheet&&(u.setStoredSpreadsheetId(this.spreadsheet.id),this.spreadsheet.sheet=void 0!==t&&this.spreadsheet.sheets.has(t)?this.spreadsheet.sheets.get(t):Array.from(this.spreadsheet.sheets.values())[0]||null,null!==this.spreadsheet.sheet&&u.setStoredSpreadsheetSheetId(this.spreadsheet.id,this.spreadsheet.sheet.id)),a.refines.build(),i.default.redraw())}loadNewSpreadsheets(e){return s(this,void 0,void 0,(function*(){for(let t of e.filter(e=>!this.spreadsheets.get(e)).sort(e=>e===u.getStoredSpreadsheetId()?-1:1))new o.Spreadsheet(t)}))}removeOldSpreadsheets(e){return s(this,void 0,void 0,(function*(){for(let[t]of Array.from(this.spreadsheets).filter(([t])=>!e.includes(t)))if(u.delStoredSpreadsheetSheetId(t),this.spreadsheet===this.spreadsheets.get(t)&&(this.spreadsheet=null),this.spreadsheets.has(t)){for(let[e]of this.spreadsheets.get(t).sheets)this.spreadsheets.get(t).sheets.delete(e);this.spreadsheets.delete(t)}}))}getSpreadsheetIdsFromUrls(e){if(!e)return[];let t=[],n=e.matchAll(u.spreadsheetIdPattern);for(let e of n)e&&t.push(e[1]);return t}deleteEntry(e){return s(this,void 0,void 0,(function*(){a.syncer.deleteRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id),this.spreadsheet.sheet.entries.splice(e,1)[0],a.refines.build(),i.default.redraw()}))}saveEntry(e){return s(this,void 0,void 0,(function*(){let t=this.spreadsheet.sheet.entries[e];t.raw!==t.saved&&(a.syncer.updateRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id,this.spreadsheet.sheet.title,t.raw),t.saved=t.raw,a.refines.build(),i.default.redraw())}))}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),i=n(0),o=n(2);t.Spreadsheet=class{constructor(e){this.id=e,this.sheet=null,this.sheets=new Map,i.journal.spreadsheets.set(e,this),i.syncer.getSheets(e)}load(e){return s(this,void 0,void 0,(function*(){for(let t of e.sort(e=>{var t;return(null===(t=e.properties)||void 0===t?void 0:t.sheetId)===o.getStoredSpreadsheetSheetId(this.id)?-1:1}))void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.properties.sheetId&&new r.Sheet(t.properties.sheetId,t.properties.title,this)}))}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.ServiceWorker=class{constructor(){if(!("serviceWorker"in navigator))throw new r.FriendlyError("serviceWorker not supported","Your browser is not supported.");window.addEventListener("load",()=>s(this,void 0,void 0,(function*(){yield navigator.serviceWorker.register("../serviceWorker.js")})))}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(1)),o=n(0),a=n(2);t.entries=function(){var e={pos:null,el:null};function t(){let e=o.search.entries();return null!==e?e.map(({idx:e,entry:t})=>n(e,t)):Array.from(o.journal.spreadsheet.sheet.entries.entries()).map(([e,t])=>n(e,t))}function n(e,t){return i.default(".entryWrap",{id:"entry-"+e},[u(t,e),r(e)])}function r(e){return i.default("button",{class:"del",onclick:()=>s(this,void 0,void 0,(function*(){return yield o.journal.deleteEntry(e)}))},"del")}function u(t,n){return i.default("div",function(t,n){return{id:`entry-${n}-content`,contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>function(e){e.redraw=!1,13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e),oninput:n=>function(t,n){let s=a.getCaretPosition(t.target);e={pos:s?s[1]:null,el:t.target},n.raw=t.target.innerText}(n,t),onupdate:t=>function(t){t.redraw=!1,a.setCaretPosition(e.el,e.pos),e={pos:null,el:null}}(t),onblur:e=>function(e,t,n){return s(this,void 0,void 0,(function*(){e.redraw=!1,t.focused=!1,yield o.journal.saveEntry(n)}))}(e,t,n),onmouseover:e=>function(e,t){o.journal.hideEntriesKeys||(e.redraw=!1);t.hovered=!0}(e,t),onmouseout:e=>function(e,t){o.journal.hideEntriesKeys||(e.redraw=!1);t.hovered=!1}(e,t),onfocus:e=>function(e,t){e.redraw=!1,t.focused=!0}(e,t)}}(t,n),i.default.trust(t.hovered||t.focused||!o.journal.hideEntriesKeys?t.rendered:t.readableRendered))}return{view:function(){return i.default("#entries",[i.default(".tempguidancePre","Entries"),t()])}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(2);t.toggles=function(){return{view:function(){return[r.default("#hideEntriesKeysToggle",[r.default("label",{for:"hideEntriesCheckbox"},"Tag keys:"),r.default("input#hideEntriesCheckbox",{type:"checkbox",checked:!o.getStoredHideEntriesKeys(),disabled:i.journal.entryInFocus,onclick:()=>{i.journal.hideEntriesKeys=!i.journal.hideEntriesKeys,o.setStoredHideEntriesKeys(i.journal.hideEntriesKeys)}})]),r.default("#hideTagRefinesToggle",[r.default("label",{for:"hideTagRefinesCheckbox"},"Tag refines:"),r.default("input#hideTagRefinesCheckbox",{type:"checkbox",checked:!i.journal.hideTagRefines,onclick:()=>{i.journal.hideTagRefines=!i.journal.hideTagRefines,o.setStoredHideTagRefines(i.journal.hideTagRefines)}})])]}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(2);t.searchbar=function(){var e={el:null,pos:null};return{view:function(){return r.default("#search",[r.default("#searchQuery",{placeholder:"Search for text or tags",contenteditable:"true",class:"entry breakwrap",oninput:t=>function(t){let n=o.getCaretPosition(t.target);e=n?{pos:n[1],el:t.target}:{pos:null,el:null},i.search.barQuery.raw=o.escapeHtml(t.target.innerText)}(t),onupdate:()=>(o.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null})),onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e)},r.default.trust(i.search.barQuery.rendered)),r.default("button",{id:"clearSearch",class:"del",onclick:()=>i.search.barQuery.raw=""},"x")])}}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(r,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(1)),o=n(5),a=n(3),u=n(0),l=n(2),d=["https://www.googleapis.com/auth/spreadsheets"].join(" ");t.googleAPI=function(){var e;function t(){e.auth2.init({scope:d,client_id:"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(n),n(e.auth2.getAuthInstance().isSignedIn.get())})}function n(t){return s(this,void 0,void 0,(function*(){if(u.journal.isSignedIn=t,i.default.redraw(),u.journal.isSignedIn){let t=e.auth2.getAuthInstance().currentUser.get();u.syncer.user=t;let n=t.getAuthResponse();u.syncer.updateAuth(n.access_token),yield function(){return s(this,void 0,void 0,(function*(){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}))}()}else u.journal.unload()}))}function r(){return i.default("button",{id:"addSpreadsheet",onclick:()=>s(this,void 0,void 0,(function*(){if(u.journal.showAddSpreadsheetTextbox=!u.journal.showAddSpreadsheetTextbox,!u.journal.showAddSpreadsheetTextbox){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}}))},u.journal.showAddSpreadsheetTextbox?" ✓ ":"+/-")}return{view:function(){return l.getTestMode()===a.TestMode.DEMO?(u.journal.isSignedIn=!0,u.journal.load("https://docs.google.com/spreadsheets/d/demo/edit"),[]):i.default("#googleApi",[u.journal.showAddSpreadsheetTextbox?[i.default("textarea",{id:"spreadsheetURLs",placeholder:"Enter list of Google Sheets Spreadsheet URLs here",value:l.getStoredSpreadsheetUrls(),oninput:e=>l.setStoredSpreadsheetUrls(e.target.value)}),i.default("br")]:[],u.journal.isSignedIn?r():[],null!==u.journal.spreadsheet?i.default("select",{onchange:e=>{let t=e.target.value;u.journal.switch(t,l.getStoredSpreadsheetSheetId(t))},id:"spreadsheetSelect"},[Array.from(u.journal.spreadsheets).map(([e])=>[i.default("option",{value:e,selected:u.journal.spreadsheet.id===e},e.substr(e.length-6))])]):[],u.journal.isActive?i.default("select",{onchange:e=>{u.journal.switch(u.journal.spreadsheet.id,parseInt(e.target.value)),i.default.redraw()},id:"sheetSelect"},[Array.from(u.journal.spreadsheet.sheets).map(([e,t])=>[i.default("option",{value:e,selected:u.journal.isActive&&u.journal.spreadsheet.sheet.id===e},t.title)])]):[],u.journal.isSignedIn?i.default("button",{onclick:()=>{l.getTestMode()===a.TestMode.RETURN_ROWS&&u.journal.unload(),e.auth2.getAuthInstance().signOut()},class:"authButton"},"Sign Out"):i.default("button",{onclick:()=>e.auth2.getAuthInstance().signIn(),class:"authButton"},"Sign In"),i.default("script",{async:!0,defer:!0,src:"https://apis.google.com/js/api.js",onload:()=>{(e=l.getTestMode()===a.TestMode.OFF?gapi:new o.MockGapi).load("auth2",t)}})])}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0);t.refinesPane=function(){const e=new Set;function t(t,n){return r.default("span",function(t){return{class:"roundTagKey",onclick:n=>function(t,n){if(t.metaKey||t.ctrlKey){if("Simple Tags"===n)return;i.search.refinesQuery.keys.has(n)?i.search.refinesQuery.keys.delete(n):i.search.refinesQuery.keys.add(n)}else e.has(n)?e.delete(n):e.add(n)}(n,t)}}(t),["Simple Tags"===t?[]:r.default("input",{type:"checkbox",checked:i.search.refinesQuery.keys.has(t)}),e.has(t)?r.default("span","▾ "):r.default("span","▿ "),r.default("span",t),r.default("span",` (${n})`)])}function n(e,t){return r.default("div",{class:"tagRefineValWrap"},[r.default("span",s(e,t),[r.default("input",{type:"checkbox",checked:null===t.val?i.search.refinesQuery.simpleKeys.has(t.clean):i.search.refinesQuery.vals.has(t.clean)}),null!==t.val?r.default("span",""+t.cleanVal):r.default("span",`${t.flag}${t.cleanKey}`),r.default("span",` (${t.frq})`)])])}function s(t,n){let s=null===n.val?"simpleTag":"roundTagVal",r="hide";return(null===n.val&&e.has("Simple Tags")||e.has(t)||i.search.refinesQuery.vals.has(n.clean))&&(r=""),{class:`${s} ${r}`,onclick:()=>function(e){null===e.val?i.search.refinesQuery.simpleKeys.has(e.clean)?i.search.refinesQuery.simpleKeys.delete(e.clean):i.search.refinesQuery.simpleKeys.set(e.clean,e):i.search.refinesQuery.vals.has(e.clean)?i.search.refinesQuery.vals.delete(e.clean):i.search.refinesQuery.vals.set(e.clean,e)}(n)}}return{view:function(){return i.journal.hideTagRefines?[]:r.default("#tagsWrap",r.default("#tags",[r.default(".tempguidancePre","Tags"),r.default(".tagRefineWrap",0===i.refines.simple.size?[]:[t("Simple Tags",i.refines.simple.size),Array.from(i.refines.simple,([e,t])=>[n(e,t)])]),Array.from(i.refines.complex,([e,s])=>r.default(".tagRefineWrap",[t(e,s.length),s.map(t=>[n(e,t)])]))]))}}}},function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(0),o=n(3);t.syncStateIndicator=function(){function e(){let e="",t="syncState "+s();switch(i.syncer.state){case o.SyncerState.DOWNLOADING:e="Downloading journal data from drive...";break;case o.SyncerState.PAUSED:e="Warning! - Syncing is paused.";break;case o.SyncerState.SYNCED:e="All changes saved.";break;case o.SyncerState.UPLOADING:e="Uploading changes to drive..."}return r.default("span",{id:"syncStateText",class:t},e)}function t(){let e="material-icons material-icons-outlined syncState "+s();return r.default("i",{id:"syncStateIcon",class:e},i.syncer.state)}function n(){if(i.syncer.state===o.SyncerState.PAUSED)return r.default("button",{id:"unpauseSync",class:"syncState",onclick:()=>i.syncer.unpause()},"Unpause Syncing")}function s(){switch(i.syncer.state){case o.SyncerState.PAUSED:return"error";case o.SyncerState.SYNCED:return"okay";default:return"warn"}}return{view:function(){return r.default("#status",r.default("span",function(){if(0===i.journal.spreadsheets.size)return;return r.default("span",[t(),e(),n()])}()))}}}},,,,,,function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=s(n(1)),i=n(6);t.preambleComponent=function(){return{view:function(){return i.googleModel.isSignedIn?null:r.default(".preamble","PREAMBLE MSG")}}}}]);
//# sourceMappingURL=dntd.js.map