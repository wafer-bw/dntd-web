!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=m},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(11)),r(n(12)),r(n(13)),r(n(14))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(10)),r(n(23)),r(n(15)),r(n(37)),r(n(38)),r(n(39)),r(n(42)),r(n(43)),r(n(17))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(20),s=n(8);t.serviceWorkerModel=new s.ServiceWorkerModel,t.googleModel=new s.GoogleModel,t.syncerModel=new s.SyncerModel,t.libraryModel=new s.LibraryModel,t.urlModel=new s.UrlModel,t.searchModel=new s.SearchModel;const i=document.getElementById("root");null!==i&&o.default.route(i,"/",{"/":l.signinView,"/signin":l.signinView,"/library":l.libraryView,"/library/:shelfId":l.shelfView,"/library/:shelfId/:journalId":l.journalView})},,function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(24)),r(n(35)),r(n(36))},,function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(22)),r(n(44)),r(n(45)),r(n(46)),r(n(47)),r(n(48)),r(n(49)),r(n(50)),r(n(51)),r(n(52))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(25)),r(n(26)),r(n(27)),r(n(28)),r(n(29)),r(n(16)),r(n(30)),r(n(16)),r(n(31)),r(n(32)),r(n(33))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(34))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3);function s(){let e=l.urlModel.shelfId;if(void 0!==e)return l.libraryModel.shelves.get(e)}t.urlController={redirect:function(e){l.urlModel.hash=e},getActiveShelf:s,getActiveJournal:function(){let e=l.urlModel.journalId,t=s();return void 0===e||void 0===t?void 0:t.journals.get(e)},getBreadcrumbTrail:function(){var e,t,n;let r=[],s=l.urlModel.hash.split("?")[0].split("/").filter(e=>"#"!==e&&""!==e),i=void 0;for(let a=0;a<s.length;a++){let u=s[a],c="#/"+s.slice(0,a+1).join("/");1===a?(i=u,u=(null===(e=l.libraryModel.shelves.get(u))||void 0===e?void 0:e.title)||u):2===a&&void 0!==i&&(u=(null===(n=null===(t=l.libraryModel.shelves.get(i))||void 0===t?void 0:t.journals.get(parseInt(u)))||void 0===n?void 0:n.title)||u),0!==a&&r.push(o.default("span"," / ")),a===s.length-1?r.push(o.default("span",""+u)):r.push(o.default("a",{href:c},""+u))}return r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);class o extends Error{constructor(e,t,n,o){super(e),this.friendlyMsg=t,this.needsReAuth=n,this.payload={pause:void 0===o||o,error:this,friendlyMsg:this.friendlyMsg,type:r.SyncerPayloadType.ERROR}}}t.SyncerError=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE",e[e.GET_SPREADSHEET=7]="GET_SPREADSHEET",e[e.EXTEND_SHEET=8]="EXTEND_SHEET",e[e.CREATE_ROW=9]="CREATE_ROW",e[e.MOVE_ROW=10]="MOVE_ROW",e[e.ERROR=11]="ERROR",e[e.TOKEN_REQUEST=12]="TOKEN_REQUEST",e[e.SYNC_STATE=13]="SYNC_STATE"}(t.SyncerPayloadType||(t.SyncerPayloadType={})),function(e){e[e.SYNCER_STATE=0]="SYNCER_STATE",e[e.ERROR=1]="ERROR",e[e.REAUTH=2]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done",e.INITIALIZING="cloud_queue"}(t.SyncerState||(t.SyncerState={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),o=n(2),l=/(\@)([\w-']+)+(:)?([\w-'\*]+)?/g;t.entryController={save:function(e,t,n,r,l){(e.saved!==n||l)&&(e.saved=n,e.savedClean=o.textController.clean(e.saved),e.tags=function(e){let t=new Map;for(let{tag:n}of e)t.has(n.clean)?t.get(n.clean).frq+=1:t.set(n.clean,n);return t}(e.tagMatches),r&&o.syncerController.updateRow(e.shelf.id,e.journal.id,e.journal.title,t,n))},update:function(e,t){e.raw=t,e.clean=o.textController.clean(t),e.safe=o.textController.escape(e.raw),e.tokens=(n=e.clean,n.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)),e.tagMatches=function(e){let t=[],n=e.matchAll(l);for(let e of n){let n=r.tagFactory.createTag(e[0],e[1],e[2],e[3],e[4]);t.push({tag:n,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}(e.safe),e.rendered=function(e,t){for(let{tag:n,match:r}of t){let t=e.split("");t.splice(r.index,r[0].length,n.rendered),e=t.join("")}return e}(e.safe,e.tagMatches);var n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),o=n(5);t.SearchModel=class{constructor(){this.searchType=r.SearchType.NONE,this.simpleRefines=new Map,this.complexRefines=new Map,this.barQuery=o.entryFactory.createBaseEntry(),this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}get query(){return o.entryFactory.createBaseEntry([this.barQuery.raw,...Array.from(this.refinesQuery.keys.values()),...Array.from(this.refinesQuery.vals.keys()),...Array.from(this.refinesQuery.simpleKeys.keys())].join(" "))}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(9),i=n(5),a=n(2);function u(e,t,n,r){n=void 0===n?"":n;let o=i.entryFactory.createJournalEntry(e.shelf,e,n);a.entryController.save(o,t,n,r),e.addEntry(t,o),c(e)}function c(e){let t=new Map,n=Array.from(e.entries.values());for(let{entry:e}of n.reverse())for(let[n,r]of e.tags)t.has(n)?t.get(n).frq+=r.frq:t.set(n,i.tagFactory.createTag(r.raw,r.flag,r.key,r.separator,r.val));e.tags=t,a.searchController.buildRefines(e)}t.journalController={addEntry:u,moveEntry:function(e,t,n){if(t===n)return;e.moveEntry(t,n),c(e)},buildTags:c,deleteEntry:function(e,t){e.deleteEntry(t),c(e)},loadEntries:function(e){if(void 0===e)return;t=e,l.libraryModel.shelves.forEach(e=>{void 0!==e&&e.journals.forEach(e=>{t.shelf.id===e.shelf.id&&t.id===e.id||function(e){void 0!==e&&(e.entries=[],e.loaded=!1)}(e)})}),a.syncerController.getRows(e.shelf.id,e.id,e.title).then(t=>{t.rows.forEach((t,n)=>u(e,n,t,!1)),e.loaded=!0}).catch(e=>{new s.FriendlyError(e.error.message,e.friendlyMsg)}).finally(()=>{o.default.redraw()});var t}}},,,function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(21)),r(n(53)),r(n(54)),r(n(55))},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(7);t.shelfView=function(){return{view:function(){return o.default("#shelf",[o.default(l.googleComponent),o.default(l.syncStateComponent),o.default(l.breadcrumbComponent),o.default(l.journalsComponent)])}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(2);t.googleComponent=function(){return{view:function(){return o.default("#googleApi",[void 0===l.googleModel.isSignedIn||l.googleModel.isSignedIn?null:o.default(".preamble","PREAMBLE MSG"),l.googleModel.isSignedIn?o.default("button",{onclick:()=>s.googleController.signOut(),class:"authButton"},"Sign Out"):o.default("button",{onclick:()=>s.googleController.signIn(),class:"authButton"},"Sign In"),o.default("script",{async:!0,defer:!0,src:l.googleModel.src,onload:()=>{l.googleModel.isSignedIn||s.googleController.initGapi()}})])}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.textController={escape:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},clean:function(e){return e.toLowerCase()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(8);function l(e){return e=(e=(e=r.textController.escape(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}t.tagFactory={createTag:function(e,t,n,r,s){r=void 0!==r?r:null,s=void 0!==s?s:null;let i=l(e),a=l(n),u=null!==s?l(s):null,c="<span onclick=\"tagOnClick(event, '"+t+a+(null!==r?r:"")+'\')" class="'+(null!==r?"tagKey":null===s?"simpleTag":"roundTagVal")+'">'+t+n+"</span>",d="";null!=r&&(d="<span onclick=\"tagOnClick(event, '"+t+a+r+(null!==u?u.replace(/'/,"\\'"):"")+'\')" class="tagVal">'+r+(null!==s?s:"")+"</span>");return new o.TagModel(e,t,n,r,s,i,a,u,c+d)}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(1);t.UrlModel=class{get hash(){return window.location.hash}set hash(e){window.location.hash=e}get url(){return new URL(window.location.href)}get testMode(){if("#!demo"===this.hash)return l.TestMode.DEMO;let e=this.url.searchParams.get("test");return null!==e&&this.instanceOfTestMode(e)?e:l.TestMode.OFF}instanceOfTestMode(e){return Object.values(l.TestMode).includes(e)}get shelfId(){let e=o.default.route.param("shelfId");return""===e?void 0:e}get journalId(){let e=o.default.route.param("journalId");return""===e?void 0:parseInt(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TagModel=class{constructor(e,t,n,r,o,l,s,i,a){this.raw=e,this.flag=t,this.key=n,this.separator=r,this.val=o,this.clean=l,this.cleanKey=s,this.cleanVal=i,this.rendered=a,this.frq=1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.raw="",this.safe="",this.clean="",this.tokens=[],this.rendered="",this.tags=new Map,this.tagMatches=[]}}t.BaseEntryModel=r;t.JournalEntryModel=class extends r{constructor(e,t,n){super(),this.saved="",this.savedClean="",this.id=n,this.shelf=e,this.journal=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShelfModel=class{constructor(e,t,n){this.journals=new Map,this.id=e,this.error=n,this.title=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.SyncerModel=class{constructor(){this.requestsCounter=0,this.requests=new Map,this.state=r.SyncerState.INITIALIZING}pushSyncerTask(e,t){let n="payload-"+this.requestsCounter++;return new Promise((r,o)=>{this.requests.set(n,({payload:e,error:t})=>{t?o(t):r(e)}),t.postMessage({id:n,payload:e})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.GoogleModel=class{constructor(e){this.isSignedIn=e,this.src="https://apis.google.com/js/api.js",this.scope=["https://www.googleapis.com/auth/spreadsheets"].join(" "),this.clientId="893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}get token(){if(!this.user)return;return this.user.getAuthResponse().access_token}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.JournalModel=class{constructor(e,t,n){this.entries=[],this.shelf=e,this.loaded=!1,this.id=t,this.tags=new Map,this.title=n}addEntry(e,t){this.entries.splice(e,0,{id:t.id,entry:t})}updateEntry(e,t){this.entries[e].entry=t}deleteEntry(e){this.entries.splice(e,1)[0]}moveEntry(e,t){let n=this.entries.splice(e,1)[0];this.entries.splice(t,0,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LibraryModel=class{constructor(){this.shelves=new Map,this.shelfIds.forEach(e=>this.shelves.set(e,void 0))}set shelfIds(e){0===e.length?localStorage.removeItem("spreadsheetIds"):localStorage.setItem("spreadsheetIds",e.join(","))}get shelfIds(){let e=localStorage.getItem("spreadsheetIds");return null===e?[]:e.split(",")}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(9);t.ServiceWorkerModel=class{constructor(){if(!("serviceWorker"in navigator))throw new o.FriendlyError("serviceWorker not supported","Your browser is not supported.");window.addEventListener("load",()=>r(this,void 0,void 0,(function*(){yield navigator.serviceWorker.register("../serviceWorker.js")})))}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0));class l extends Error{constructor(e,t){super(e),this.friendlyMsg=t,console.warn(e),o.default.redraw()}}t.FriendlyError=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);t.shelfFactory={createShelf:function(e,t,n){if(void 0!==t&&void 0!==t.spreadsheetId&&void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.sheets){let e=new r.ShelfModel(t.spreadsheetId,t.properties.title);return function(e,t){let n=[];return t.forEach(t=>{if(void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.properties.sheetId){let o=new r.JournalModel(e,t.properties.sheetId,t.properties.title);if(void 0===o)return;n.push(o)}}),n}(e,t.sheets).forEach(t=>e.journals.set(t.id,t)),e}return new r.ShelfModel(e,void 0,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),o=n(8);let l=-1;t.entryFactory={createBaseEntry:function(e){let t=new o.BaseEntryModel;return r.entryController.update(t,e||""),t},createJournalEntry:function(e,t,n){let s=new o.JournalEntryModel(e,t,l+=1);return r.entryController.update(s,n),s}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.caretController={getCaretPosition:function(e){var t=window.getSelection(),n=[0,0];if(t.anchorNode==e)n=[t.anchorNode.innerText.length,t.extentNode.innerText.length];else{var r=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var o,l=[0,0];!function e(t,n){var r=n(t);for(t=t.firstChild;!1!==r&&t;t=t.nextSibling)r=e(t,n);return}(e,(function(e){for(o=0;o<2;o++)if(e==r[o]&&(l[o]=1,l[0==o?1:0]))return;if(e.textContent&&!e.firstChild)for(o=0;o<2;o++)l[o]||(n[o]+=e.textContent.length)})),n[0]+=t.anchorOffset,n[1]+=t.extentOffset}if(n[0]<=n[1])return n;return[n[1],n[0]]},setCaretPosition:function e(t,n){if(null!==t&&null!==n){for(var r of t.childNodes)if(3==r.nodeType){if(r.length>=n){let e=document.createRange(),t=window.getSelection();return e.setStart(r,n),e.collapse(!0),t.removeAllRanges(),t.addRange(e),-1}n-=r.length}else if(-1==(n=e(r,n)))return-1;return n}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),o=n(1),l=n(5),s=n(15);function i(e){let t=r.searchModel.query,n=e,l=[];for(let[e,{entry:s}]of n.entries())switch(r.searchModel.searchType){case o.SearchType.AND:t.tokens.every(e=>a(e,s))&&l.push({idx:e,entry:s});break;case o.SearchType.OR:t.tokens.some(e=>a(e,s))&&l.push({idx:e,entry:s})}return l}function a(e,t){return e.startsWith("-@")&&!e.endsWith(":")?void 0===t.tags.get(e.substring(1)):e.startsWith("-")?!t.savedClean.includes(e.substring(1)):e.startsWith("@")&&!e.endsWith(":")?void 0!==t.tags.get(e):t.savedClean.includes(e)}t.searchController={reset:function(){r.searchModel.searchType=o.SearchType.NONE,r.searchModel.barQuery=l.entryFactory.createBaseEntry(),r.searchModel.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}},buildRefines:function(e){let t=new Map,n=new Map;for(let r of e.tags.values())if(null===r.val){let e=`${r.flag}${r.cleanKey}`;t.has(e)||t.set(e,r)}else{let e=`${r.flag}${r.cleanKey}${r.separator}`;n.has(e)||n.set(e,[]),n.get(e).push(r)}r.searchModel.simpleRefines=new Map([...t.entries()]),r.searchModel.complexRefines=new Map([...n.entries()].sort()),function(){for(let[e]of r.searchModel.refinesQuery.simpleKeys)r.searchModel.simpleRefines.has(e)||r.searchModel.refinesQuery.simpleKeys.delete(e);for(let e of r.searchModel.refinesQuery.keys)r.searchModel.complexRefines.has(e)||r.searchModel.refinesQuery.keys.delete(e);for(let[e]of r.searchModel.refinesQuery.vals)Array.from(r.searchModel.complexRefines.values()).some(t=>t.some(t=>t.clean===e))||r.searchModel.refinesQuery.vals.delete(e)}()},filteredEntries:function(e){let t=[];0===r.searchModel.query.tokens.length?(r.searchModel.searchType=o.SearchType.NONE,t=e.map(({entry:e},t)=>({idx:t,entry:e}))):(r.searchModel.searchType=o.SearchType.AND,t=i(e),0===t.length&&(r.searchModel.searchType=o.SearchType.OR,t=i(e)));return t},updateSearchbar:function(e){s.entryController.update(r.searchModel.barQuery,e)}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(n(0)),s=n(40),i=n(1),a=n(3),u=n(2),c=n(10);function d(e){return r(this,void 0,void 0,(function*(){a.googleModel.isSignedIn=e,a.googleModel.isSignedIn?(a.googleModel.user=a.googleModel.gapi_.auth2.getAuthInstance().currentUser.get(),u.syncerController.updateAuth(a.googleModel.token),u.libraryController.loadShelves()):(u.libraryController.removeShelves(),c.urlController.redirect("/")),l.default.redraw()}))}t.googleController={signIn:function(){a.googleModel.gapi_.auth2.getAuthInstance().signIn()},signOut:function(){a.googleModel.gapi_.auth2.getAuthInstance().signOut()},initGapi:function(){let e=a.urlModel.testMode===i.TestMode.OFF?gapi:new s.MockGapi;a.googleModel.gapi_=e,a.googleModel.gapi_.load("auth2",()=>{a.googleModel.gapi_.auth2.init({scope:a.googleModel.scope,client_id:a.googleModel.clientId}).then(()=>{a.googleModel.gapi_.auth2.getAuthInstance().isSignedIn.listen(d),d(a.googleModel.gapi_.auth2.getAuthInstance().isSignedIn.get())})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(41))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.MockGapi=class{constructor(){this.auth2=new o}load(e,t){t()}};class o{getAuthInstance(){return new i}init(e){return r(this,void 0,void 0,(function*(){}))}}class l{get(){return new s}}class s{getAuthResponse(){return{expires_in:9999,access_token:"faketoken"}}reloadAuthResponse(){return r(this,void 0,void 0,(function*(){return{expires_in:9999,access_token:"faketoken"}}))}}t.MockGoogleUser=s;class i{constructor(){this.isSignedIn=new a,this.currentUser=new l}signOut(){}signIn(){}}class a{constructor(){this.listen=e=>{},this.get=()=>!0}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(n(0)),s=n(9),i=n(3),a=n(1),u=new Worker("./js/syncWebWorker.js");function c(e){if(void 0!==e)return i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.AUTH_UPDATE,token:e},u)}u.onmessage=e=>function(e){let{id:t,payload:n,error:r}=e.data;if(null!==t&&i.syncerModel.requests.has(t))i.syncerModel.requests.get(t)({payload:n,error:r}),i.syncerModel.requests.delete(t);else switch(n.type){case a.SyncerPayloadType.SYNC_STATE:i.syncerModel.state=n.state,l.default.redraw();break;case a.SyncerPayloadType.ERROR:new s.FriendlyError(n.error.message,n.friendlyMsg);break;case a.SyncerPayloadType.TOKEN_REQUEST:c(i.googleModel.token)}}(e),t.syncerController={unpause:function(){return r(this,void 0,void 0,(function*(){return yield i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.UNPAUSE},u)}))},getRows:function(e,t,n){return i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.GET_ROWS,spreadsheetId:e,sheetTitle:n,sheetId:t,rows:[]},u)},deleteRow:function(e,t,n){return r(this,void 0,void 0,(function*(){return yield i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.DELETE_ROW,spreadsheetId:t,sheetId:n,idx:e},u)}))},updateRow:function(e,t,n,o,l){return r(this,void 0,void 0,(function*(){return yield i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.UPDATE_ROW,spreadsheetId:e,sheetTitle:n,sheetId:t,content:l,idx:o},u)}))},getSheets:function(e){return i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.GET_SHEETS,spreadsheetId:e,sheets:[]},u)},updateAuth:c,updateTestMode:function(e){return r(this,void 0,void 0,(function*(){return yield i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.TEST_MODE_UPDATE,testMode:e},u)}))},getSpreadsheet:function(e){return i.syncerModel.pushSyncerTask({type:a.SyncerPayloadType.GET_SPREADSHEET,spreadsheetId:e,spreadsheet:void 0},u)}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(9),i=n(5),a=n(2),u=n(10),c=n(17),d=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/g;function f(e,t){void 0===t&&(t=Array.from(l.libraryModel.shelves.keys())),e&&(t.forEach(e=>l.libraryModel.shelves.set(e,void 0)),o.default.redraw()),t.filter(e=>!l.libraryModel.shelves.get(e)).forEach(e=>a.syncerController.getSpreadsheet(e).then(t=>{let n=i.shelfFactory.createShelf(e,t.spreadsheet);l.libraryModel.shelves.set(n.id,n);let r=u.urlController.getActiveJournal();r&&r.shelf===n&&c.journalController.loadEntries(r)}).catch(t=>{new s.FriendlyError(t.error.message,t.friendlyMsg);let n=i.shelfFactory.createShelf(e,void 0,t.friendlyMsg);l.libraryModel.shelves.set(e,n)}).finally(()=>{o.default.redraw()}))}function h(e){let t=[];return e&&Array.from(e.matchAll(d)).forEach(e=>t.push(e[1])),t}t.libraryController={addShelves:function(e){let t=h(e);t=t.filter(e=>!l.libraryModel.shelves.has(e)),t.forEach(e=>l.libraryModel.shelves.set(e,void 0)),l.libraryModel.shelfIds=Array.from(l.libraryModel.shelves.keys()),f(!1,t)},loadShelves:f,removeShelves:function(e){void 0===e&&(e=Array.from(l.libraryModel.shelves.keys()));(e=e.filter(e=>l.libraryModel.shelves.has(e))).forEach(e=>l.libraryModel.shelves.delete(e)),l.libraryModel.shelfIds=Array.from(l.libraryModel.shelves.keys())},getSpreadsheetIdsFromUrls:h}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(n(0)),s=n(5),i=n(2);t.composeComponent=function(){var e={el:null,pos:null};const t=s.entryFactory.createBaseEntry(),n=s.entryFactory.createBaseEntry(),o=s.entryFactory.createBaseEntry(),a={placeholder:"Static Entry Prefix"},u={placeholder:"Entry Content"},c={placeholder:"Static Entry Suffix"};function d(t,o,l){let s={contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>r(this,void 0,void 0,(function*(){return yield function(e,t){return r(this,void 0,void 0,(function*(){if(13==e.keyCode&&!e.shiftKey){e.preventDefault();let r=[document.getElementById("prefix"),document.getElementById("content"),document.getElementById("suffix")].map(e=>e.innerText).join("");i.entryController.update(n,"");let o=t.entries.length;i.journalController.addEntry(t,o,r,!0)}}))}(e,o)})),oninput:n=>function(t,n){let r=i.caretController.getCaretPosition(t.target);e.pos=r?r[1]:null,e.el=t.target,i.entryController.update(n,t.target.innerText)}(n,t),onupdate:()=>(i.caretController.setCaretPosition(e.el,e.pos),e.pos=null,void(e.el=null))};return Object.assign(s,l)}return{view:function(){const e=i.urlController.getActiveJournal();if(void 0!==e&&!1!==e.loaded)return l.default("#compose",[l.default("#prefix",d(t,e,a),l.default.trust(t.rendered)),l.default("#content",d(n,e,u),l.default.trust(n.rendered)),l.default("#suffix",d(o,e,c),l.default.trust(o.rendered))])}}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(n(0)),s=n(2);t.entriesComponent=function(){const e={pos:null,el:null};function t(e){return s.searchController.filteredEntries(e.entries).map(({idx:e,entry:t})=>function(e,t){return l.default(".entryWrap",{id:"entry-"+e.id},[o(e,t),n(e,t)])}(t,e))}function n(e,t){return l.default("button",{class:"del",onclick:()=>r(this,void 0,void 0,(function*(){return s.journalController.deleteEntry(e.journal,t)}))},"del")}function o(t,n){return l.default("div",function(t,n){return{id:`entry-${t.id}-content`,contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>function(e){e.redraw=!1,13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e),oninput:n=>function(t,n){let r=s.caretController.getCaretPosition(t.target);e.pos=r?r[1]:null,e.el=t.target,s.entryController.update(n,t.target.innerText)}(n,t),onupdate:t=>function(t){t.redraw=!1,s.caretController.setCaretPosition(e.el,e.pos),e.pos=null,e.el=null}(t),onblur:e=>function(e,t,n){return r(this,void 0,void 0,(function*(){e.redraw=!1,s.entryController.save(t,n,e.target.innerText,!0),s.journalController.buildTags(t.journal)}))}(e,t,n)}}(t,n),l.default.trust(t.rendered))}return{view:function(){let e=s.urlController.getActiveShelf();const n=s.urlController.getActiveJournal();return e&&n?l.default("#entries",[l.default(".tempguidancePre","Entries"),t(n)]):null}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(2);t.shelvesComponent=function(){function e(e){return o.default("button",{class:"del",onclick:()=>s.libraryController.removeShelves([e])},"del")}function t(e){return o.default("button",{onclick:()=>s.libraryController.loadShelves(!0,[e])},"retry")}return{view:function(){let n=Array.from(l.libraryModel.shelves.entries());return o.default("#shelvesList",n.map(([n,r])=>function(n,r){return void 0===r?o.default("li",[e(n),o.default("span",n)]):void 0!==r.error?o.default("li",[e(n),o.default("span",`${n} ${r.error}`),t(n)]):o.default("li",[e(n),o.default("a",{href:"#/library/"+n},r.title)])}(n,r)))}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(2);t.refinesComponent=function(){const e=new Set;function t(){if(0!==l.searchModel.simpleRefines.size)return o.default(".tagRefineWrap",[n("Simple Tags",l.searchModel.simpleRefines.size),Array.from(l.searchModel.simpleRefines,([e,t])=>[r(e,t)])])}function n(t,n){return o.default("span",function(t){return{class:"roundTagKey",onclick:n=>function(t,n){if(t.metaKey||t.ctrlKey){if("Simple Tags"===n)return;l.searchModel.refinesQuery.keys.has(n)?l.searchModel.refinesQuery.keys.delete(n):l.searchModel.refinesQuery.keys.add(n)}else e.has(n)?e.delete(n):e.add(n)}(n,t)}}(t),["Simple Tags"===t?[]:o.default("input",{type:"checkbox",checked:l.searchModel.refinesQuery.keys.has(t)}),e.has(t)?o.default("span","▾ "):o.default("span","▿ "),o.default("span",t),o.default("span",` (${n})`)])}function r(e,t){return o.default("div",{class:"tagRefineValWrap"},[o.default("span",i(e,t),[o.default("input",{type:"checkbox",checked:null===t.val?l.searchModel.refinesQuery.simpleKeys.has(t.clean):l.searchModel.refinesQuery.vals.has(t.clean)}),null!==t.val?o.default("span",""+t.cleanVal):o.default("span",`${t.flag}${t.cleanKey}`),o.default("span",` (${t.frq})`)])])}function i(t,n){let r=null===n.val?"simpleTag":"roundTagVal",o="hide";return(null===n.val&&e.has("Simple Tags")||e.has(t)||l.searchModel.refinesQuery.vals.has(n.clean))&&(o=""),{class:`${r} ${o}`,onclick:()=>function(e){null===e.val?l.searchModel.refinesQuery.simpleKeys.has(e.clean)?l.searchModel.refinesQuery.simpleKeys.delete(e.clean):l.searchModel.refinesQuery.simpleKeys.set(e.clean,e):l.searchModel.refinesQuery.vals.has(e.clean)?l.searchModel.refinesQuery.vals.delete(e.clean):l.searchModel.refinesQuery.vals.set(e.clean,e)}(n)}}return{view:function(){const e=s.urlController.getActiveJournal();if(void 0!==e&&!1!==e.loaded)return o.default("#tagsWrap",o.default("#tags",[o.default(".tempguidancePre","Tags"),t(),Array.from(l.searchModel.complexRefines,([e,t])=>o.default(".tagRefineWrap",[n(e,t.length),t.map(t=>[r(e,t)])]))]))}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(2);t.journalsComponent=function(){return{view:function(){return o.default("#journals",function(){let e=l.urlController.getActiveShelf();if(void 0===e)return void l.urlController.redirect("/library");return Array.from(e.journals.values()).map(e=>{let t=`#/library/${e.shelf.id}/${e.id}`;return o.default("li",o.default("a",{href:t},e.title))})}())}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(1),i=n(2);t.syncStateComponent=function(){function e(){let e="",t="syncState "+r();switch(l.syncerModel.state){case s.SyncerState.DOWNLOADING:e="Downloading journal data from drive...";break;case s.SyncerState.PAUSED:e="Warning! - Syncing is paused.";break;case s.SyncerState.SYNCED:e="Cloud synced.";break;case s.SyncerState.UPLOADING:e="Uploading changes to drive...";break;case s.SyncerState.INITIALIZING:e="Initializing..."}return o.default("span",{id:"syncStateText",class:t},e)}function t(){let e="material-icons material-icons-outlined syncState "+r();return o.default("i",{id:"syncStateIcon",class:e},l.syncerModel.state)}function n(){if(l.syncerModel.state===s.SyncerState.PAUSED)return o.default("button",{id:"unpauseSync",class:"syncState",onclick:()=>i.syncerController.unpause()},"Unpause Syncing")}function r(){switch(l.syncerModel.state){case s.SyncerState.PAUSED:return"error";case s.SyncerState.SYNCED:return"okay";default:return"warn"}}return{view:function(){if(l.googleModel.isSignedIn&&0!==l.libraryModel.shelves.size)return o.default("#status",o.default("span",o.default("span",[t(),e(),n()])))}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(2);t.searchbarComponent=function(){const e={pos:null,el:null};return{view:function(){const t=s.urlController.getActiveJournal();if(void 0!==t&&!1!==t.loaded)return o.default("#search",[o.default("#searchQuery",{placeholder:"Search for text or tags",contenteditable:"true",class:"entry breakwrap",oninput:t=>function(t){let n=s.caretController.getCaretPosition(t.target);e.pos=n?n[1]:null,e.el=t.target,s.searchController.updateSearchbar(s.textController.escape(t.target.innerText))}(t),onupdate:()=>(s.caretController.setCaretPosition(e.el,e.pos),e.pos=null,void(e.el=null)),onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e)},o.default.trust(l.searchModel.barQuery.rendered)),o.default("button",{id:"clearSearch",class:"del",onclick:()=>s.searchController.updateSearchbar("")},"x")])}}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,l){function s(e){try{a(r.next(e))}catch(e){l(e)}}function i(e){try{a(r.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(n(0)),s=n(2),i=n(3);t.addShelvesComponent=function(){let e="",t=!1;function n(){if(0===i.libraryModel.shelves.size)return l.default("span","Add Google Spreadsheet URLs here to get started. ")}function o(){return l.default("button",{id:"addShelvesButton",onclick:()=>r(this,void 0,void 0,(function*(){t&&s.libraryController.addShelves(e),e="",t=!t}))},t?" ✓ ":"+/-")}function a(){return t?l.default("textarea",{id:"addShelvesText",placeholder:"Enter list of Google Sheets Spreadsheet URLs here",oninput:t=>e=t.target.value}):null}return{view:function(){return l.default("#addShelves",[n(),o(),a()])}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(2);t.breadcrumbComponent=function(){return{view:function(){if(l.googleModel.isSignedIn)return o.default("#breadcrumb",s.urlController.getBreadcrumbTrail())}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(3),s=n(7);t.signinView=function(){return{view:function(){return o.default("#auth",[o.default(s.googleComponent)])},onupdate:function(){l.googleModel.isSignedIn&&(window.location.hash="/library")}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(7);t.libraryView=function(){return{view:function(){return o.default("#library",[o.default(l.googleComponent),o.default(l.syncStateComponent),o.default(l.addShelvesComponent),o.default(l.shelvesComponent)])}}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(0)),l=n(2),s=n(7);t.journalView=function(){return{view:function(){return o.default("#shelf",[o.default(s.googleComponent),o.default(s.syncStateComponent),o.default(s.breadcrumbComponent),o.default(s.searchbarComponent),o.default(s.refinesComponent),o.default("#entriesWrap",[o.default(s.entriesComponent),o.default(s.composeComponent)])])},oninit:function(){const e=l.urlController.getActiveJournal();void 0===e||e.loaded||l.journalController.loadEntries(e)}}}}]);
//# sourceMappingURL=dntd.js.map