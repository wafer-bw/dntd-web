!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t){e.exports=m},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(7),a=s(43),o=s(5);t.syncer=new o.Syncer,t.search=new o.Search,t.refines=new o.Refines,t.journal=new o.Journal,t.serviceWorker=new o.ServiceWorker;let u=document.getElementById("root");null!==u&&n.default.route(u,"/",{"/":i.app,"/signin":a.signinView,"/library":a.libraryView,"/library/:shelfId":a.shelfView,"/library/:shelfId/:journalId":a.journalView})},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(17)),r(s(18)),r(s(19)),r(s(20)),r(s(21)),r(s(22))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(8)),r(s(9)),r(s(10)),r(s(11))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(46)),r(s(47)),r(s(48)),r(s(49)),r(s(50)),r(s(51)),r(s(52))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(12);t.Tag=r.Tag;var n=s(27);t.Entry=n.Entry;var i=s(28);t.Sheet=i.Sheet;var a=s(29);t.Syncer=a.Syncer;var o=s(30);t.Search=o.Search;var u=s(31);t.Refines=u.Refines;var l=s(32);t.Journal=l.Journal;var d=s(33);t.Spreadsheet=d.Spreadsheet;var c=s(34);t.ServiceWorker=c.ServiceWorker},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(45)),r(s(55)),r(s(56))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(16)),r(s(23)),r(s(24)),r(s(25)),r(s(26)),r(s(35)),r(s(36)),r(s(37)),r(s(38)),r(s(41)),r(s(42))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE"}(t.SyncerTaskType||(t.SyncerTaskType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROWS=0]="ROWS",e[e.SHEETS=1]="SHEETS",e[e.SYNCER_STATE=2]="SYNCER_STATE",e[e.ERROR=3]="ERROR",e[e.REAUTH=4]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done"}(t.SyncerState||(t.SyncerState={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2);t.Tag=class{constructor(e,t,s,r,n){this.frq=1,this.raw=e,this.flag=t,this.key=s,this.separator=void 0!==r?r:null,this.val=void 0!==n?n:null,this.clean=this.cleanTagString(this.raw),this.cleanKey=this.cleanTagString(this.key),this.cleanVal=null!==this.val?this.cleanTagString(this.val):null}renderKey(){return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+(this.separator?this.separator:"")+'\')" class="'+(this.separator?"tagKey":null===this.val?"simpleTag":"roundTagVal")+'">'+this.flag+this.key+"</span>"}renderVal(e){var t;return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+this.separator+(null===(t=this.cleanVal)||void 0===t?void 0:t.replace(/'/,"\\'"))+'\')" class="'+(e?"roundTagVal":"tagVal")+'">'+(e?"":this.separator)+(this.val||"")+"</span>"}render(e){return this.separator?e?this.renderVal(e):this.renderKey()+this.renderVal(e):this.renderKey()}cleanTagString(e){return e=(e=(e=r.escapeHtml(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}}},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(39)),r(s(40))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(53)),r(s(54))},,function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(2),o=s(7);t.app=function(){return{view:function(){let e=a.getHash();return["#!"===e||""===e?null:n.default(o.links),n.default(o.syncStateIndicator),n.default(o.googleAPI),n.default("#errorsWrap",n.default(o.errors)),i.journal.isActive?[n.default("#searchWrap",[n.default(o.searchbar),n.default(o.toggles)]),n.default(o.refinesPane),n.default("#entriesWrap",{class:i.journal.hideTagRefines?"fullWidth":""},[n.default(o.entries),n.default(o.compose)])]:[]]}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3);t.getHash=function(){return new URL(window.location.href).hash},t.getTestMode=function(){let e=new URL(window.location.href);if("#!demo"===e.hash)return r.TestMode.DEMO;let t=e.searchParams.get("test");return null!==t&&(s=t,Object.values(r.TestMode).includes(s))?t:r.TestMode.OFF;var s}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1);class a extends Error{constructor(e,t){super(e),this.friendlyMsg=t,i.journal.errors.push(t),console.warn(e),n.default.redraw()}}t.FriendlyError=a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCaretPosition=function(e){var t=window.getSelection(),s=[0,0];if(t.anchorNode==e)s=[t.anchorNode.innerText.length,t.extentNode.innerText.length];else{var r=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var n,i=[0,0];!function e(t,s){var r=s(t);for(t=t.firstChild;!1!==r&&t;t=t.nextSibling)r=e(t,s)}(e,(function(e){for(n=0;n<2;n++)if(e==r[n]&&(i[n]=1,i[0==n?1:0]))return;if(e.textContent&&!e.firstChild)for(n=0;n<2;n++)i[n]||(s[n]+=e.textContent.length)})),s[0]+=t.anchorOffset,s[1]+=t.extentOffset}return s[0]<=s[1]?s:[s[1],s[0]]},t.setCaretPosition=function e(t,s){if(null!==t&&null!==s){for(var r of t.childNodes)if(3==r.nodeType){if(r.length>=s){let e=document.createRange(),t=window.getSelection();return e.setStart(r,s),e.collapse(!0),t.removeAllRanges(),t.addRange(e),-1}s-=r.length}else if(-1==(s=e(r,s)))return-1;return s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagPattern=/(\@)([\w-']+)+(:)?([\w-'\*]+)?/g,t.spreadsheetIdPattern=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/g},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setStoredSpreadsheetId=function(e){localStorage.setItem("spreadsheetId",e)},t.getStoredSpreadsheetId=function(){return localStorage.getItem("spreadsheetId")||void 0},t.setStoredSpreadsheetUrls=function(e){localStorage.setItem("spreadsheetUrls",e)},t.getStoredSpreadsheetUrls=function(){return localStorage.getItem("spreadsheetUrls")||void 0},t.setStoredHideEntriesKeys=function(e){localStorage.setItem("hideEntriesKeys",e?"1":"0")},t.getStoredHideEntriesKeys=function(){return"1"===localStorage.getItem("hideEntriesKeys")},t.setStoredHideTagRefines=function(e){localStorage.setItem("hideTagRefines",e?"1":"0")},t.getStoredHideTagRefines=function(){return"1"===localStorage.getItem("hideTagRefines")},t.getStoredSpreadsheetSheetId=function(e){let t=localStorage.getItem(e+"-sheetId")||void 0;return void 0!==t?parseInt(t):void 0},t.setStoredSpreadsheetSheetId=function(e,t){localStorage.setItem(e+"-sheetId",t.toString())},t.delStoredSpreadsheetSheetId=function(e){localStorage.removeItem(e+"-sheetId")}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(3),o=s(2);t.links=function(){return{view:function(){let e=o.getHash(),t=[];return"#!about"!==e&&t.push(n.default("a",{href:"/#!about"},"About")),"#!demo"!==e&&t.push(n.default("a",{href:"/#!demo",onclick:()=>i.syncer.updateTestMode(a.TestMode.DEMO)},"Demo")),"#!"!==e&&""!==e&&t.push(n.default("a",{href:"/#!",onclick:()=>i.syncer.updateTestMode(a.TestMode.OFF)},"Start")),n.default("#navLinks",function(e){let t=[];for(let[s,r]of e.entries())t.push(r),s!==e.length-1&&t.push(" | ");return t}(t))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(7);t.about=function(){return{view:function(){return n.default("#callToAction",[n.default(i.links),n.default("#about","About page will be filled when the visual overhaul is complete.")])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1);t.errors=function(){function e(e){return{class:"dismissErrorButton",onclick:()=>i.journal.errors.splice(e,1)}}return{view:function(){return 0===i.journal.errors.length?[]:n.default("#errors",i.journal.errors.map((t,s)=>[n.default(".error",[n.default("span",t),n.default("button",e(s),"dismiss")])]))}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(0)),a=s(1),o=s(5),u=s(2);t.compose=function(){var e={el:null,pos:null};const t=new o.Entry(""),s=new o.Entry(""),n=new o.Entry(""),l={placeholder:"Static Entry Prefix"},d={placeholder:"Entry Content"},c={placeholder:"Static Entry Suffix"};function h(t,n){let l={contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>r(this,void 0,void 0,(function*(){return yield function(e){return r(this,void 0,void 0,(function*(){if(13==e.keyCode&&!e.shiftKey){e.preventDefault();let t=[document.getElementById("prefix"),document.getElementById("content"),document.getElementById("suffix")].map(e=>e.innerText).join("");s.raw="";let r=new o.Entry(t,""),n=a.journal.spreadsheet.sheet.entries.length;a.journal.spreadsheet.sheet.entries.push(r),i.default.redraw(),yield a.journal.saveEntry(n)}}))}(e)})),oninput:s=>function(t,s){let r=u.getCaretPosition(t.target);e=r?{pos:r[1],el:t.target}:{pos:null,el:null},s.raw=t.target.innerText}(s,t),onupdate:()=>(u.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null}))};return Object.assign(l,n)}return{view:function(){return i.default("#compose",[i.default("#prefix",h(t,l),i.default.trust(t.rendered)),i.default("#content",h(s,d),i.default.trust(s.rendered)),i.default("#suffix",h(n,c),i.default.trust(n.rendered))])}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(12),n=s(2);t.Entry=class{constructor(e,t){this.tags=new Map,this.hovered=!1,this.focused=!1,this.clean="",this.tokens=[],this.rendered="",this.savedClean="",this.tagMatches=[],this.readableRendered="",this.rawText="",this.savedText="",this.raw=e||"",this.saved=void 0!==t?t:this.raw}get saved(){return this.savedText}set saved(e){this.savedText=e,this.savedClean=e.toLowerCase(),this.tags=this.getTags(this.tagMatches)}get raw(){return this.rawText}set raw(e){this.rawText=e,this.clean=this.raw.toLowerCase();let t=n.escapeHtml(this.rawText);this.tokens=this.getTokens(this.clean),this.tagMatches=this.getTagMatches(t),this.rendered=this.render(t,this.tagMatches),this.readableRendered=this.render(t,this.tagMatches,!0)}render(e,t,s){for(let{tag:r,match:n}of t){let t=e.split("");t.splice(n.index,n[0].length,r.render(s)),e=t.join("")}return e}getTags(e){let t=new Map;for(let{tag:s}of e)t.has(s.clean)?t.get(s.clean).frq+=1:t.set(s.clean,s);return t}getTagMatches(e){let t=[],s=e.matchAll(n.tagPattern);for(let e of s){let s=new r.Tag(e[0],e[1],e[2],e[3],e[4]);t.push({tag:s,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}getTokens(e){return e.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(5),i=s(1);t.Sheet=class{constructor(e,t,s){this.entries=[],this.id=e,this.title=t,this.spreadsheet=s,s.sheets.set(this.id,this),i.syncer.getRows(this.spreadsheet.id,this.id,this.title)}load(e){return r(this,void 0,void 0,(function*(){e.map(e=>this.entries.push(new n.Entry(e))),i.journal.switch(),null!==i.journal.spreadsheet&&null!==i.journal.spreadsheet.sheet&&i.journal.spreadsheet.sheet.id===this.id&&i.refines.build()}))}get tags(){let e=new Map;for(let t of Array.from(this.entries.values()).reverse())for(let[s,r]of t.tags)e.has(s)?e.get(s).frq+=r.frq:e.set(s,new n.Tag(r.raw,r.flag,r.key,r.separator,r.val));return e}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(2),o=s(3);t.Syncer=class{constructor(){this.state=o.SyncerState.DOWNLOADING,this.user=null,this.worker=new Worker("./js/syncWebWorker.js"),this.updateTestMode(a.getTestMode()),this.worker.onmessage=e=>this.onMessage(e)}updateTestMode(e){this.pushSyncerTask({testMode:e,type:o.SyncerTaskType.TEST_MODE_UPDATE})}updateAuth(e){this.pushSyncerTask({token:e,type:o.SyncerTaskType.AUTH_UPDATE})}getSheets(e){this.pushSyncerTask({spreadsheetId:e,type:o.SyncerTaskType.GET_SHEETS})}getRows(e,t,s){this.pushSyncerTask({spreadsheetId:e,sheetId:t,sheetTitle:s,type:o.SyncerTaskType.GET_ROWS})}deleteRow(e,t,s){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,type:o.SyncerTaskType.DELETE_ROW})}updateRow(e,t,s,r,n){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,sheetTitle:r,content:n,type:o.SyncerTaskType.UPDATE_ROW})}unpause(){this.pushSyncerTask({type:o.SyncerTaskType.UNPAUSE})}pushSyncerTask(e){this.worker.postMessage(e)}onMessage(e){let t=e.data;switch(t.type){case o.SyncerResponseType.SYNCER_STATE:t.state!==i.syncer.state&&(i.syncer.state=t.state,n.default.redraw());break;case o.SyncerResponseType.SHEETS:i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).load(t.sheets);break;case o.SyncerResponseType.ROWS:i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.has(t.sheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.get(t.sheetId).load(t.rows);break;case o.SyncerResponseType.ERROR:new a.FriendlyError(t.error.message,"Sync Error - "+t.friendlyMsg);break;case o.SyncerResponseType.REAUTH:null!==i.syncer.user&&i.syncer.user.reloadAuthResponse().then(e=>{i.syncer.updateAuth(e.access_token)}).catch(e=>{new a.FriendlyError(e,"You're signed out and need to sign back in.")})}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1),n=s(5),i=s(3);t.Search=class{constructor(){this.barQuery=new n.Entry(""),this.searchType=i.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}get query(){return new n.Entry([this.barQuery.raw,...Array.from(this.refinesQuery.keys.values()),...Array.from(this.refinesQuery.vals.keys()),...Array.from(this.refinesQuery.simpleKeys.keys())].join(" "))}reset(){this.barQuery=new n.Entry(""),this.searchType=i.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}entries(){let e=null;return 0===this.query.tokens.length?this.searchType=i.SearchType.NONE:(this.searchType=i.SearchType.AND,e=this.search(),0===e.length&&(this.searchType=i.SearchType.OR,e=this.search())),e}search(){let e=this.query,t=[],s=r.journal.spreadsheet.sheet.entries;for(let[r,n]of s.entries())switch(this.searchType){case i.SearchType.AND:e.tokens.every(e=>this.match(e,n))&&t.push({idx:r,entry:n});break;case i.SearchType.OR:e.tokens.some(e=>this.match(e,n))&&t.push({idx:r,entry:n})}return t}match(e,t){return e.startsWith("-@")&&!e.endsWith(":")?void 0===t.tags.get(e.substring(1)):e.startsWith("-")?!t.savedClean.includes(e.substring(1)):e.startsWith("@")&&!e.endsWith(":")?void 0!==t.tags.get(e):t.savedClean.includes(e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(1);t.Refines=class{constructor(){this.simple=new Map,this.complex=new Map}build(){let e=new Map,t=new Map;for(let s of r.journal.spreadsheet.sheet.tags.values())if(null===s.val){let t=`${s.flag}${s.cleanKey}`;e.has(t)||e.set(t,s)}else{let e=`${s.flag}${s.cleanKey}${s.separator}`;t.has(e)||t.set(e,[]),t.get(e).push(s)}this.simple=new Map([...e.entries()]),this.complex=new Map([...t.entries()].sort()),this.cleanRefines()}cleanRefines(){for(let[e]of r.search.refinesQuery.simpleKeys)this.simple.has(e)||r.search.refinesQuery.simpleKeys.delete(e);for(let e of r.search.refinesQuery.keys)this.complex.has(e)||r.search.refinesQuery.keys.delete(e);for(let[e]of r.search.refinesQuery.vals)Array.from(this.complex.values()).some(t=>t.some(t=>t.clean===e))||r.search.refinesQuery.vals.delete(e)}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(0)),a=s(5),o=s(1),u=s(2);t.Journal=class{constructor(){this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}load(e){return r(this,void 0,void 0,(function*(){this.hideTagRefines=u.getStoredHideTagRefines(),this.hideEntriesKeys=u.getStoredHideEntriesKeys();let t=this.getSpreadsheetIdsFromUrls(e);yield this.loadNewSpreadsheets(t),yield this.removeOldSpreadsheets(t)}))}unload(){this.removeOldSpreadsheets([]),this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}get isActive(){return null!==this.spreadsheet&&null!==this.spreadsheet.sheet&&this.isSignedIn}switch(e,t){var s,r,n;void 0!==e&&void 0!==t&&(null===(s=this.spreadsheet)||void 0===s?void 0:s.id)===e&&(null===(n=null===(r=this.spreadsheet)||void 0===r?void 0:r.sheet)||void 0===n?void 0:n.id)===t||(void 0===e&&void 0===t&&(e=u.getStoredSpreadsheetId(),t=u.getStoredSpreadsheetSheetId(e)),o.search.reset(),this.spreadsheet=void 0!==e&&this.spreadsheets.has(e)?this.spreadsheets.get(e):Array.from(this.spreadsheets.values())[0]||null,null!==this.spreadsheet&&(u.setStoredSpreadsheetId(this.spreadsheet.id),this.spreadsheet.sheet=void 0!==t&&this.spreadsheet.sheets.has(t)?this.spreadsheet.sheets.get(t):Array.from(this.spreadsheet.sheets.values())[0]||null,null!==this.spreadsheet.sheet&&u.setStoredSpreadsheetSheetId(this.spreadsheet.id,this.spreadsheet.sheet.id)),o.refines.build(),i.default.redraw())}loadNewSpreadsheets(e){return r(this,void 0,void 0,(function*(){for(let t of e.filter(e=>!this.spreadsheets.get(e)).sort(e=>e===u.getStoredSpreadsheetId()?-1:1))new a.Spreadsheet(t)}))}removeOldSpreadsheets(e){return r(this,void 0,void 0,(function*(){for(let[t]of Array.from(this.spreadsheets).filter(([t])=>!e.includes(t)))if(u.delStoredSpreadsheetSheetId(t),this.spreadsheet===this.spreadsheets.get(t)&&(this.spreadsheet=null),this.spreadsheets.has(t)){for(let[e]of this.spreadsheets.get(t).sheets)this.spreadsheets.get(t).sheets.delete(e);this.spreadsheets.delete(t)}}))}getSpreadsheetIdsFromUrls(e){if(!e)return[];let t=[],s=e.matchAll(u.spreadsheetIdPattern);for(let e of s)e&&t.push(e[1]);return t}deleteEntry(e){return r(this,void 0,void 0,(function*(){o.syncer.deleteRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id),this.spreadsheet.sheet.entries.splice(e,1)[0],o.refines.build(),i.default.redraw()}))}saveEntry(e){return r(this,void 0,void 0,(function*(){let t=this.spreadsheet.sheet.entries[e];t.raw!==t.saved&&(o.syncer.updateRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id,this.spreadsheet.sheet.title,t.raw),t.saved=t.raw,o.refines.build(),i.default.redraw())}))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(5),i=s(1),a=s(2);t.Spreadsheet=class{constructor(e){this.id=e,this.sheet=null,this.sheets=new Map,i.journal.spreadsheets.set(e,this),i.syncer.getSheets(e)}load(e){return r(this,void 0,void 0,(function*(){for(let t of e.sort(e=>{var t;return(null===(t=e.properties)||void 0===t?void 0:t.sheetId)===a.getStoredSpreadsheetSheetId(this.id)?-1:1}))void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.properties.sheetId&&new n.Sheet(t.properties.sheetId,t.properties.title,this)}))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2);t.ServiceWorker=class{constructor(){if(!("serviceWorker"in navigator))throw new n.FriendlyError("serviceWorker not supported","Your browser is not supported.");window.addEventListener("load",()=>r(this,void 0,void 0,(function*(){yield navigator.serviceWorker.register("../serviceWorker.js")})))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(0)),a=s(1),o=s(2);t.entries=function(){var e={pos:null,el:null};function t(){let e=a.search.entries();return null!==e?e.map(({idx:e,entry:t})=>s(e,t)):Array.from(a.journal.spreadsheet.sheet.entries.entries()).map(([e,t])=>s(e,t))}function s(e,t){return i.default(".entryWrap",{id:"entry-"+e},[u(t,e),n(e)])}function n(e){return i.default("button",{class:"del",onclick:()=>r(this,void 0,void 0,(function*(){return yield a.journal.deleteEntry(e)}))},"del")}function u(t,s){return i.default("div",function(t,s){return{id:`entry-${s}-content`,contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>function(e){e.redraw=!1,13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e),oninput:s=>function(t,s){let r=o.getCaretPosition(t.target);e={pos:r?r[1]:null,el:t.target},s.raw=t.target.innerText}(s,t),onupdate:t=>function(t){t.redraw=!1,o.setCaretPosition(e.el,e.pos),e={pos:null,el:null}}(t),onblur:e=>function(e,t,s){return r(this,void 0,void 0,(function*(){e.redraw=!1,t.focused=!1,yield a.journal.saveEntry(s)}))}(e,t,s),onmouseover:e=>function(e,t){a.journal.hideEntriesKeys||(e.redraw=!1);t.hovered=!0}(e,t),onmouseout:e=>function(e,t){a.journal.hideEntriesKeys||(e.redraw=!1);t.hovered=!1}(e,t),onfocus:e=>function(e,t){e.redraw=!1,t.focused=!0}(e,t)}}(t,s),i.default.trust(t.hovered||t.focused||!a.journal.hideEntriesKeys?t.rendered:t.readableRendered))}return{view:function(){return i.default("#entries",[i.default(".tempguidancePre","Entries"),t()])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(2);t.toggles=function(){return{view:function(){return[n.default("#hideEntriesKeysToggle",[n.default("label",{for:"hideEntriesCheckbox"},"Tag keys:"),n.default("input#hideEntriesCheckbox",{type:"checkbox",checked:!a.getStoredHideEntriesKeys(),disabled:i.journal.entryInFocus,onclick:()=>{i.journal.hideEntriesKeys=!i.journal.hideEntriesKeys,a.setStoredHideEntriesKeys(i.journal.hideEntriesKeys)}})]),n.default("#hideTagRefinesToggle",[n.default("label",{for:"hideTagRefinesCheckbox"},"Tag refines:"),n.default("input#hideTagRefinesCheckbox",{type:"checkbox",checked:!i.journal.hideTagRefines,onclick:()=>{i.journal.hideTagRefines=!i.journal.hideTagRefines,a.setStoredHideTagRefines(i.journal.hideTagRefines)}})])]}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(2);t.searchbar=function(){var e={el:null,pos:null};return{view:function(){return n.default("#search",[n.default("#searchQuery",{placeholder:"Search for text or tags",contenteditable:"true",class:"entry breakwrap",oninput:t=>function(t){let s=a.getCaretPosition(t.target);e=s?{pos:s[1],el:t.target}:{pos:null,el:null},i.search.barQuery.raw=a.escapeHtml(t.target.innerText)}(t),onupdate:()=>(a.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null})),onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e)},n.default.trust(i.search.barQuery.rendered)),n.default("button",{id:"clearSearch",class:"del",onclick:()=>i.search.barQuery.raw=""},"x")])}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(s(0)),a=s(13),o=s(3),u=s(1),l=s(2),d=["https://www.googleapis.com/auth/spreadsheets"].join(" ");t.googleAPI=function(){var e;function t(){e.auth2.init({scope:d,client_id:"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(s),s(e.auth2.getAuthInstance().isSignedIn.get())})}function s(t){return r(this,void 0,void 0,(function*(){if(u.journal.isSignedIn=t,i.default.redraw(),u.journal.isSignedIn){let t=e.auth2.getAuthInstance().currentUser.get();u.syncer.user=t;let s=t.getAuthResponse();u.syncer.updateAuth(s.access_token),yield function(){return r(this,void 0,void 0,(function*(){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}))}()}else u.journal.unload()}))}function n(){return i.default("button",{id:"addSpreadsheet",onclick:()=>r(this,void 0,void 0,(function*(){if(u.journal.showAddSpreadsheetTextbox=!u.journal.showAddSpreadsheetTextbox,!u.journal.showAddSpreadsheetTextbox){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}}))},u.journal.showAddSpreadsheetTextbox?" ✓ ":"+/-")}return{view:function(){return l.getTestMode()===o.TestMode.DEMO?(u.journal.isSignedIn=!0,u.journal.load("https://docs.google.com/spreadsheets/d/demo/edit"),[]):i.default("#googleApi",[u.journal.showAddSpreadsheetTextbox?[i.default("textarea",{id:"spreadsheetURLs",placeholder:"Enter list of Google Sheets Spreadsheet URLs here",value:l.getStoredSpreadsheetUrls(),oninput:e=>l.setStoredSpreadsheetUrls(e.target.value)}),i.default("br")]:[],u.journal.isSignedIn?n():[],null!==u.journal.spreadsheet?i.default("select",{onchange:e=>{let t=e.target.value;u.journal.switch(t,l.getStoredSpreadsheetSheetId(t))},id:"spreadsheetSelect"},[Array.from(u.journal.spreadsheets).map(([e])=>[i.default("option",{value:e,selected:u.journal.spreadsheet.id===e},e.substr(e.length-6))])]):[],u.journal.isActive?i.default("select",{onchange:e=>{u.journal.switch(u.journal.spreadsheet.id,parseInt(e.target.value)),i.default.redraw()},id:"sheetSelect"},[Array.from(u.journal.spreadsheet.sheets).map(([e,t])=>[i.default("option",{value:e,selected:u.journal.isActive&&u.journal.spreadsheet.sheet.id===e},t.title)])]):[],u.journal.isSignedIn?i.default("button",{onclick:()=>{l.getTestMode()===o.TestMode.RETURN_ROWS&&u.journal.unload(),e.auth2.getAuthInstance().signOut()},class:"authButton"},"Sign Out"):i.default("button",{onclick:()=>e.auth2.getAuthInstance().signIn(),class:"authButton"},"Sign In"),i.default("script",{async:!0,defer:!0,src:"https://apis.google.com/js/api.js",onload:()=>{(e=l.getTestMode()===o.TestMode.OFF?gapi:new a.MockGapi).load("auth2",t)}})])}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.MockGapi=class{constructor(){this.auth2=new n}load(e,t){t()}};class n{getAuthInstance(){return new o}init(e){return r(this,void 0,void 0,(function*(){}))}}class i{get(){return new a}}class a{getAuthResponse(){return{expires_in:9999,access_token:"faketoken"}}reloadAuthResponse(){return r(this,void 0,void 0,(function*(){return{expires_in:9999,access_token:"faketoken"}}))}}t.MockGoogleUser=a;class o{constructor(){this.isSignedIn=new u,this.currentUser=new i}signOut(){}signIn(){}}class u{constructor(){this.listen=e=>{},this.get=()=>!0}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(3);t.SyncerTasksMock=class{constructor(e){this.testMode=e,this.extendSheetLength=100}getSheets(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_GET_SPREADSHEET_SHEETS)throw new Error("mock fail");return[{properties:{sheetId:0,title:"Sheet1",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}},{properties:{sheetId:1,title:"Sheet2",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}}]}))}getRows(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_GET_RANGE)throw new Error("mock fail");return this.testMode===n.TestMode.RETURN_ROWS?["aaa","bbb","ccc","@tag","@key:value"]:[]}))}updateRow(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_UPDATE_RANGE)throw new Error("mock fail")}))}deleteRow(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_DELETE_ROW)throw new Error("mock fail")}))}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1);t.refinesPane=function(){const e=new Set;function t(t,s){return n.default("span",function(t){return{class:"roundTagKey",onclick:s=>function(t,s){if(t.metaKey||t.ctrlKey){if("Simple Tags"===s)return;i.search.refinesQuery.keys.has(s)?i.search.refinesQuery.keys.delete(s):i.search.refinesQuery.keys.add(s)}else e.has(s)?e.delete(s):e.add(s)}(s,t)}}(t),["Simple Tags"===t?[]:n.default("input",{type:"checkbox",checked:i.search.refinesQuery.keys.has(t)}),e.has(t)?n.default("span","▾ "):n.default("span","▿ "),n.default("span",t),n.default("span",` (${s})`)])}function s(e,t){return n.default("div",{class:"tagRefineValWrap"},[n.default("span",r(e,t),[n.default("input",{type:"checkbox",checked:null===t.val?i.search.refinesQuery.simpleKeys.has(t.clean):i.search.refinesQuery.vals.has(t.clean)}),null!==t.val?n.default("span",""+t.cleanVal):n.default("span",`${t.flag}${t.cleanKey}`),n.default("span",` (${t.frq})`)])])}function r(t,s){let r=null===s.val?"simpleTag":"roundTagVal",n="hide";return(null===s.val&&e.has("Simple Tags")||e.has(t)||i.search.refinesQuery.vals.has(s.clean))&&(n=""),{class:`${r} ${n}`,onclick:()=>function(e){null===e.val?i.search.refinesQuery.simpleKeys.has(e.clean)?i.search.refinesQuery.simpleKeys.delete(e.clean):i.search.refinesQuery.simpleKeys.set(e.clean,e):i.search.refinesQuery.vals.has(e.clean)?i.search.refinesQuery.vals.delete(e.clean):i.search.refinesQuery.vals.set(e.clean,e)}(s)}}return{view:function(){return i.journal.hideTagRefines?[]:n.default("#tagsWrap",n.default("#tags",[n.default(".tempguidancePre","Tags"),n.default(".tagRefineWrap",0===i.refines.simple.size?[]:[t("Simple Tags",i.refines.simple.size),Array.from(i.refines.simple,([e,t])=>[s(e,t)])]),Array.from(i.refines.complex,([e,r])=>n.default(".tagRefineWrap",[t(e,r.length),r.map(t=>[s(e,t)])]))]))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(1),a=s(3);t.syncStateIndicator=function(){function e(){let e="",t="syncState "+r();switch(i.syncer.state){case a.SyncerState.DOWNLOADING:e="Downloading journal data from drive...";break;case a.SyncerState.PAUSED:e="Warning! - Syncing is paused.";break;case a.SyncerState.SYNCED:e="All changes saved.";break;case a.SyncerState.UPLOADING:e="Uploading changes to drive..."}return n.default("span",{id:"syncStateText",class:t},e)}function t(){let e="material-icons material-icons-outlined syncState "+r();return n.default("i",{id:"syncStateIcon",class:e},i.syncer.state)}function s(){if(i.syncer.state===a.SyncerState.PAUSED)return n.default("button",{id:"unpauseSync",class:"syncState",onclick:()=>i.syncer.unpause()},"Unpause Syncing")}function r(){switch(i.syncer.state){case a.SyncerState.PAUSED:return"error";case a.SyncerState.SYNCED:return"okay";default:return"warn"}}return{view:function(){return n.default("#status",n.default("span",function(){if(0===i.journal.spreadsheets.size)return;return n.default("span",[t(),e(),s()])}()))}}}},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(44)),r(s(57)),r(s(58)),r(s(59))},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(6);t.shelfView=function(){return{view:function(){return n.default("#shelf",[n.default(i.googleComponent),n.default(i.journalsComponent)])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(4),a=s(14);t.googleComponent=function(){return{view:function(){return n.default("#googleApi",[void 0===i.googleModel.isSignedIn||i.googleModel.isSignedIn?null:n.default(".preamble","PREAMBLE MSG"),i.googleModel.isSignedIn?n.default("button",{onclick:()=>a.googleController.signOut(),class:"authButton"},"Sign Out"):n.default("button",{onclick:()=>a.googleController.signIn(),class:"authButton"},"Sign In"),n.default("script",{async:!0,defer:!0,src:i.googleModel.src,onload:()=>{a.googleController.initGapi()}})])}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2);t.TagModel=class{constructor(e,t,s,r,n){this.frq=1,this.raw=e,this.flag=t,this.key=s,this.separator=void 0!==r?r:null,this.val=void 0!==n?n:null,this.clean=this.cleanTagString(this.raw),this.cleanKey=this.cleanTagString(this.key),this.cleanVal=null!==this.val?this.cleanTagString(this.val):null}renderKey(){return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+(this.separator?this.separator:"")+'\')" class="'+(this.separator?"tagKey":null===this.val?"simpleTag":"roundTagVal")+'">'+this.flag+this.key+"</span>"}renderVal(e){var t;return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+this.separator+(null===(t=this.cleanVal)||void 0===t?void 0:t.replace(/'/,"\\'"))+'\')" class="'+(e?"roundTagVal":"tagVal")+'">'+(e?"":this.separator)+(this.val||"")+"</span>"}render(e){return this.separator?e?this.renderVal(e):this.renderKey()+this.renderVal(e):this.renderKey()}cleanTagString(e){return e=(e=(e=r.escapeHtml(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(4),n=s(2);t.EntryModel=class{constructor(e,t){this.tags=new Map,this.hovered=!1,this.focused=!1,this.clean="",this.tokens=[],this.rendered="",this.savedClean="",this.tagMatches=[],this.readableRendered="",this.rawText="",this.savedText="",this.raw=e||"",this.saved=void 0!==t?t:this.raw}get saved(){return this.savedText}set saved(e){this.savedText=e,this.savedClean=e.toLowerCase(),this.tags=this.getTags(this.tagMatches)}get raw(){return this.rawText}set raw(e){this.rawText=e,this.clean=this.raw.toLowerCase();let t=n.escapeHtml(this.rawText);this.tokens=this.getTokens(this.clean),this.tagMatches=this.getTagMatches(t),this.rendered=this.render(t,this.tagMatches),this.readableRendered=this.render(t,this.tagMatches,!0)}render(e,t,s){for(let{tag:r,match:n}of t){let t=e.split("");t.splice(n.index,n[0].length,r.render(s)),e=t.join("")}return e}getTags(e){let t=new Map;for(let{tag:s}of e)t.has(s.clean)?t.get(s.clean).frq+=1:t.set(s.clean,s);return t}getTagMatches(e){let t=[],s=e.matchAll(n.tagPattern);for(let e of s){let s=new r.TagModel(e[0],e[1],e[2],e[3],e[4]);t.push({tag:s,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}getTokens(e){return e.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ShelfFactory=class{createShelf(e,t){return new r(e,t)}};class r{constructor(e,t){this.id=e,this.journalIds=t}}t.ShelfModel=r},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3);t.syncerModel=new class{constructor(){this.requestsCounter=0,this.requests=new Map,this.state=r.SyncerState.DOWNLOADING,this.user=null,this.worker=new Worker("./js/syncWebWorker.js"),this.worker.onmessage=e=>this.onMessage(e)}pushSyncerTask(e){let t="task-"+this.requestsCounter++;return new Promise((s,r)=>{this.requests.set(t,({task:e,error:t})=>{t?r(t):s(e)}),this.worker.postMessage({id:t,task:e})})}onMessage(e){let{id:t,task:s,error:r}=e.data;null!==t&&this.requests.has(t)&&(this.requests.get(t)({task:s,error:r}),this.requests.delete(t))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.googleModel=new class{constructor(e){this.isSignedIn=e,this.src="https://apis.google.com/js/api.js",this.scope=["https://www.googleapis.com/auth/spreadsheets"].join(" "),this.clientId="893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(4);t.JournalModel=class{constructor(e,t,s,n){this.id=e,this.title=s,this.tags=new Map,this.shelfId=t,this.entries=n.map(e=>new r.EntryModel(e))}buildTags(){let e=new Map;for(let t of Array.from(this.entries.values()).reverse())for(let[s,n]of t.tags)e.has(s)?e.get(s).frq+=n.frq:e.set(s,new r.TagModel(n.raw,n.flag,n.key,n.separator,n.val));return e}addEntry(e,t){this.entries.splice(e,0,new r.EntryModel(t)),this.tags=this.buildTags()}updateEntry(e,t){let s=this.entries[e];s.saved!==t&&(s.saved=t,this.tags=this.buildTags())}deleteEntry(e){this.entries.splice(e,1)[0],this.tags=this.buildTags()}moveEntry(e,t){let s=this.entries[e];this.entries.splice(e,1),this.entries.splice(t,0,s)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(14),n=s(2);class i{constructor(e){this.shelfIds=e}}t.libraryModel=(new class{createLibrary(){let e=n.getStoredSpreadsheetUrls(),t=this.getSpreadsheetIdsFromUrls(e);return this.getSpreadsheetsMetadata(t),new i(t)}getSpreadsheetIdsFromUrls(e){let t=[];if(e){Array.from(e.matchAll(n.spreadsheetIdPattern)).forEach(e=>t.push(e[1]))}return t}getSpreadsheetsMetadata(e){Promise.all(e.map(e=>r.syncerController.getSheets(e))).then(e=>e.forEach(e=>console.log(e)))}}).createLibrary()},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(13),a=s(3),o=s(4),u=s(2);function l(e){o.googleModel.isSignedIn=e,n.default.redraw()}t.googleController={signIn:function(){o.googleModel.gapi_.auth2.getAuthInstance().signIn()},signOut:function(){o.googleModel.gapi_.auth2.getAuthInstance().signOut()},initGapi:function(){let e=u.getTestMode()===a.TestMode.OFF?gapi:new i.MockGapi;e.load("auth2",()=>{e.auth2.init({scope:o.googleModel.scope,client_id:o.googleModel.clientId}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(l),l(e.auth2.getAuthInstance().isSignedIn.get())})}),o.googleModel.gapi_=e}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(4),i=s(3);t.syncerController={updateTestMode:function(e){return r(this,void 0,void 0,(function*(){return yield n.syncerModel.pushSyncerTask({type:i.SyncerTaskType.TEST_MODE_UPDATE,testMode:e})}))},updateAuth:function(e){return r(this,void 0,void 0,(function*(){return yield n.syncerModel.pushSyncerTask({type:i.SyncerTaskType.AUTH_UPDATE,token:e})}))},getSheets:function(e){return r(this,void 0,void 0,(function*(){let t={type:i.SyncerTaskType.GET_SHEETS,spreadsheetId:e};return yield n.syncerModel.pushSyncerTask(t)}))},getRows:function(e,t,s){return r(this,void 0,void 0,(function*(){let r={type:i.SyncerTaskType.GET_ROWS,spreadsheetId:e,sheetTitle:s,sheetId:t};return yield n.syncerModel.pushSyncerTask(r)}))},deleteRow:function(e,t,s){return r(this,void 0,void 0,(function*(){return yield n.syncerModel.pushSyncerTask({type:i.SyncerTaskType.DELETE_ROW,spreadsheetId:t,sheetId:s,idx:e})}))},updateRow:function(e,t,s,a,o){return r(this,void 0,void 0,(function*(){return yield n.syncerModel.pushSyncerTask({type:i.SyncerTaskType.UPDATE_ROW,spreadsheetId:t,sheetTitle:a,sheetId:s,content:o,idx:e})}))},unpause:function(){return r(this,void 0,void 0,(function*(){return yield n.syncerModel.pushSyncerTask({type:i.SyncerTaskType.UNPAUSE})}))}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(4);t.shelvesComponent=function(){return{view:function(){return n.default("#shelves",i.libraryModel.shelfIds.map(e=>n.default("li",n.default("a",{href:"#/library/"+e},e))))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0));t.journalsComponent=function(){return{view:function(){let e=n.default.route.param("shelfId");return n.default("#journals",["0","123","456"].map(t=>n.default("li",n.default("a",{href:`#/library/${e}/${t}`},t))))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(4),a=s(6);t.signinView=function(){return{view:function(){return n.default("#auth",[n.default(a.googleComponent)])},onupdate:function(){i.googleModel.isSignedIn&&(window.location.hash="/library")}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(6);t.libraryView=function(){return{view:function(){return n.default("#library",[n.default(i.googleComponent),n.default(i.shelvesComponent)])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(0)),i=s(6);t.journalView=function(){return{view:function(){let e=n.default.route.param("shelfId"),t=n.default.route.param("journalId");return n.default("#shelf",[n.default(i.googleComponent),n.default("span",`Shelf: ${e}, Journal: ${t}`)])}}}}]);
//# sourceMappingURL=dntd.js.map