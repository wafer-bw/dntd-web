!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(2),o=s(4),a=s(30);t.serviceWorker=new o.ServiceWorker,t.testMode=i.getTestMode(),t.syncer=new o.Syncer(t.testMode),t.search=new o.Search,t.journal=new o.Journal,null!==document.getElementById("dntd")&&r.default.mount(document.getElementById("dntd"),(function(){return{view:function(){return[r.default(a.spinner),r.default(a.googleAPI),r.default("#errorsWrap",r.default(a.errors)),t.journal.isActive?[r.default("#searchWrap",[r.default(a.searchbar),r.default(a.toggles)]),r.default(a.refines),r.default("#entriesWrap",{class:t.journal.hideTagRefines?"fullWidth":""},[r.default(a.entries),r.default(a.compose)])]:[]]}}}))},function(e,t){e.exports=m},function(e,t,s){"use strict";function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(17)),n(s(18)),n(s(19)),n(s(20)),n(s(21)),n(s(22))},function(e,t,s){"use strict";function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(6)),n(s(7)),n(s(8)),n(s(9))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(16);t.Tag=n.Tag;var r=s(23);t.Entry=r.Entry;var i=s(24);t.Sheet=i.Sheet;var o=s(25);t.Syncer=o.Syncer;var a=s(26);t.Search=a.Search;var u=s(27);t.Journal=u.Journal;var d=s(28);t.Spreadsheet=d.Spreadsheet;var l=s(29);t.ServiceWorker=l.ServiceWorker},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(10)),r(s(11)),r(s(12)),t.syncRate=500,t.sleep=function(e){return n(this,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}))};class i extends Error{constructor(e,t){super(e),this.needsReAuth=t}}t.SyncerError=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE"}(t.SyncerTaskType||(t.SyncerTaskType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROWS=0]="ROWS",e[e.SHEETS=1]="SHEETS",e[e.QUEUE_STATE=2]="QUEUE_STATE",e[e.ERROR=3]="ERROR",e[e.REAUTH=4]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={}))},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(5);t.SyncerTasks=class{constructor(){this.extendSheetLength=100}getSheets(e,t){return n(this,void 0,void 0,(function*(){let s="https://sheets.googleapis.com/v4/spreadsheets/"+t.spreadsheetId,n={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},i=yield fetch(s,n);if(i.ok){return(yield i.json()).sheets||[]}{let e=yield i.json();throw new r.SyncerError("Failed to get spreadsheet details.\n"+JSON.stringify(e),401===i.status)}}))}getRows(e,t){return n(this,void 0,void 0,(function*(){let s=t.sheetTitle+"!A:A",n=`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}/values/${s}`,i={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},o=yield fetch(n,i);if(o.ok){let e=yield o.json();return e.values?e.values.map(e=>e[0]):[]}{let e=yield o.json();throw new r.SyncerError("Failed to get sheet rows.\n"+JSON.stringify(e),401===o.status)}}))}updateRow(e,t){return n(this,void 0,void 0,(function*(){let s=`${t.sheetTitle}!A${t.idx+1}:A${t.idx+1}`,n=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}/values/${s}`),i={Authorization:"Bearer "+e},o={valueInputOption:"RAW"};Object.keys(o).forEach(e=>n.searchParams.append(e,o[e]));let a={method:"PUT",cache:"no-cache",headers:i,body:JSON.stringify({range:s,majorDimension:"ROWS",values:[[t.content]]})},u=yield fetch(n.toString(),a),d=yield u.json();if(!u.ok){if(d.error.message.includes("exceeds grid limits")){if(yield this.extendSheet(e,t.spreadsheetId,t.sheetId),(yield fetch(n.toString(),a)).ok)return;{let e=yield u.json();throw new r.SyncerError("Failed to update row:\n"+JSON.stringify(e),401===u.status)}}throw new r.SyncerError("Failed to update row:\n"+JSON.stringify(d),401===u.status)}}))}deleteRow(e,t){return n(this,void 0,void 0,(function*(){let s={sheetId:t.sheetId,startRowIndex:t.idx,endRowIndex:t.idx+1,startColumnIndex:0},n=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}:batchUpdate`),i={method:"POST",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{deleteRange:{range:s,shiftDimension:"ROWS"}}]})},o=yield fetch(n.toString(),i);if(!o.ok){let e=yield o.json();throw new r.SyncerError("Failed to delete row.\n"+JSON.stringify(e),401===o.status)}}))}extendSheet(e,t,s){return n(this,void 0,void 0,(function*(){let n=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t}:batchUpdate`),i={method:"POST",mode:"cors",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{appendDimension:{sheetId:s,dimension:"ROWS",length:this.extendSheetLength}}]})},o=yield fetch(n.toString(),i);if(!o.ok){let e=yield o.json();throw new r.SyncerError("Failed to extend sheet.\n"+JSON.stringify(e),401===o.status)}}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3);t.instanceOfSyncerError=function(e){return"needsReAuth"in e},t.instanceOfRowsResponse=function(e){return"type"in e&&e.type===n.SyncerResponseType.ROWS},t.instanceOfSheetsResponse=function(e){return"type"in e&&e.type===n.SyncerResponseType.SHEETS},t.instanceOfQueueStateResponse=function(e){return"type"in e&&e.type===n.SyncerResponseType.QUEUE_STATE},t.instanceOfErrorResponse=function(e){return"type"in e&&e.type===n.SyncerResponseType.ERROR},t.instanceOfReauthResponse=function(e){return"type"in e&&e.type===n.SyncerResponseType.REAUTH},t.instanceOfGetSheetsTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.GET_SHEETS},t.instanceOfAuthUpdateTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.AUTH_UPDATE},t.instanceOfGetRowsTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.GET_ROWS},t.instanceOfUpdateRowTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.UPDATE_ROW},t.instanceOfDeleteRowTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.DELETE_ROW},t.instanceOfTestModeUpdateTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.TEST_MODE_UPDATE},t.instanceOfUnpauseTask=function(e){return"type"in e&&e.type===n.SyncerTaskType.UNPAUSE}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3);function r(e){postMessage(e)}t.postSheets=function(e,t){r({spreadsheetId:e.spreadsheetId,sheets:t,type:n.SyncerResponseType.SHEETS})},t.postRows=function(e,t){r({spreadsheetId:e.spreadsheetId,sheetId:e.sheetId,rows:t,type:n.SyncerResponseType.ROWS})},t.postQueueState=function(e,t){r({length:e,paused:t,type:n.SyncerResponseType.QUEUE_STATE})},t.postError=function(e){r({error:e,type:n.SyncerResponseType.ERROR})},t.postReAuthRequest=function(){postMessage({type:n.SyncerResponseType.REAUTH})}},function(e,t,s){"use strict";function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(14)),n(s(15))},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.MockGapi=class{constructor(){this.auth2=new r}load(e,t){t()}};class r{getAuthInstance(){return new a}init(e){return n(this,void 0,void 0,(function*(){}))}}class i{get(){return new o}}class o{getAuthResponse(){return{expires_in:9999,access_token:"faketoken"}}reloadAuthResponse(){return n(this,void 0,void 0,(function*(){return{expires_in:9999,access_token:"faketoken"}}))}}t.MockGoogleUser=o;class a{constructor(){this.isSignedIn=new u,this.currentUser=new i}signOut(){}signIn(){}}class u{constructor(){this.listen=e=>{},this.get=()=>!0}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(3);t.SyncerTasksMock=class{constructor(e){this.testMode=e,this.extendSheetLength=100}getSheets(e,t){return n(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_GET_SPREADSHEET_SHEETS)throw new Error("mock fail");return[{properties:{sheetId:0,title:"Sheet1",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}},{properties:{sheetId:1,title:"Sheet2",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}}]}))}getRows(e,t){return n(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_GET_RANGE)throw new Error("mock fail");return this.testMode===r.TestMode.RETURN_ROWS?["aaa","bbb","ccc","@tag","@key:value"]:[]}))}updateRow(e,t){return n(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_UPDATE_RANGE)throw new Error("mock fail")}))}deleteRow(e,t){return n(this,void 0,void 0,(function*(){if(this.testMode===r.TestMode.FAIL_DELETE_ROW)throw new Error("mock fail")}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(2);t.Tag=class{constructor(e,t,s,n,r){this.frq=1,this.raw=e,this.flag=t,this.key=s,this.separator=void 0!==n?n:null,this.val=void 0!==r?r:null,this.clean=this.cleanTagString(this.raw),this.cleanKey=this.cleanTagString(this.key),this.cleanVal=null!==this.val?this.cleanTagString(this.val):null}renderKey(){return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+(this.separator?this.separator:"")+'\')" class="'+(this.separator?"tagKey":null===this.val?"simpleTag":"roundTagVal")+'">'+this.flag+this.key+"</span>"}renderVal(e){var t;return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+this.separator+(null===(t=this.cleanVal)||void 0===t?void 0:t.replace(/'/,"\\'"))+'\')" class="'+(e?"roundTagVal":"tagVal")+'">'+(e?"":this.separator)+(this.val||"")+"</span>"}render(e){return this.separator?e?this.renderVal(e):this.renderKey()+this.renderVal(e):this.renderKey()}cleanTagString(e){return e=(e=(e=n.escapeHtml(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(3);t.getTestMode=function(){let e=new URL(window.location.href);if("/demo"===e.pathname)return n.TestMode.DEMO;let t=e.searchParams.get("test");return null!==t&&(s=t,Object.values(n.TestMode).includes(s))?t:n.TestMode.OFF;var s}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0);class o extends Error{constructor(e,t){super(e),this.friendlyMessage=t,i.journal.errors.push(t),console.warn(e),r.default.redraw()}}t.FriendlyError=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCaretPosition=function(e){var t=window.getSelection(),s=[0,0];if(t.anchorNode==e)s=[t.anchorNode.innerText.length,t.extentNode.innerText.length];else{var n=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var r,i=[0,0];!function e(t,s){var n=s(t);for(t=t.firstChild;!1!==n&&t;t=t.nextSibling)n=e(t,s)}(e,(function(e){for(r=0;r<2;r++)if(e==n[r]&&(i[r]=1,i[0==r?1:0]))return;if(e.textContent&&!e.firstChild)for(r=0;r<2;r++)i[r]||(s[r]+=e.textContent.length)})),s[0]+=t.anchorOffset,s[1]+=t.extentOffset}return s[0]<=s[1]?s:[s[1],s[0]]},t.setCaretPosition=function e(t,s){if(null!==t&&null!==s){for(var n of t.childNodes)if(3==n.nodeType){if(n.length>=s){let e=document.createRange(),t=window.getSelection();return e.setStart(n,s),e.collapse(!0),t.removeAllRanges(),t.addRange(e),-1}s-=n.length}else if(-1==(s=e(n,s)))return-1;return s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagPattern=/(\@)([\w-']+)+(:)?([\w-'\*]+)?/g,t.spreadsheetIdPattern=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/g},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setStoredSpreadsheetId=function(e){localStorage.setItem("spreadsheetId",e)},t.getStoredSpreadsheetId=function(){return localStorage.getItem("spreadsheetId")||void 0},t.setStoredSpreadsheetUrls=function(e){localStorage.setItem("spreadsheetUrls",e)},t.getStoredSpreadsheetUrls=function(){return localStorage.getItem("spreadsheetUrls")||void 0},t.setStoredHideEntriesKeys=function(e){localStorage.setItem("hideEntriesKeys",e?"1":"0")},t.getStoredHideEntriesKeys=function(){return"1"===localStorage.getItem("hideEntriesKeys")},t.setStoredHideTagRefines=function(e){localStorage.setItem("hideTagRefines",e?"1":"0")},t.getStoredHideTagRefines=function(){return"1"===localStorage.getItem("hideTagRefines")},t.getStoredSpreadsheetSheetId=function(e){let t=localStorage.getItem(e+"-sheetId")||void 0;return void 0!==t?parseInt(t):void 0},t.setStoredSpreadsheetSheetId=function(e,t){localStorage.setItem(e+"-sheetId",t.toString())},t.delStoredSpreadsheetSheetId=function(e){localStorage.removeItem(e+"-sheetId")}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(16),r=s(2);t.Entry=class{constructor(e,t){this.tags=new Map,this.hovered=!1,this.focused=!1,this.clean="",this.tokens=[],this.rendered="",this.savedClean="",this.tagMatches=[],this.readableRendered="",this.rawText="",this.savedText="",this.raw=e||"",this.saved=void 0!==t?t:this.raw}get saved(){return this.savedText}set saved(e){this.savedText=e,this.savedClean=e.toLowerCase(),this.tags=this.getTags(this.tagMatches)}get raw(){return this.rawText}set raw(e){this.rawText=e,this.clean=this.raw.toLowerCase();let t=r.escapeHtml(this.rawText);this.tokens=this.getTokens(this.clean),this.tagMatches=this.getTagMatches(t),this.rendered=this.render(t,this.tagMatches),this.readableRendered=this.render(t,this.tagMatches,!0)}render(e,t,s){for(let{tag:n,match:r}of t){let t=e.split("");t.splice(r.index,r[0].length,n.render(s)),e=t.join("")}return e}getTags(e){let t=new Map;for(let{tag:s}of e)t.has(s.clean)?t.get(s.clean).frq+=1:t.set(s.clean,s);return t}getTagMatches(e){let t=[],s=e.matchAll(r.tagPattern);for(let e of s){let s=new n.Tag(e[0],e[1],e[2],e[3],e[4]);t.push({tag:s,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}getTokens(e){return e.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(4),i=s(0);t.Sheet=class{constructor(e,t,s){this.entries=[],this.id=e,this.title=t,this.spreadsheet=s,s.sheets.set(this.id,this),i.syncer.getRows(this.spreadsheet.id,this.id,this.title)}load(e){return n(this,void 0,void 0,(function*(){e.map(e=>this.entries.push(new r.Entry(e))),i.journal.switch()}))}get tags(){let e=new Map;for(let t of Array.from(this.entries.values()).reverse())for(let[s,n]of t.tags)e.has(s)?e.get(s).frq+=n.frq:e.set(s,new r.Tag(n.raw,n.flag,n.key,n.separator,n.val));return e}}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0),o=s(2),a=s(3),u=s(5);t.Syncer=class{constructor(e){this.paused=!1,this.user=null,this.worker=new Worker("./js/syncWebWorker.js"),this.updateTestMode(e),this.worker.onmessage=e=>this.onMessage(e)}updateTestMode(e){this.pushSyncerTask({testMode:e,type:a.SyncerTaskType.TEST_MODE_UPDATE})}updateAuth(e){this.pushSyncerTask({token:e,type:a.SyncerTaskType.AUTH_UPDATE})}getSheets(e){this.pushSyncerTask({spreadsheetId:e,type:a.SyncerTaskType.GET_SHEETS})}getRows(e,t,s){this.pushSyncerTask({spreadsheetId:e,sheetId:t,sheetTitle:s,type:a.SyncerTaskType.GET_ROWS})}deleteRow(e,t,s){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,type:a.SyncerTaskType.DELETE_ROW})}updateRow(e,t,s,n,r){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,sheetTitle:n,content:r,type:a.SyncerTaskType.UPDATE_ROW})}unpause(){this.pushSyncerTask({type:a.SyncerTaskType.UNPAUSE})}pushSyncerTask(e){this.worker.postMessage(e)}onMessage(e){let t=e.data;u.instanceOfQueueStateResponse(t)?(t.paused&&!i.syncer.paused?(i.syncer.paused=!0,r.default.redraw()):!t.paused&&i.syncer.paused&&(i.syncer.paused=!1,r.default.redraw()),i.journal.loading!==t.length>0&&(i.journal.loading=t.length>0,r.default.redraw())):u.instanceOfSheetsResponse(t)?i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).load(t.sheets):u.instanceOfRowsResponse(t)?i.journal.spreadsheets.has(t.spreadsheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.has(t.sheetId)&&i.journal.spreadsheets.get(t.spreadsheetId).sheets.get(t.sheetId).load(t.rows):u.instanceOfErrorResponse(t)?(i.syncer.paused=!0,new o.FriendlyError(t.error.message,"Unable to sync")):u.instanceOfReauthResponse(t)&&null!==i.syncer.user&&i.syncer.user.reloadAuthResponse().then(e=>{i.syncer.updateAuth(e.access_token)}).catch(e=>{new o.FriendlyError(e,"You're signed out and need to sign back in.")})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(0),r=s(4),i=s(3);t.Search=class{constructor(){this.barQuery=new r.Entry(""),this.searchType=i.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}get query(){return new r.Entry([this.barQuery.raw,...Array.from(this.refinesQuery.keys.values()),...Array.from(this.refinesQuery.vals.keys()),...Array.from(this.refinesQuery.simpleKeys.keys())].join(" "))}reset(){this.barQuery=new r.Entry(""),this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}entries(){let e=null;return 0===this.query.tokens.length?this.searchType=i.SearchType.NONE:(this.searchType=i.SearchType.AND,e=this.search(),0===e.length&&(this.searchType=i.SearchType.OR,e=this.search())),e}search(){let e=this.query,t=[],s=n.journal.spreadsheet.sheet.entries;for(let[n,r]of s.entries())switch(this.searchType){case i.SearchType.AND:e.tokens.every(e=>this.match(e,r))&&t.push({idx:n,entry:r});break;case i.SearchType.OR:e.tokens.some(e=>this.match(e,r))&&t.push({idx:n,entry:r})}return t}match(e,t){return e.startsWith("-@")&&!e.endsWith(":")?void 0===t.tags.get(e.substring(1)):e.startsWith("-")?!t.savedClean.includes(e.substring(1)):e.startsWith("@")&&!e.endsWith(":")?void 0!==t.tags.get(e):t.savedClean.includes(e)}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(1)),o=s(4),a=s(0),u=s(2);t.Journal=class{constructor(){this.errors=[],this.loading=!1,this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}load(e){return n(this,void 0,void 0,(function*(){this.hideTagRefines=u.getStoredHideTagRefines(),this.hideEntriesKeys=u.getStoredHideEntriesKeys();let t=this.getSpreadsheetIdsFromUrls(e);yield this.loadNewSpreadsheets(t),yield this.removeOldSpreadsheets(t),this.switch()}))}unload(){this.removeOldSpreadsheets([]),this.errors=[],this.loading=!1,this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}get isActive(){return null!==this.spreadsheet&&null!==this.spreadsheet.sheet&&this.isSignedIn}switch(e,t){var s,n,r;void 0!==e&&void 0!==t&&(null===(s=this.spreadsheet)||void 0===s?void 0:s.id)===e&&(null===(r=null===(n=this.spreadsheet)||void 0===n?void 0:n.sheet)||void 0===r?void 0:r.id)===t||(void 0===e&&void 0===t&&(e=u.getStoredSpreadsheetId(),t=u.getStoredSpreadsheetSheetId(e)),a.search.reset(),this.spreadsheet=void 0!==e&&this.spreadsheets.has(e)?this.spreadsheets.get(e):Array.from(this.spreadsheets.values())[0]||null,null!==this.spreadsheet&&(u.setStoredSpreadsheetId(this.spreadsheet.id),this.spreadsheet.sheet=void 0!==t&&this.spreadsheet.sheets.has(t)?this.spreadsheet.sheets.get(t):Array.from(this.spreadsheet.sheets.values())[0]||null,null!==this.spreadsheet.sheet&&u.setStoredSpreadsheetSheetId(this.spreadsheet.id,this.spreadsheet.sheet.id)),i.default.redraw())}loadNewSpreadsheets(e){return n(this,void 0,void 0,(function*(){for(let t of e.filter(e=>!this.spreadsheets.get(e)).sort(e=>e===u.getStoredSpreadsheetId()?-1:1))new o.Spreadsheet(t)}))}removeOldSpreadsheets(e){return n(this,void 0,void 0,(function*(){for(let[t]of Array.from(this.spreadsheets).filter(([t])=>!e.includes(t)))if(u.delStoredSpreadsheetSheetId(t),this.spreadsheet===this.spreadsheets.get(t)&&(this.spreadsheet=null),this.spreadsheets.has(t)){for(let[e]of this.spreadsheets.get(t).sheets)this.spreadsheets.get(t).sheets.delete(e);this.spreadsheets.delete(t)}}))}getSpreadsheetIdsFromUrls(e){if(!e)return[];let t=[],s=e.matchAll(u.spreadsheetIdPattern);for(let e of s)e&&t.push(e[1]);return t}deleteEntry(e){return n(this,void 0,void 0,(function*(){a.syncer.deleteRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id),this.spreadsheet.sheet.entries.splice(e,1)[0]}))}saveEntry(e){return n(this,void 0,void 0,(function*(){let t=this.spreadsheet.sheet.entries[e];t.raw!==t.saved&&(a.syncer.updateRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id,this.spreadsheet.sheet.title,t.raw),t.saved=t.raw)}))}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(4),i=s(0),o=s(2);t.Spreadsheet=class{constructor(e){this.id=e,this.sheet=null,this.sheets=new Map,i.journal.spreadsheets.set(e,this),i.syncer.getSheets(e)}load(e){return n(this,void 0,void 0,(function*(){for(let t of e.sort(e=>{var t;return(null===(t=e.properties)||void 0===t?void 0:t.sheetId)===o.getStoredSpreadsheetSheetId(this.id)?-1:1}))void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.properties.sheetId&&new r.Sheet(t.properties.sheetId,t.properties.title,this)}))}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=s(2);t.ServiceWorker=class{constructor(){if(!("serviceWorker"in navigator))throw new r.FriendlyError("serviceWorker not supported","Your browser is not supported.");window.addEventListener("load",()=>n(this,void 0,void 0,(function*(){yield navigator.serviceWorker.register("../serviceWorker.js")})))}}},function(e,t,s){"use strict";function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(31)),n(s(32)),n(s(33)),n(s(34)),n(s(35)),n(s(36)),n(s(37)),n(s(38))},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0);t.refines=function(){const e=new Set;function t(){const{simple:e}=u();return r.default(".tagRefineWrap",0===e.size?[]:[n("Simple Tags",e.size),Array.from(e,([e,t])=>[o(e,t)])])}function s(){const{complex:e}=u();return Array.from(e,([e,t])=>r.default(".tagRefineWrap",[n(e,t.length),t.map(t=>[o(e,t)])]))}function n(t,s){return r.default("span",function(t){return{class:"roundTagKey",onclick:s=>function(t,s){if(t.metaKey||t.ctrlKey){if("Simple Tags"===s)return;i.search.refinesQuery.keys.has(s)?i.search.refinesQuery.keys.delete(s):i.search.refinesQuery.keys.add(s)}else e.has(s)?e.delete(s):e.add(s)}(s,t)}}(t),["Simple Tags"===t?[]:r.default("input",{type:"checkbox",checked:i.search.refinesQuery.keys.has(t)}),e.has(t)?r.default("span","▾ "):r.default("span","▿ "),r.default("span",t),r.default("span",` (${s})`)])}function o(e,t){return r.default("div",{class:"tagRefineValWrap"},[r.default("span",a(e,t),[r.default("input",{type:"checkbox",checked:null===t.val?i.search.refinesQuery.simpleKeys.has(t.clean):i.search.refinesQuery.vals.has(t.clean)}),null!==t.val?r.default("span",""+t.cleanVal):r.default("span",`${t.flag}${t.cleanKey}`),r.default("span",` (${t.frq})`)])])}function a(t,s){let n=null===s.val?"simpleTag":"roundTagVal",r="hide";return(null===s.val&&e.has("Simple Tags")||e.has(t)||i.search.refinesQuery.vals.has(s.clean))&&(r=""),{class:`${n} ${r}`,onclick:()=>function(e){null===e.val?i.search.refinesQuery.simpleKeys.has(e.clean)?i.search.refinesQuery.simpleKeys.delete(e.clean):i.search.refinesQuery.simpleKeys.set(e.clean,e):i.search.refinesQuery.vals.has(e.clean)?i.search.refinesQuery.vals.delete(e.clean):i.search.refinesQuery.vals.set(e.clean,e)}(s)}}function u(){let e=new Map,t=new Map;for(let s of i.journal.spreadsheet.sheet.tags.values())if(null===s.val){let t=`${s.flag}${s.cleanKey}`;e.has(t)||e.set(t,s)}else{let e=`${s.flag}${s.cleanKey}${s.separator}`;t.has(e)||t.set(e,[]),t.get(e).push(s)}for(let[t]of i.search.refinesQuery.simpleKeys)e.has(t)||i.search.refinesQuery.simpleKeys.delete(t);for(let e of i.search.refinesQuery.keys)t.has(e)||i.search.refinesQuery.keys.delete(e);for(let[e]of i.search.refinesQuery.vals)Array.from(t.values()).some(t=>t.some(t=>t.clean===e))||i.search.refinesQuery.vals.delete(e);return{simple:new Map([...e.entries()]),complex:new Map([...t.entries()].sort())}}return{view:function(){return i.journal.hideTagRefines?[]:r.default("#tagsWrap",r.default("#tags",[r.default(".tempguidancePre","Tags"),t(),s()]))}}}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0);t.errors=function(){function e(e){return{class:"dismissErrorButton",onclick:()=>i.journal.errors.splice(e,1)}}return{view:function(){return 0===i.journal.errors.length?[]:r.default("#errors",i.journal.errors.map((t,s)=>[r.default(".error",[r.default("span",t),r.default("button",e(s),"dismiss")])]))}}}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0);t.spinner=function(){function e(){if(i.journal.loading&&!i.syncer.paused)return r.default(".spinner",[r.default("div"),r.default("div"),r.default("div"),r.default("div")])}function t(){if(i.syncer.paused)return r.default("button",{id:"unpauseSync",onclick:()=>i.syncer.unpause()},"Unpause Syncing")}return{view:function(){return r.default("#spinner",[e(),t()])}}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(1)),o=s(0),a=s(4),u=s(2);t.compose=function(){var e={el:null,pos:null};const t=new a.Entry(""),s=new a.Entry(""),r=new a.Entry(""),d={placeholder:"Static Entry Prefix"},l={placeholder:"Entry Content"},c={placeholder:"Static Entry Suffix"};function h(t,r){let d={contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>n(this,void 0,void 0,(function*(){return yield function(e){return n(this,void 0,void 0,(function*(){if(13==e.keyCode&&!e.shiftKey){e.preventDefault();let t=[document.getElementById("prefix"),document.getElementById("content"),document.getElementById("suffix")].map(e=>e.innerText).join("");s.raw="";let n=new a.Entry(t,""),r=o.journal.spreadsheet.sheet.entries.length;o.journal.spreadsheet.sheet.entries.push(n),i.default.redraw(),yield o.journal.saveEntry(r),i.default.redraw()}}))}(e)})),oninput:s=>function(t,s){let n=u.getCaretPosition(t.target);e=n?{pos:n[1],el:t.target}:{pos:null,el:null},s.raw=t.target.innerText}(s,t),onupdate:()=>(u.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null}))};return Object.assign(d,r)}return{view:function(){return i.default("#compose",[i.default("#prefix",h(t,d),i.default.trust(t.rendered)),i.default("#content",h(s,l),i.default.trust(s.rendered)),i.default("#suffix",h(r,c),i.default.trust(r.rendered))])}}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(1)),o=s(0),a=s(2);t.entries=function(){var e={pos:null,el:null};function t(){let e=o.search.entries();return null!==e?e.map(({idx:e,entry:t})=>s(e,t)):Array.from(o.journal.spreadsheet.sheet.entries.entries()).map(([e,t])=>s(e,t))}function s(e,t){return i.default(".entryWrap",{id:"entry-"+e},[u(t,e),r(e)])}function r(e){return i.default("button",{class:"del",onclick:()=>n(this,void 0,void 0,(function*(){yield o.journal.deleteEntry(e),i.default.redraw()}))},"del")}function u(t,s){return i.default("div",function(t,s){return{id:`entry-${s}-content`,contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e),oninput:s=>function(t,s){let n=a.getCaretPosition(t.target);e={pos:n?n[1]:null,el:t.target},s.raw=t.target.innerText}(s,t),onupdate:()=>(a.setCaretPosition(e.el,e.pos),void(e={pos:null,el:null})),onblur:()=>function(e,t){return n(this,void 0,void 0,(function*(){e.focused=!1,yield o.journal.saveEntry(t),i.default.redraw()}))}(t,s),onmouseover:()=>function(e){e.hovered=!0}(t),onmouseout:()=>function(e){e.hovered=!1}(t),onfocus:()=>function(e){e.focused=!0}(t)}}(t,s),i.default.trust(t.hovered||t.focused||!o.journal.hideEntriesKeys?t.rendered:t.readableRendered))}return{view:function(){return i.default("#entries",[i.default(".tempguidancePre","Entries"),t()])}}}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0),o=s(2);t.toggles=function(){return{view:function(){return[r.default("#hideEntriesKeysToggle",[r.default("label",{for:"hideEntriesCheckbox"},"Tag keys:"),r.default("input#hideEntriesCheckbox",{type:"checkbox",checked:!o.getStoredHideEntriesKeys(),disabled:i.journal.entryInFocus,onclick:()=>{i.journal.hideEntriesKeys=!i.journal.hideEntriesKeys,o.setStoredHideEntriesKeys(i.journal.hideEntriesKeys)}})]),r.default("#hideTagRefinesToggle",[r.default("label",{for:"hideTagRefinesCheckbox"},"Tag refines:"),r.default("input#hideTagRefinesCheckbox",{type:"checkbox",checked:!i.journal.hideTagRefines,onclick:()=>{i.journal.hideTagRefines=!i.journal.hideTagRefines,o.setStoredHideTagRefines(i.journal.hideTagRefines)}})])]}}}},function(e,t,s){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(s(1)),i=s(0),o=s(2);t.searchbar=function(){var e={el:null,pos:null};return{view:function(){return r.default("#search",[r.default("#searchQuery",{placeholder:"Search for text or tags",contenteditable:"true",class:"entry breakwrap",oninput:t=>function(t){let s=o.getCaretPosition(t.target);e=s?{pos:s[1],el:t.target}:{pos:null,el:null},i.search.barQuery.raw=o.escapeHtml(t.target.innerText)}(t),onupdate:()=>(o.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null})),onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e)},r.default.trust(i.search.barQuery.rendered)),r.default("button",{id:"clearSearch",class:"del",onclick:()=>i.search.barQuery.raw=""},"x")])}}}},function(e,t,s){"use strict";var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(r,i){function o(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}u((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(1)),o=s(13),a=s(3),u=s(0),d=s(2),l=["https://www.googleapis.com/auth/spreadsheets"].join(" ");t.googleAPI=function(){var e;function t(){e.auth2.init({scope:l,client_id:"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(s),s(e.auth2.getAuthInstance().isSignedIn.get())})}function s(t){return n(this,void 0,void 0,(function*(){if(u.journal.isSignedIn=t,i.default.redraw(),u.journal.isSignedIn){let t=e.auth2.getAuthInstance().currentUser.get();u.syncer.user=t;let s=t.getAuthResponse();u.syncer.updateAuth(s.access_token),yield function(){return n(this,void 0,void 0,(function*(){let e=d.getStoredSpreadsheetUrls();yield u.journal.load(e)}))}()}else u.journal.unload()}))}function r(){return i.default("button",{id:"addSpreadsheet",onclick:()=>n(this,void 0,void 0,(function*(){if(u.journal.showAddSpreadsheetTextbox=!u.journal.showAddSpreadsheetTextbox,!u.journal.showAddSpreadsheetTextbox){let e=d.getStoredSpreadsheetUrls();yield u.journal.load(e)}}))},u.journal.showAddSpreadsheetTextbox?" ✓ ":"+/-")}return{view:function(){return u.testMode===a.TestMode.DEMO?(u.journal.isSignedIn=!0,u.journal.load("https://docs.google.com/spreadsheets/d/demo/edit"),[]):i.default("#googleApi",[u.journal.showAddSpreadsheetTextbox?[i.default("textarea",{id:"spreadsheetURLs",placeholder:"Enter list of Google Sheets Spreadsheet URLs here",value:d.getStoredSpreadsheetUrls(),oninput:e=>d.setStoredSpreadsheetUrls(e.target.value)}),i.default("br")]:[],u.journal.isSignedIn?r():[],null!==u.journal.spreadsheet?i.default("select",{onchange:e=>{let t=e.target.value;u.journal.switch(t,d.getStoredSpreadsheetSheetId(t))},id:"spreadsheetSelect"},[Array.from(u.journal.spreadsheets).map(([e])=>[i.default("option",{value:e,selected:u.journal.spreadsheet.id===e},e.substr(e.length-6))])]):[],u.journal.isActive?i.default("select",{onchange:e=>{u.journal.switch(u.journal.spreadsheet.id,parseInt(e.target.value)),i.default.redraw()},id:"sheetSelect"},[Array.from(u.journal.spreadsheet.sheets).map(([e,t])=>[i.default("option",{value:e,selected:u.journal.isActive&&u.journal.spreadsheet.sheet.id===e},t.title)])]):[],u.journal.isSignedIn?i.default("button",{onclick:()=>{u.testMode===a.TestMode.RETURN_ROWS&&u.journal.unload(),e.auth2.getAuthInstance().signOut()},class:"authButton"},"Sign Out"):i.default("button",{onclick:()=>e.auth2.getAuthInstance().signIn(),class:"authButton"},"Sign In"),i.default("script",{async:!0,defer:!0,src:"https://apis.google.com/js/api.js",onload:()=>{(e=u.testMode===a.TestMode.OFF?gapi:new o.MockGapi).load("auth2",t)}})])}}}}]);
//# sourceMappingURL=dntd.js.map