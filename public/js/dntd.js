!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(2),i=s(9),o=s(39),u=s(4);t.serviceWorker=new u.ServiceWorker,t.testMode=a.getTestMode(),t.syncer=new u.Syncer,t.search=new u.Search,t.refines=new o.Refines,t.journal=new u.Journal;let l=document.getElementById("root");null!==l&&n.default.route(l,"/",{"/":i.app,"/demo":i.app,"/about":i.about})},function(e,t){e.exports=m},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(15)),r(s(16)),r(s(17)),r(s(18)),r(s(19)),r(s(20))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(5)),r(s(6)),r(s(7)),r(s(8))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(13);t.Tag=r.Tag;var n=s(27);t.Entry=n.Entry;var a=s(28);t.Sheet=a.Sheet;var i=s(29);t.Syncer=i.Syncer;var o=s(30);t.Search=o.Search;var u=s(31);t.Journal=u.Journal;var l=s(32);t.Spreadsheet=l.Spreadsheet;var d=s(33);t.ServiceWorker=d.ServiceWorker},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE"}(t.SyncerTaskType||(t.SyncerTaskType={}))},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROWS=0]="ROWS",e[e.SHEETS=1]="SHEETS",e[e.SYNCER_STATE=2]="SYNCER_STATE",e[e.ERROR=3]="ERROR",e[e.REAUTH=4]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done"}(t.SyncerState||(t.SyncerState={}))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(21)),r(s(22)),r(s(23)),r(s(24)),r(s(25)),r(s(26)),r(s(34)),r(s(35)),r(s(36)),r(s(37)),r(s(38))},function(e,t,s){"use strict";function r(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),r(s(11)),r(s(12))},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.MockGapi=class{constructor(){this.auth2=new n}load(e,t){t()}};class n{getAuthInstance(){return new o}init(e){return r(this,void 0,void 0,(function*(){}))}}class a{get(){return new i}}class i{getAuthResponse(){return{expires_in:9999,access_token:"faketoken"}}reloadAuthResponse(){return r(this,void 0,void 0,(function*(){return{expires_in:9999,access_token:"faketoken"}}))}}t.MockGoogleUser=i;class o{constructor(){this.isSignedIn=new u,this.currentUser=new a}signOut(){}signIn(){}}class u{constructor(){this.listen=e=>{},this.get=()=>!0}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(3);t.SyncerTasksMock=class{constructor(e){this.testMode=e,this.extendSheetLength=100}getSheets(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_GET_SPREADSHEET_SHEETS)throw new Error("mock fail");return[{properties:{sheetId:0,title:"Sheet1",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}},{properties:{sheetId:1,title:"Sheet2",index:0,sheetType:"GRID",gridProperties:{rowCount:100,columnCount:26}}}]}))}getRows(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_GET_RANGE)throw new Error("mock fail");return this.testMode===n.TestMode.RETURN_ROWS?["aaa","bbb","ccc","@tag","@key:value"]:[]}))}updateRow(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_UPDATE_RANGE)throw new Error("mock fail")}))}deleteRow(e,t){return r(this,void 0,void 0,(function*(){if(this.testMode===n.TestMode.FAIL_DELETE_ROW)throw new Error("mock fail")}))}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(2);t.Tag=class{constructor(e,t,s,r,n){this.frq=1,this.raw=e,this.flag=t,this.key=s,this.separator=void 0!==r?r:null,this.val=void 0!==n?n:null,this.clean=this.cleanTagString(this.raw),this.cleanKey=this.cleanTagString(this.key),this.cleanVal=null!==this.val?this.cleanTagString(this.val):null}renderKey(){return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+(this.separator?this.separator:"")+'\')" class="'+(this.separator?"tagKey":null===this.val?"simpleTag":"roundTagVal")+'">'+this.flag+this.key+"</span>"}renderVal(e){var t;return"<span onclick=\"tagOnClick(event, '"+this.flag+this.cleanKey+this.separator+(null===(t=this.cleanVal)||void 0===t?void 0:t.replace(/'/,"\\'"))+'\')" class="'+(e?"roundTagVal":"tagVal")+'">'+(e?"":this.separator)+(this.val||"")+"</span>"}render(e){return this.separator?e?this.renderVal(e):this.renderKey()+this.renderVal(e):this.renderKey()}cleanTagString(e){return e=(e=(e=r.escapeHtml(e)).endsWith("'s")?e.substring(0,e.length-2):e).toLowerCase()}}},,function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(3);t.getHash=function(){return new URL(window.location.href).hash},t.getTestMode=function(){let e=new URL(window.location.href);if("#!demo"===e.hash)return r.TestMode.DEMO;let t=e.searchParams.get("test");return null!==t&&(s=t,Object.values(r.TestMode).includes(s))?t:r.TestMode.OFF;var s}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0);class i extends Error{constructor(e,t){super(e),this.friendlyMsg=t,a.journal.errors.push(t),console.warn(e),n.default.redraw()}}t.FriendlyError=i},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.escapeHtml=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCaretPosition=function(e){var t=window.getSelection(),s=[0,0];if(t.anchorNode==e)s=[t.anchorNode.innerText.length,t.extentNode.innerText.length];else{var r=[t.anchorNode,t.extentNode];if(!e.contains(t.anchorNode)||!e.contains(t.extentNode))return;var n,a=[0,0];!function e(t,s){var r=s(t);for(t=t.firstChild;!1!==r&&t;t=t.nextSibling)r=e(t,s)}(e,(function(e){for(n=0;n<2;n++)if(e==r[n]&&(a[n]=1,a[0==n?1:0]))return;if(e.textContent&&!e.firstChild)for(n=0;n<2;n++)a[n]||(s[n]+=e.textContent.length)})),s[0]+=t.anchorOffset,s[1]+=t.extentOffset}return s[0]<=s[1]?s:[s[1],s[0]]},t.setCaretPosition=function e(t,s){if(null!==t&&null!==s){for(var r of t.childNodes)if(3==r.nodeType){if(r.length>=s){let e=document.createRange(),t=window.getSelection();return e.setStart(r,s),e.collapse(!0),t.removeAllRanges(),t.addRange(e),-1}s-=r.length}else if(-1==(s=e(r,s)))return-1;return s}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tagPattern=/(\@)([\w-']+)+(:)?([\w-'\*]+)?/g,t.spreadsheetIdPattern=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/g},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setStoredSpreadsheetId=function(e){localStorage.setItem("spreadsheetId",e)},t.getStoredSpreadsheetId=function(){return localStorage.getItem("spreadsheetId")||void 0},t.setStoredSpreadsheetUrls=function(e){localStorage.setItem("spreadsheetUrls",e)},t.getStoredSpreadsheetUrls=function(){return localStorage.getItem("spreadsheetUrls")||void 0},t.setStoredHideEntriesKeys=function(e){localStorage.setItem("hideEntriesKeys",e?"1":"0")},t.getStoredHideEntriesKeys=function(){return"1"===localStorage.getItem("hideEntriesKeys")},t.setStoredHideTagRefines=function(e){localStorage.setItem("hideTagRefines",e?"1":"0")},t.getStoredHideTagRefines=function(){return"1"===localStorage.getItem("hideTagRefines")},t.getStoredSpreadsheetSheetId=function(e){let t=localStorage.getItem(e+"-sheetId")||void 0;return void 0!==t?parseInt(t):void 0},t.setStoredSpreadsheetSheetId=function(e,t){localStorage.setItem(e+"-sheetId",t.toString())},t.delStoredSpreadsheetSheetId=function(e){localStorage.removeItem(e+"-sheetId")}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(9),o=s(2);t.app=function(){return{view:function(){return["#!"===o.getHash()?null:n.default(i.links),n.default(i.spinner),n.default(i.googleAPI),n.default("#errorsWrap",n.default(i.errors)),a.journal.isActive?[n.default("#searchWrap",[n.default(i.searchbar),n.default(i.toggles)]),n.default(i.refinesPane),n.default("#entriesWrap",{class:a.journal.hideTagRefines?"fullWidth":""},[n.default(i.entries),n.default(i.compose)])]:[]]}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(3),o=s(2);t.links=function(){return{view:function(){let e=[];return"#!about"!==o.getHash()&&e.push(n.default("a",{href:"/#!about"},"About")),"#!demo"!==o.getHash()&&e.push(n.default("a",{href:"/#!demo",onclick:()=>a.syncer.updateTestMode(i.TestMode.DEMO)},"Demo")),"#!"!==o.getHash()&&e.push(n.default("a",{href:"/#!",onclick:()=>a.syncer.updateTestMode(i.TestMode.OFF)},"Start")),n.default("#navLinks",function(e){let t=[];for(let[s,r]of e.entries())t.push(r),s!==e.length-1&&t.push(" | ");return t}(e))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(9);t.about=function(){return{view:function(){return n.default("#callToAction",[n.default(a.links),n.default("#about","About page will be filled when the visual overhaul is complete.")])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0);t.errors=function(){function e(e){return{class:"dismissErrorButton",onclick:()=>a.journal.errors.splice(e,1)}}return{view:function(){return 0===a.journal.errors.length?[]:n.default("#errors",a.journal.errors.map((t,s)=>[n.default(".error",[n.default("span",t),n.default("button",e(s),"dismiss")])]))}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(3);t.spinner=function(){function e(){let e="",t="syncState";switch(a.syncer.state){case i.SyncerState.DOWNLOADING:e="Downloading journal data from drive...";break;case i.SyncerState.PAUSED:t+=" warn",e="Warning! - Syncing is paused.";break;case i.SyncerState.SYNCED:e="All changes saved.";break;case i.SyncerState.UPLOADING:e="Uploading changes to drive..."}return n.default("span",{id:"syncStateText",class:t},e)}function t(){let e=a.syncer.state===i.SyncerState.PAUSED?"material-icons material-icons-outlined syncState warn":"material-icons material-icons-outlined syncState md-dark";return n.default("i",{id:"syncStateIcon",class:e},a.syncer.state)}function s(){if(a.syncer.state===i.SyncerState.PAUSED)return n.default("button",{id:"unpauseSync",class:"syncState",onclick:()=>a.syncer.unpause()},"Unpause Syncing")}return{view:function(){return n.default("#status",n.default("span",n.default("span",[t(),e(),s()])))}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(s(1)),i=s(0),o=s(4),u=s(2);t.compose=function(){var e={el:null,pos:null};const t=new o.Entry(""),s=new o.Entry(""),n=new o.Entry(""),l={placeholder:"Static Entry Prefix"},d={placeholder:"Entry Content"},c={placeholder:"Static Entry Suffix"};function h(t,n){let l={contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>r(this,void 0,void 0,(function*(){return yield function(e){return r(this,void 0,void 0,(function*(){if(13==e.keyCode&&!e.shiftKey){e.preventDefault();let t=[document.getElementById("prefix"),document.getElementById("content"),document.getElementById("suffix")].map(e=>e.innerText).join("");s.raw="";let r=new o.Entry(t,""),n=i.journal.spreadsheet.sheet.entries.length;i.journal.spreadsheet.sheet.entries.push(r),a.default.redraw(),yield i.journal.saveEntry(n)}}))}(e)})),oninput:s=>function(t,s){let r=u.getCaretPosition(t.target);e=r?{pos:r[1],el:t.target}:{pos:null,el:null},s.raw=t.target.innerText}(s,t),onupdate:()=>(u.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null}))};return Object.assign(l,n)}return{view:function(){return a.default("#compose",[a.default("#prefix",h(t,l),a.default.trust(t.rendered)),a.default("#content",h(s,d),a.default.trust(s.rendered)),a.default("#suffix",h(n,c),a.default.trust(n.rendered))])}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(13),n=s(2);t.Entry=class{constructor(e,t){this.tags=new Map,this.hovered=!1,this.focused=!1,this.clean="",this.tokens=[],this.rendered="",this.savedClean="",this.tagMatches=[],this.readableRendered="",this.rawText="",this.savedText="",this.raw=e||"",this.saved=void 0!==t?t:this.raw}get saved(){return this.savedText}set saved(e){this.savedText=e,this.savedClean=e.toLowerCase(),this.tags=this.getTags(this.tagMatches)}get raw(){return this.rawText}set raw(e){this.rawText=e,this.clean=this.raw.toLowerCase();let t=n.escapeHtml(this.rawText);this.tokens=this.getTokens(this.clean),this.tagMatches=this.getTagMatches(t),this.rendered=this.render(t,this.tagMatches),this.readableRendered=this.render(t,this.tagMatches,!0)}render(e,t,s){for(let{tag:r,match:n}of t){let t=e.split("");t.splice(n.index,n[0].length,r.render(s)),e=t.join("")}return e}getTags(e){let t=new Map;for(let{tag:s}of e)t.has(s.clean)?t.get(s.clean).frq+=1:t.set(s.clean,s);return t}getTagMatches(e){let t=[],s=e.matchAll(n.tagPattern);for(let e of s){let s=new r.Tag(e[0],e[1],e[2],e[3],e[4]);t.push({tag:s,match:e})}return t.sort((e,t)=>e.match.index>t.match.index?-1:1),t}getTokens(e){return e.split(" ").filter(e=>void 0!==e&&""!==e.trim()&&"-"!==e)}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(4),a=s(0);t.Sheet=class{constructor(e,t,s){this.entries=[],this.id=e,this.title=t,this.spreadsheet=s,s.sheets.set(this.id,this),a.syncer.getRows(this.spreadsheet.id,this.id,this.title)}load(e){return r(this,void 0,void 0,(function*(){e.map(e=>this.entries.push(new n.Entry(e))),a.journal.switch(),null!==a.journal.spreadsheet&&null!==a.journal.spreadsheet.sheet&&a.journal.spreadsheet.sheet.id===this.id&&a.refines.build()}))}get tags(){let e=new Map;for(let t of Array.from(this.entries.values()).reverse())for(let[s,r]of t.tags)e.has(s)?e.get(s).frq+=r.frq:e.set(s,new n.Tag(r.raw,r.flag,r.key,r.separator,r.val));return e}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(2),o=s(3);t.Syncer=class{constructor(){this.state=o.SyncerState.DOWNLOADING,this.user=null,this.worker=new Worker("./js/syncWebWorker.js"),this.updateTestMode(i.getTestMode()),this.worker.onmessage=e=>this.onMessage(e)}updateTestMode(e){this.pushSyncerTask({testMode:e,type:o.SyncerTaskType.TEST_MODE_UPDATE})}updateAuth(e){this.pushSyncerTask({token:e,type:o.SyncerTaskType.AUTH_UPDATE})}getSheets(e){this.pushSyncerTask({spreadsheetId:e,type:o.SyncerTaskType.GET_SHEETS})}getRows(e,t,s){this.pushSyncerTask({spreadsheetId:e,sheetId:t,sheetTitle:s,type:o.SyncerTaskType.GET_ROWS})}deleteRow(e,t,s){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,type:o.SyncerTaskType.DELETE_ROW})}updateRow(e,t,s,r,n){this.pushSyncerTask({idx:e,spreadsheetId:t,sheetId:s,sheetTitle:r,content:n,type:o.SyncerTaskType.UPDATE_ROW})}unpause(){this.pushSyncerTask({type:o.SyncerTaskType.UNPAUSE})}pushSyncerTask(e){this.worker.postMessage(e)}onMessage(e){let t=e.data;switch(t.type){case o.SyncerResponseType.SYNCER_STATE:t.state!==a.syncer.state&&(a.syncer.state=t.state,n.default.redraw());break;case o.SyncerResponseType.SHEETS:a.journal.spreadsheets.has(t.spreadsheetId)&&a.journal.spreadsheets.get(t.spreadsheetId).load(t.sheets);break;case o.SyncerResponseType.ROWS:a.journal.spreadsheets.has(t.spreadsheetId)&&a.journal.spreadsheets.get(t.spreadsheetId).sheets.has(t.sheetId)&&a.journal.spreadsheets.get(t.spreadsheetId).sheets.get(t.sheetId).load(t.rows);break;case o.SyncerResponseType.ERROR:new i.FriendlyError(t.error.message,"Sync Error - "+t.friendlyMsg);break;case o.SyncerResponseType.REAUTH:null!==a.syncer.user&&a.syncer.user.reloadAuthResponse().then(e=>{a.syncer.updateAuth(e.access_token)}).catch(e=>{new i.FriendlyError(e,"You're signed out and need to sign back in.")})}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0),n=s(4),a=s(3);t.Search=class{constructor(){this.barQuery=new n.Entry(""),this.searchType=a.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}get query(){return new n.Entry([this.barQuery.raw,...Array.from(this.refinesQuery.keys.values()),...Array.from(this.refinesQuery.vals.keys()),...Array.from(this.refinesQuery.simpleKeys.keys())].join(" "))}reset(){this.barQuery=new n.Entry(""),this.searchType=a.SearchType.NONE,this.refinesQuery={keys:new Set,vals:new Map,simpleKeys:new Map}}entries(){let e=null;return 0===this.query.tokens.length?this.searchType=a.SearchType.NONE:(this.searchType=a.SearchType.AND,e=this.search(),0===e.length&&(this.searchType=a.SearchType.OR,e=this.search())),e}search(){let e=this.query,t=[],s=r.journal.spreadsheet.sheet.entries;for(let[r,n]of s.entries())switch(this.searchType){case a.SearchType.AND:e.tokens.every(e=>this.match(e,n))&&t.push({idx:r,entry:n});break;case a.SearchType.OR:e.tokens.some(e=>this.match(e,n))&&t.push({idx:r,entry:n})}return t}match(e,t){return e.startsWith("-@")&&!e.endsWith(":")?void 0===t.tags.get(e.substring(1)):e.startsWith("-")?!t.savedClean.includes(e.substring(1)):e.startsWith("@")&&!e.endsWith(":")?void 0!==t.tags.get(e):t.savedClean.includes(e)}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(s(1)),i=s(4),o=s(0),u=s(2);t.Journal=class{constructor(){this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}load(e){return r(this,void 0,void 0,(function*(){this.hideTagRefines=u.getStoredHideTagRefines(),this.hideEntriesKeys=u.getStoredHideEntriesKeys();let t=this.getSpreadsheetIdsFromUrls(e);yield this.loadNewSpreadsheets(t),yield this.removeOldSpreadsheets(t)}))}unload(){this.removeOldSpreadsheets([]),this.errors=[],this.isSignedIn=!1,this.entryInFocus=!1,this.hideTagRefines=!1,this.hideEntriesKeys=!1,this.spreadsheet=null,this.showAddSpreadsheetTextbox=!1,this.spreadsheets=new Map}get isActive(){return null!==this.spreadsheet&&null!==this.spreadsheet.sheet&&this.isSignedIn}switch(e,t){var s,r,n;void 0!==e&&void 0!==t&&(null===(s=this.spreadsheet)||void 0===s?void 0:s.id)===e&&(null===(n=null===(r=this.spreadsheet)||void 0===r?void 0:r.sheet)||void 0===n?void 0:n.id)===t||(void 0===e&&void 0===t&&(e=u.getStoredSpreadsheetId(),t=u.getStoredSpreadsheetSheetId(e)),o.search.reset(),this.spreadsheet=void 0!==e&&this.spreadsheets.has(e)?this.spreadsheets.get(e):Array.from(this.spreadsheets.values())[0]||null,null!==this.spreadsheet&&(u.setStoredSpreadsheetId(this.spreadsheet.id),this.spreadsheet.sheet=void 0!==t&&this.spreadsheet.sheets.has(t)?this.spreadsheet.sheets.get(t):Array.from(this.spreadsheet.sheets.values())[0]||null,null!==this.spreadsheet.sheet&&u.setStoredSpreadsheetSheetId(this.spreadsheet.id,this.spreadsheet.sheet.id)),a.default.redraw())}loadNewSpreadsheets(e){return r(this,void 0,void 0,(function*(){for(let t of e.filter(e=>!this.spreadsheets.get(e)).sort(e=>e===u.getStoredSpreadsheetId()?-1:1))new i.Spreadsheet(t)}))}removeOldSpreadsheets(e){return r(this,void 0,void 0,(function*(){for(let[t]of Array.from(this.spreadsheets).filter(([t])=>!e.includes(t)))if(u.delStoredSpreadsheetSheetId(t),this.spreadsheet===this.spreadsheets.get(t)&&(this.spreadsheet=null),this.spreadsheets.has(t)){for(let[e]of this.spreadsheets.get(t).sheets)this.spreadsheets.get(t).sheets.delete(e);this.spreadsheets.delete(t)}}))}getSpreadsheetIdsFromUrls(e){if(!e)return[];let t=[],s=e.matchAll(u.spreadsheetIdPattern);for(let e of s)e&&t.push(e[1]);return t}deleteEntry(e){return r(this,void 0,void 0,(function*(){o.syncer.deleteRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id),this.spreadsheet.sheet.entries.splice(e,1)[0],o.refines.build(),a.default.redraw()}))}saveEntry(e){return r(this,void 0,void 0,(function*(){let t=this.spreadsheet.sheet.entries[e];t.raw!==t.saved&&(o.syncer.updateRow(e,this.spreadsheet.id,this.spreadsheet.sheet.id,this.spreadsheet.sheet.title,t.raw),t.saved=t.raw,o.refines.build(),a.default.redraw())}))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(4),a=s(0),i=s(2);t.Spreadsheet=class{constructor(e){this.id=e,this.sheet=null,this.sheets=new Map,a.journal.spreadsheets.set(e,this),a.syncer.getSheets(e)}load(e){return r(this,void 0,void 0,(function*(){for(let t of e.sort(e=>{var t;return(null===(t=e.properties)||void 0===t?void 0:t.sheetId)===i.getStoredSpreadsheetSheetId(this.id)?-1:1}))void 0!==t.properties&&void 0!==t.properties.title&&void 0!==t.properties.sheetId&&new n.Sheet(t.properties.sheetId,t.properties.title,this)}))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(2);t.ServiceWorker=class{constructor(){if(!("serviceWorker"in navigator))throw new n.FriendlyError("serviceWorker not supported","Your browser is not supported.");window.addEventListener("load",()=>r(this,void 0,void 0,(function*(){yield navigator.serviceWorker.register("../serviceWorker.js")})))}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(s(1)),i=s(0),o=s(2);t.entries=function(){var e={pos:null,el:null};function t(){let e=i.search.entries();return null!==e?e.map(({idx:e,entry:t})=>s(e,t)):Array.from(i.journal.spreadsheet.sheet.entries.entries()).map(([e,t])=>s(e,t))}function s(e,t){return a.default(".entryWrap",{id:"entry-"+e},[u(t,e),n(e)])}function n(e){return a.default("button",{class:"del",onclick:()=>r(this,void 0,void 0,(function*(){return yield i.journal.deleteEntry(e)}))},"del")}function u(t,s){return a.default("div",function(t,s){return{id:`entry-${s}-content`,contenteditable:"true",class:"entry breakwrap column",onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e),oninput:s=>function(t,s){let r=o.getCaretPosition(t.target);e={pos:r?r[1]:null,el:t.target},s.raw=t.target.innerText}(s,t),onupdate:()=>(o.setCaretPosition(e.el,e.pos),void(e={pos:null,el:null})),onblur:()=>function(e,t){return r(this,void 0,void 0,(function*(){e.focused=!1,yield i.journal.saveEntry(t)}))}(t,s),onmouseover:()=>function(e){e.hovered=!0}(t),onmouseout:()=>function(e){e.hovered=!1}(t),onfocus:()=>function(e){e.focused=!0}(t)}}(t,s),a.default.trust(t.hovered||t.focused||!i.journal.hideEntriesKeys?t.rendered:t.readableRendered))}return{view:function(){return a.default("#entries",[a.default(".tempguidancePre","Entries"),t()])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(2);t.toggles=function(){return{view:function(){return[n.default("#hideEntriesKeysToggle",[n.default("label",{for:"hideEntriesCheckbox"},"Tag keys:"),n.default("input#hideEntriesCheckbox",{type:"checkbox",checked:!i.getStoredHideEntriesKeys(),disabled:a.journal.entryInFocus,onclick:()=>{a.journal.hideEntriesKeys=!a.journal.hideEntriesKeys,i.setStoredHideEntriesKeys(a.journal.hideEntriesKeys)}})]),n.default("#hideTagRefinesToggle",[n.default("label",{for:"hideTagRefinesCheckbox"},"Tag refines:"),n.default("input#hideTagRefinesCheckbox",{type:"checkbox",checked:!a.journal.hideTagRefines,onclick:()=>{a.journal.hideTagRefines=!a.journal.hideTagRefines,i.setStoredHideTagRefines(a.journal.hideTagRefines)}})])]}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0),i=s(2);t.searchbar=function(){var e={el:null,pos:null};return{view:function(){return n.default("#search",[n.default("#searchQuery",{placeholder:"Search for text or tags",contenteditable:"true",class:"entry breakwrap",oninput:t=>function(t){let s=i.getCaretPosition(t.target);e=s?{pos:s[1],el:t.target}:{pos:null,el:null},a.search.barQuery.raw=i.escapeHtml(t.target.innerText)}(t),onupdate:()=>(i.setCaretPosition(e.el,e.pos),void(e={el:null,pos:null})),onkeydown:e=>function(e){13!=e.keyCode||e.shiftKey||(e.preventDefault(),e.target.blur())}(e)},n.default.trust(a.search.barQuery.rendered)),n.default("button",{id:"clearSearch",class:"del",onclick:()=>a.search.barQuery.raw=""},"x")])}}}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function o(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}u((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(s(1)),i=s(10),o=s(3),u=s(0),l=s(2),d=["https://www.googleapis.com/auth/spreadsheets"].join(" ");t.googleAPI=function(){var e;function t(){e.auth2.init({scope:d,client_id:"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com"}).then(()=>{e.auth2.getAuthInstance().isSignedIn.listen(s),s(e.auth2.getAuthInstance().isSignedIn.get())})}function s(t){return r(this,void 0,void 0,(function*(){if(u.journal.isSignedIn=t,a.default.redraw(),u.journal.isSignedIn){let t=e.auth2.getAuthInstance().currentUser.get();u.syncer.user=t;let s=t.getAuthResponse();u.syncer.updateAuth(s.access_token),yield function(){return r(this,void 0,void 0,(function*(){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}))}()}else u.journal.unload()}))}function n(){return a.default("button",{id:"addSpreadsheet",onclick:()=>r(this,void 0,void 0,(function*(){if(u.journal.showAddSpreadsheetTextbox=!u.journal.showAddSpreadsheetTextbox,!u.journal.showAddSpreadsheetTextbox){let e=l.getStoredSpreadsheetUrls();yield u.journal.load(e)}}))},u.journal.showAddSpreadsheetTextbox?" ✓ ":"+/-")}return{view:function(){return l.getTestMode()===o.TestMode.DEMO?(u.journal.isSignedIn=!0,u.journal.load("https://docs.google.com/spreadsheets/d/demo/edit"),[]):a.default("#googleApi",[u.journal.showAddSpreadsheetTextbox?[a.default("textarea",{id:"spreadsheetURLs",placeholder:"Enter list of Google Sheets Spreadsheet URLs here",value:l.getStoredSpreadsheetUrls(),oninput:e=>l.setStoredSpreadsheetUrls(e.target.value)}),a.default("br")]:[],u.journal.isSignedIn?n():[],null!==u.journal.spreadsheet?a.default("select",{onchange:e=>{let t=e.target.value;u.journal.switch(t,l.getStoredSpreadsheetSheetId(t))},id:"spreadsheetSelect"},[Array.from(u.journal.spreadsheets).map(([e])=>[a.default("option",{value:e,selected:u.journal.spreadsheet.id===e},e.substr(e.length-6))])]):[],u.journal.isActive?a.default("select",{onchange:e=>{u.journal.switch(u.journal.spreadsheet.id,parseInt(e.target.value)),a.default.redraw()},id:"sheetSelect"},[Array.from(u.journal.spreadsheet.sheets).map(([e,t])=>[a.default("option",{value:e,selected:u.journal.isActive&&u.journal.spreadsheet.sheet.id===e},t.title)])]):[],u.journal.isSignedIn?a.default("button",{onclick:()=>{l.getTestMode()===o.TestMode.RETURN_ROWS&&u.journal.unload(),e.auth2.getAuthInstance().signOut()},class:"authButton"},"Sign Out"):a.default("button",{onclick:()=>e.auth2.getAuthInstance().signIn(),class:"authButton"},"Sign In"),a.default("script",{async:!0,defer:!0,src:"https://apis.google.com/js/api.js",onload:()=>{(e=l.getTestMode()===o.TestMode.OFF?gapi:new i.MockGapi).load("auth2",t)}})])}}}},function(e,t,s){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(s(1)),a=s(0);t.refinesPane=function(){const e=new Set;function t(t,s){return n.default("span",function(t){return{class:"roundTagKey",onclick:s=>function(t,s){if(t.metaKey||t.ctrlKey){if("Simple Tags"===s)return;a.search.refinesQuery.keys.has(s)?a.search.refinesQuery.keys.delete(s):a.search.refinesQuery.keys.add(s)}else e.has(s)?e.delete(s):e.add(s)}(s,t)}}(t),["Simple Tags"===t?[]:n.default("input",{type:"checkbox",checked:a.search.refinesQuery.keys.has(t)}),e.has(t)?n.default("span","▾ "):n.default("span","▿ "),n.default("span",t),n.default("span",` (${s})`)])}function s(e,t){return n.default("div",{class:"tagRefineValWrap"},[n.default("span",r(e,t),[n.default("input",{type:"checkbox",checked:null===t.val?a.search.refinesQuery.simpleKeys.has(t.clean):a.search.refinesQuery.vals.has(t.clean)}),null!==t.val?n.default("span",""+t.cleanVal):n.default("span",`${t.flag}${t.cleanKey}`),n.default("span",` (${t.frq})`)])])}function r(t,s){let r=null===s.val?"simpleTag":"roundTagVal",n="hide";return(null===s.val&&e.has("Simple Tags")||e.has(t)||a.search.refinesQuery.vals.has(s.clean))&&(n=""),{class:`${r} ${n}`,onclick:()=>function(e){null===e.val?a.search.refinesQuery.simpleKeys.has(e.clean)?a.search.refinesQuery.simpleKeys.delete(e.clean):a.search.refinesQuery.simpleKeys.set(e.clean,e):a.search.refinesQuery.vals.has(e.clean)?a.search.refinesQuery.vals.delete(e.clean):a.search.refinesQuery.vals.set(e.clean,e)}(s)}}return{view:function(){return a.journal.hideTagRefines?[]:n.default("#tagsWrap",n.default("#tags",[n.default(".tempguidancePre","Tags"),n.default(".tagRefineWrap",0===a.refines.simple.size?[]:[t("Simple Tags",a.refines.simple.size),Array.from(a.refines.simple,([e,t])=>[s(e,t)])]),Array.from(a.refines.complex,([e,r])=>n.default(".tagRefineWrap",[t(e,r.length),r.map(t=>[s(e,t)])]))]))}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(0);t.Refines=class{constructor(){this.simple=new Map,this.complex=new Map}build(){let e=new Map,t=new Map;for(let s of r.journal.spreadsheet.sheet.tags.values())if(null===s.val){let t=`${s.flag}${s.cleanKey}`;e.has(t)||e.set(t,s)}else{let e=`${s.flag}${s.cleanKey}${s.separator}`;t.has(e)||t.set(e,[]),t.get(e).push(s)}this.simple=new Map([...e.entries()]),this.complex=new Map([...t.entries()].sort()),this.cleanRefines()}cleanRefines(){for(let[e]of r.search.refinesQuery.simpleKeys)this.simple.has(e)||r.search.refinesQuery.simpleKeys.delete(e);for(let e of r.search.refinesQuery.keys)this.complex.has(e)||r.search.refinesQuery.keys.delete(e);for(let[e]of r.search.refinesQuery.vals)Array.from(this.complex.values()).some(t=>t.some(t=>t.clean===e))||r.search.refinesQuery.vals.delete(e)}}}]);
//# sourceMappingURL=dntd.js.map