!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=56)}([,function(e,t,n){"use strict";var s,o,r,a,c,i,l=(s="/Users/bwakeford/Documents/personal/dntd-web/src/types/index.ts",o="393c9de530e72a21335fa71dc0497ace7228fd36",r=new(0,function(){}.constructor)("return this")(),c={path:"/Users/bwakeford/Documents/personal/dntd-web/src/types/index.ts",statementMap:{0:{start:{line:3,column:4},end:{line:3,column:71}},1:{start:{line:3,column:21},end:{line:3,column:71}},2:{start:{line:3,column:53},end:{line:3,column:71}},3:{start:{line:5,column:0},end:{line:5,column:62}},4:{start:{line:6,column:0},end:{line:6,column:30}},5:{start:{line:7,column:0},end:{line:7,column:30}},6:{start:{line:8,column:0},end:{line:8,column:31}},7:{start:{line:9,column:0},end:{line:9,column:30}}},fnMap:{0:{name:"__export",decl:{start:{line:2,column:9},end:{line:2,column:17}},loc:{start:{line:2,column:21},end:{line:4,column:1}},line:2}},branchMap:{0:{loc:{start:{line:3,column:21},end:{line:3,column:71}},type:"if",locations:[{start:{line:3,column:21},end:{line:3,column:71}},{start:{line:3,column:21},end:{line:3,column:71}}],line:3}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0},f:{0:0},b:{0:[0,0]},inputSourceMap:{version:3,file:"/Users/bwakeford/Documents/personal/dntd-web/src/types/index.ts",sourceRoot:"",sources:["/Users/bwakeford/Documents/personal/dntd-web/src/types/index.ts"],names:[],mappings:";;;;;AACA,8BAAwB;AACxB,8BAAwB;AACxB,+BAAyB;AACzB,8BAAwB",sourcesContent:['export * from "./caret"\nexport * from "./errors"\nexport * from "./search"\nexport * from "./testing"\nexport * from "./syncer"\n']},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},(i=r[a="__coverage__"]||(r[a]={}))[s]&&i[s].hash===o?i[s]:(c.hash=o,i[s]=c));function u(e){for(var n in l.f[0]++,l.s[0]++,e)l.s[1]++,t.hasOwnProperty(n)?l.b[0][1]++:(l.b[0][0]++,l.s[2]++,t[n]=e[n])}l.s[3]++,Object.defineProperty(t,"__esModule",{value:!0}),l.s[4]++,u(n(10)),l.s[5]++,u(n(11)),l.s[6]++,u(n(12)),l.s[7]++,u(n(13))},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),o=n(18);t.TaskFactory=class{createTask(e,t){switch(e.type){case s.SyncerPayloadType.GET_ROWS:return o.createGetRowsTask(e,t);case s.SyncerPayloadType.GET_SPREADSHEET:return o.createGetSpreadsheetTask(e,t);case s.SyncerPayloadType.GET_SHEETS:return o.createGetSheetsTask(e,t);case s.SyncerPayloadType.DELETE_ROW:return o.createDeleteRowTask(e,t);case s.SyncerPayloadType.UPDATE_ROW:return o.createUpdateRowTask(e,t);default:return}}};t.BaseTask=class{constructor(e,t){this.testMode=s.TestMode.OFF,this.payload=e,this.testMode=void 0!==t?t:this.testMode}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(57));class s extends Error{constructor(e,t,n){super(e),this.friendlyMsg=t,this.needsReAuth=n}}t.SyncerError=s},,,,function(e,t,n){"use strict";var s,o,r,a,c,i,l=(s="/Users/bwakeford/Documents/personal/dntd-web/src/types/errors.ts",o="045e93cdef57616e7fb224c75cbe52a373520860",r=new(0,function(){}.constructor)("return this")(),c={path:"/Users/bwakeford/Documents/personal/dntd-web/src/types/errors.ts",statementMap:{0:{start:{line:2,column:0},end:{line:2,column:62}},1:{start:{line:3,column:11},end:{line:3,column:23}},2:{start:{line:6,column:8},end:{line:6,column:24}},3:{start:{line:7,column:8},end:{line:7,column:39}},4:{start:{line:8,column:8},end:{line:8,column:39}},5:{start:{line:9,column:8},end:{line:14,column:10}},6:{start:{line:17,column:0},end:{line:17,column:34}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:5,column:4},end:{line:5,column:5}},loc:{start:{line:5,column:59},end:{line:15,column:5}},line:5}},branchMap:{0:{loc:{start:{line:10,column:19},end:{line:10,column:55}},type:"cond-expr",locations:[{start:{line:10,column:43},end:{line:10,column:48}},{start:{line:10,column:51},end:{line:10,column:55}}],line:10}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0},f:{0:0},b:{0:[0,0]},inputSourceMap:{version:3,file:"/Users/bwakeford/Documents/personal/dntd-web/src/types/errors.ts",sourceRoot:"",sources:["/Users/bwakeford/Documents/personal/dntd-web/src/types/errors.ts"],names:[],mappings:";;AAAA,wBAAmD;AAYnD,MAAa,WAAY,SAAQ,KAAK;IAGlC,YAAY,QAAgB,EAAS,WAAmB,EAAS,WAAoB,EAAE,KAAe;QAClG,KAAK,CAAC,QAAQ,CAAC,CAAA;QADkB,gBAAW,GAAX,WAAW,CAAQ;QAAS,gBAAW,GAAX,WAAW,CAAS;QAEjF,IAAI,CAAC,OAAO,GAAG;YACX,KAAK,EAAE,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI;YAC3C,KAAK,EAAE,IAAI;YACX,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,IAAI,EAAE,oBAAiB,CAAC,KAAK;SAChC,CAAA;IACL,CAAC;CACJ;AAZD,kCAYC",sourcesContent:['import { ErrorPayload, SyncerPayloadType } from "."\n\nexport interface GapiErrorResponseBody {\n    code: number,\n    message: string,\n    status: string\n}\n\nexport interface GapiErrorResponse {\n    error: GapiErrorResponseBody\n}\n\nexport class SyncerError extends Error { // TODO: see if this can be moved to src/errors/\n    public payload: ErrorPayload\n\n    constructor(errorMsg: string, public friendlyMsg: string, public needsReAuth: boolean, pause?: boolean) {\n        super(errorMsg)\n        this.payload = {\n            pause: (pause !== undefined) ? pause : true,\n            error: this,\n            friendlyMsg: this.friendlyMsg,\n            type: SyncerPayloadType.ERROR,\n        }\n    }\n}\n']},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},(i=r[a="__coverage__"]||(r[a]={}))[s]&&i[s].hash===o?i[s]:(c.hash=o,i[s]=c));l.s[0]++,Object.defineProperty(t,"__esModule",{value:!0});const u=(l.s[1]++,n(1));class d extends Error{constructor(e,t,n,s){l.f[0]++,l.s[2]++,super(e),l.s[3]++,this.friendlyMsg=t,l.s[4]++,this.needsReAuth=n,l.s[5]++,this.payload={pause:void 0!==s?(l.b[0][0]++,s):(l.b[0][1]++,!0),error:this,friendlyMsg:this.friendlyMsg,type:u.SyncerPayloadType.ERROR}}}l.s[6]++,t.SyncerError=d},function(e,t,n){"use strict";var s,o,r,a,c,i,l=(s="/Users/bwakeford/Documents/personal/dntd-web/src/types/search.ts",o="0ebb96bcffde59510933573a940b9c7b84eb43f5",r=new(0,function(){}.constructor)("return this")(),c={path:"/Users/bwakeford/Documents/personal/dntd-web/src/types/search.ts",statementMap:{0:{start:{line:2,column:0},end:{line:2,column:62}},1:{start:{line:4,column:0},end:{line:8,column:65}},2:{start:{line:5,column:4},end:{line:5,column:48}},3:{start:{line:6,column:4},end:{line:6,column:46}},4:{start:{line:7,column:4},end:{line:7,column:44}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:4,column:1},end:{line:4,column:2}},loc:{start:{line:4,column:23},end:{line:8,column:1}},line:4}},branchMap:{0:{loc:{start:{line:8,column:16},end:{line:8,column:63}},type:"binary-expr",locations:[{start:{line:8,column:16},end:{line:8,column:34}},{start:{line:8,column:39},end:{line:8,column:62}}],line:8}},s:{0:0,1:0,2:0,3:0,4:0},f:{0:0},b:{0:[0,0]},inputSourceMap:{version:3,file:"/Users/bwakeford/Documents/personal/dntd-web/src/types/search.ts",sourceRoot:"",sources:["/Users/bwakeford/Documents/personal/dntd-web/src/types/search.ts"],names:[],mappings:";;AAAA,IAAY,UAIX;AAJD,WAAY,UAAU;IAClB,2CAAI,CAAA;IACJ,yCAAG,CAAA;IACH,uCAAE,CAAA;AACN,CAAC,EAJW,UAAU,GAAV,kBAAU,KAAV,kBAAU,QAIrB",sourcesContent:["export enum SearchType {\n    NONE,\n    AND,\n    OR,\n}\n"]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},(i=r[a="__coverage__"]||(r[a]={}))[s]&&i[s].hash===o?i[s]:(c.hash=o,i[s]=c));l.s[0]++,Object.defineProperty(t,"__esModule",{value:!0}),l.s[1]++,function(e){l.f[0]++,l.s[2]++,e[e.NONE=0]="NONE",l.s[3]++,e[e.AND=1]="AND",l.s[4]++,e[e.OR=2]="OR"}((l.b[0][0]++,t.SearchType||(l.b[0][1]++,t.SearchType={})))},function(e,t,n){"use strict";var s,o,r,a,c,i,l=(s="/Users/bwakeford/Documents/personal/dntd-web/src/types/testing.ts",o="0e21fa2bb80151c302c214db524aa091af727725",r=new(0,function(){}.constructor)("return this")(),c={path:"/Users/bwakeford/Documents/personal/dntd-web/src/types/testing.ts",statementMap:{0:{start:{line:2,column:0},end:{line:2,column:62}},1:{start:{line:4,column:0},end:{line:13,column:59}},2:{start:{line:5,column:4},end:{line:5,column:26}},3:{start:{line:6,column:4},end:{line:6,column:30}},4:{start:{line:7,column:4},end:{line:7,column:50}},5:{start:{line:8,column:4},end:{line:8,column:37}},6:{start:{line:9,column:4},end:{line:9,column:40}},7:{start:{line:10,column:4},end:{line:10,column:38}},8:{start:{line:11,column:4},end:{line:11,column:34}},9:{start:{line:12,column:4},end:{line:12,column:27}}},fnMap:{0:{name:"(anonymous_0)",decl:{start:{line:4,column:1},end:{line:4,column:2}},loc:{start:{line:4,column:21},end:{line:13,column:1}},line:4}},branchMap:{0:{loc:{start:{line:13,column:14},end:{line:13,column:57}},type:"binary-expr",locations:[{start:{line:13,column:14},end:{line:13,column:30}},{start:{line:13,column:35},end:{line:13,column:56}}],line:13}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},f:{0:0},b:{0:[0,0]},inputSourceMap:{version:3,file:"/Users/bwakeford/Documents/personal/dntd-web/src/types/testing.ts",sourceRoot:"",sources:["/Users/bwakeford/Documents/personal/dntd-web/src/types/testing.ts"],names:[],mappings:";;AAAA,IAAY,QASX;AATD,WAAY,QAAQ;IAChB,qBAAS,CAAA;IACT,yBAAa,CAAA;IACb,6CAAiC,CAAA;IACjC,gCAAoB,CAAA;IACpB,mCAAuB,CAAA;IACvB,iCAAqB,CAAA;IACrB,6BAAiB,CAAA;IACjB,sBAAU,CAAA;AACd,CAAC,EATW,QAAQ,GAAR,gBAAQ,KAAR,gBAAQ,QASnB",sourcesContent:['export enum TestMode {\n    OFF = "0",\n    WORKING = "1",\n    FAIL_GET_SPREADSHEET_SHEETS = "2",\n    FAIL_GET_RANGE = "3",\n    FAIL_UPDATE_RANGE = "4",\n    FAIL_DELETE_ROW = "5",\n    RETURN_ROWS = "6",\n    DEMO = "7"\n}\n']},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},(i=r[a="__coverage__"]||(r[a]={}))[s]&&i[s].hash===o?i[s]:(c.hash=o,i[s]=c));l.s[0]++,Object.defineProperty(t,"__esModule",{value:!0}),l.s[1]++,function(e){l.f[0]++,l.s[2]++,e.OFF="0",l.s[3]++,e.WORKING="1",l.s[4]++,e.FAIL_GET_SPREADSHEET_SHEETS="2",l.s[5]++,e.FAIL_GET_RANGE="3",l.s[6]++,e.FAIL_UPDATE_RANGE="4",l.s[7]++,e.FAIL_DELETE_ROW="5",l.s[8]++,e.RETURN_ROWS="6",l.s[9]++,e.DEMO="7"}((l.b[0][0]++,t.TestMode||(l.b[0][1]++,t.TestMode={})))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE",e[e.GET_SPREADSHEET=7]="GET_SPREADSHEET",e[e.EXTEND_SHEET=8]="EXTEND_SHEET",e[e.CREATE_ROW=9]="CREATE_ROW",e[e.MOVE_ROW=10]="MOVE_ROW",e[e.ERROR=11]="ERROR",e[e.TOKEN_REQUEST=12]="TOKEN_REQUEST",e[e.SYNC_STATE=13]="SYNC_STATE"}(t.SyncerPayloadType||(t.SyncerPayloadType={})),function(e){e[e.SYNCER_STATE=0]="SYNCER_STATE",e[e.ERROR=1]="ERROR",e[e.REAUTH=2]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done",e.INITIALIZING="cloud_queue"}(t.SyncerState||(t.SyncerState={}))},,,,,function(e,t,n){"use strict";function s(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),s(n(4)),s(n(58)),s(n(59)),s(n(60)),s(n(61)),s(n(19)),s(n(62))},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(4);class a extends r.BaseTask{constructor(e){super(e)}work(e){return s(this,void 0,void 0,(function*(){let t=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${this.payload.spreadsheetId}:batchUpdate`),n={method:"POST",mode:"cors",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{appendDimension:{sheetId:this.payload.sheetId,dimension:"ROWS",length:100}}]})},s=yield fetch(t.toString(),n);if(!s.ok){let e=yield s.json();throw new o.SyncerError(JSON.stringify(e),"Failed to extend sheet",401===s.status)}return this.payload}))}}t.ExtendSheetTask=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(1),a=n(18),c=n(63),i=n(1);let l=0;let u=i.TestMode.OFF;const d=new a.TaskFactory;let A=void 0,p=i.SyncerState.SYNCED;const y=new Map,h=[];function f(){return p!==i.SyncerState.PAUSED&&p!==i.SyncerState.SYNCED&&h.length+y.size+l===0}function m(e){void 0!==e&&p!==e&&(p=e,c.postSyncStateMessage(h.length,p))}function E(e,t){if(o.instanceOfSyncerError(e)&&e.needsReAuth)return c.postTokenRequestMessage(),void(A=void 0);{let n=o.instanceOfSyncerError(e)?e:new r.SyncerError(e.message,"Unknown Error",!1);n.payload.pause&&m(i.SyncerState.PAUSED),postMessage({id:t,error:n.payload})}}function S(){return s(this,void 0,void 0,(function*(){for(;0!==h.length&&A&&p!==i.SyncerState.PAUSED;){m(i.SyncerState.UPLOADING);let{id:e,task:t}=h[0],n=yield t.work(A);postMessage({id:e,payload:n}),h.shift()}}))}function T(){if(0!==y.size&&A&&p!==i.SyncerState.PAUSED){m(i.SyncerState.DOWNLOADING);for(let[e,t]of y.entries())l+=1,y.delete(e),t.work(A).then(t=>postMessage({id:e,payload:t})).catch(t=>E(t,e)).finally(()=>l-=1)}}function _(e){return new Promise(t=>setTimeout(t,e))}!function(){s(this,void 0,void 0,(function*(){for(;;){yield _(250),f()&&m(i.SyncerState.SYNCED);try{T(),yield S()}catch(e){E(e)}}}))}(),onmessage=e=>function(e){const{id:t,payload:n}=e.data;switch(n.type){case i.SyncerPayloadType.TEST_MODE_UPDATE:return u=n.testMode,void(u!==i.TestMode.OFF&&(A="mock"));case i.SyncerPayloadType.AUTH_UPDATE:return void(A=n.token);case i.SyncerPayloadType.UNPAUSE:return void m(i.SyncerState.PAUSED)}let s=d.createTask(n,u);if(void 0===s)return;s.async?y.set(t,s):h.push({id:t,task:s})}(e)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.instanceOfSyncerError=function(e){return"needsReAuth"in e}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(4),a=n(1);t.createGetRowsTask=function(e,t){return t===a.TestMode.OFF?new c(e):new i(e,t)};class c extends r.BaseTask{constructor(e){super(e),this.async=!0}work(e){return s(this,void 0,void 0,(function*(){let t=this.payload.sheetTitle+"!A:A",n=`https://sheets.googleapis.com/v4/spreadsheets/${this.payload.spreadsheetId}/values/${t}`,s={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},r=yield fetch(n,s);if(!r.ok){let e=yield r.json();throw new o.SyncerError(JSON.stringify(e),"Failed to get sheet rows: "+t,401===r.status)}{let e=yield r.json();this.payload.rows=e.values?e.values.map(e=>e[0]):[]}return this.payload}))}}t.GetRowsTask=c;class i extends r.BaseTask{constructor(e,t){super(e,t),this.async=!0}work(e){return s(this,void 0,void 0,(function*(){if(this.testMode===a.TestMode.FAIL_GET_RANGE)throw new Error("mock fail");return this.testMode===a.TestMode.RETURN_ROWS&&(this.payload.rows=["aaa","bbb","ccc","@tag","@key:value"]),this.payload}))}}t.MockGetRowsTask=i},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(4),a=n(1);t.createGetSheetsTask=function(e,t){return t===a.TestMode.OFF?new c(e):void 0};class c extends r.BaseTask{constructor(e){super(e),this.async=!0}work(e){return s(this,void 0,void 0,(function*(){let t="https://sheets.googleapis.com/v4/spreadsheets/"+this.payload.spreadsheetId,n={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},s=yield fetch(t,n);if(!s.ok){let e=yield s.json();throw new o.SyncerError(JSON.stringify(e),"Failed to get spreadsheet details for spreadsheet: "+this.payload.spreadsheetId,401===s.status)}{let e=yield s.json();this.payload.sheets=e.sheets?e.sheets:[]}return this.payload}))}}t.GetSheetsTask=c},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(4),a=n(1),c=n(19);t.createUpdateRowTask=function(e,t){return t===a.TestMode.OFF?new i(e):void 0};class i extends r.BaseTask{constructor(e){super(e)}work(e){return s(this,void 0,void 0,(function*(){let t=`${this.payload.sheetTitle}!A${this.payload.idx+1}:A${this.payload.idx+1}`,n=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${this.payload.spreadsheetId}/values/${t}`),s={Authorization:"Bearer "+e},r={valueInputOption:"RAW"};Object.keys(r).forEach(e=>n.searchParams.append(e,r[e]));let i={method:"PUT",cache:"no-cache",headers:s,body:JSON.stringify({range:t,majorDimension:"ROWS",values:[[this.payload.content]]})},l=yield fetch(n.toString(),i),u=yield l.json();if(!l.ok){if(u.error.message.includes("exceeds grid limits")){let s={type:a.SyncerPayloadType.EXTEND_SHEET,spreadsheetId:this.payload.spreadsheetId,sheetId:this.payload.sheetId};if(yield new c.ExtendSheetTask(s).work(e),(yield fetch(n.toString(),i)).ok)return this.payload;{let e=yield l.json();throw new o.SyncerError(JSON.stringify(e),"Failed to update row: "+t,401===l.status)}}throw new o.SyncerError(JSON.stringify(u),"Failed to update row: "+t,401===l.status)}return this.payload}))}}t.UpdateRowTask=i},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(6),r=n(4),a=n(1);t.createDeleteRowTask=function(e,t){return t===a.TestMode.OFF?new c(e):void 0};class c extends r.BaseTask{constructor(e){super(e)}work(e){return s(this,void 0,void 0,(function*(){let t={sheetId:this.payload.sheetId,startRowIndex:this.payload.idx,endRowIndex:this.payload.idx+1,startColumnIndex:0},n=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${this.payload.spreadsheetId}:batchUpdate`),s={method:"POST",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{deleteRange:{range:t,shiftDimension:"ROWS"}}]})},r=yield fetch(n.toString(),s);if(!r.ok){let e=yield r.json();throw new o.SyncerError(JSON.stringify(e),"Failed to delete row: "+this.payload.idx,401===r.status)}return this.payload}))}}t.DeleteRowTask=c},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,r){function a(e){try{i(s.next(e))}catch(e){r(e)}}function c(e){try{i(s.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}i((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(4),r=n(1);t.createGetSpreadsheetTask=function(e,t){return t===r.TestMode.OFF?new a(e):void 0};class a extends o.BaseTask{constructor(e){super(e),this.async=!0}work(e){return s(this,void 0,void 0,(function*(){let t="https://sheets.googleapis.com/v4/spreadsheets/"+this.payload.spreadsheetId,n={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},s=yield fetch(t,n);if(!s.ok){let e=yield s.json();throw new r.SyncerError(JSON.stringify(e),"Error: Could not download spreadsheet.",401===s.status,!1)}return this.payload.spreadsheet=yield s.json(),this.payload}))}}t.GetSpreadsheetTask=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);t.postSyncStateMessage=function(e,t){var n;n={length:e,state:t,type:s.SyncerPayloadType.SYNC_STATE},postMessage({payload:n})},t.postTokenRequestMessage=function(){postMessage({type:s.SyncerPayloadType.TOKEN_REQUEST})}}]);
//# sourceMappingURL=syncWebWorker.js.map