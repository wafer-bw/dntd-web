!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=60)}({10:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTH_UPDATE=0]="AUTH_UPDATE",e[e.DELETE_ROW=1]="DELETE_ROW",e[e.UPDATE_ROW=2]="UPDATE_ROW",e[e.GET_ROWS=3]="GET_ROWS",e[e.GET_SHEETS=4]="GET_SHEETS",e[e.TEST_MODE_UPDATE=5]="TEST_MODE_UPDATE",e[e.UNPAUSE=6]="UNPAUSE"}(t.SyncerTaskType||(t.SyncerTaskType={}))},11:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.ROWS=0]="ROWS",e[e.SHEETS=1]="SHEETS",e[e.SYNCER_STATE=2]="SYNCER_STATE",e[e.ERROR=3]="ERROR",e[e.REAUTH=4]="REAUTH"}(t.SyncerResponseType||(t.SyncerResponseType={})),function(e){e.PAUSED="cloud_off",e.UPLOADING="cloud_upload",e.DOWNLOADING="cloud_download",e.SYNCED="cloud_done"}(t.SyncerState||(t.SyncerState={}))},15:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function c(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((o=o.apply(e,t||[])).next())}))};function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(61)),r(n(62)),r(n(63)),t.syncRate=250,t.sleep=function(e){return o(this,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}))};class s extends Error{constructor(e,t,n){super(e),this.friendlyMsg=t,this.needsReAuth=n}}t.SyncerError=s},3:function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(8)),o(n(9)),o(n(10)),o(n(11))},60:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function c(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});n(3);const r=n(15),s=[];!function(){o(this,void 0,void 0,(function*(){for(;;)yield r.sleep(r.syncRate),s.length}))}(),onmessage=e=>function(e){const{id:t,task:n}=e.data;(function(e){return o(this,void 0,void 0,(function*(){return console.log("WORKING TASK:"),console.log(e),e}))})(n).then(e=>{postMessage({id:t,task:e})}).catch(e=>{postMessage({id:t,error:e})})}(e)},61:function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{u(o.next(e))}catch(e){s(e)}}function c(e){try{u(o.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(15);t.SyncerTasks=class{constructor(){this.extendSheetLength=100}getSheets(e,t){return o(this,void 0,void 0,(function*(){let n="https://sheets.googleapis.com/v4/spreadsheets/"+t.spreadsheetId,o={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},s=yield fetch(n,o);if(s.ok){return(yield s.json()).sheets||[]}{let e=yield s.json();throw new r.SyncerError(JSON.stringify(e),"Failed to get spreadsheet details for spreadsheet: "+t.spreadsheetId,401===s.status)}}))}getRows(e,t){return o(this,void 0,void 0,(function*(){let n=t.sheetTitle+"!A:A",o=`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}/values/${n}`,s={method:"GET",cache:"no-cache",headers:{Authorization:"Bearer "+e}},i=yield fetch(o,s);if(i.ok){let e=yield i.json();return e.values?e.values.map(e=>e[0]):[]}{let e=yield i.json();throw new r.SyncerError(JSON.stringify(e),"Failed to get sheet rows: "+n,401===i.status)}}))}updateRow(e,t){return o(this,void 0,void 0,(function*(){let n=`${t.sheetTitle}!A${t.idx+1}:A${t.idx+1}`,o=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}/values/${n}`),s={Authorization:"Bearer "+e},i={valueInputOption:"RAW"};Object.keys(i).forEach(e=>o.searchParams.append(e,i[e]));let c={method:"PUT",cache:"no-cache",headers:s,body:JSON.stringify({range:n,majorDimension:"ROWS",values:[[t.content]]})},u=yield fetch(o.toString(),c),a=yield u.json();if(!u.ok){if(a.error.message.includes("exceeds grid limits")){if(yield this.extendSheet(e,t.spreadsheetId,t.sheetId),(yield fetch(o.toString(),c)).ok)return;{let e=yield u.json();throw new r.SyncerError(JSON.stringify(e),"Failed to update row: "+n,401===u.status)}}throw new r.SyncerError(JSON.stringify(a),"Failed to update row: "+n,401===u.status)}}))}deleteRow(e,t){return o(this,void 0,void 0,(function*(){let n={sheetId:t.sheetId,startRowIndex:t.idx,endRowIndex:t.idx+1,startColumnIndex:0},o=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t.spreadsheetId}:batchUpdate`),s={method:"POST",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{deleteRange:{range:n,shiftDimension:"ROWS"}}]})},i=yield fetch(o.toString(),s);if(!i.ok){let e=yield i.json();throw new r.SyncerError(JSON.stringify(e),"Failed to delete row: "+t.idx,401===i.status)}}))}extendSheet(e,t,n){return o(this,void 0,void 0,(function*(){let o=new URL(`https://sheets.googleapis.com/v4/spreadsheets/${t}:batchUpdate`),s={method:"POST",mode:"cors",cache:"no-cache",headers:{Authorization:"Bearer "+e},body:JSON.stringify({requests:[{appendDimension:{sheetId:n,dimension:"ROWS",length:this.extendSheetLength}}]})},i=yield fetch(o.toString(),s);if(!i.ok){let e=yield i.json();throw new r.SyncerError(JSON.stringify(e),"Failed to extend sheet",401===i.status)}}))}}},62:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.instanceOfSyncerError=function(e){return"needsReAuth"in e}},63:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(3);function r(e){postMessage(e)}t.postSheets=function(e,t){r({spreadsheetId:e.spreadsheetId,sheets:t,type:o.SyncerResponseType.SHEETS})},t.postRows=function(e,t){r({spreadsheetId:e.spreadsheetId,sheetId:e.sheetId,rows:t,type:o.SyncerResponseType.ROWS})},t.postQueueState=function(e,t){r({length:e,state:t,type:o.SyncerResponseType.SYNCER_STATE})},t.postError=function(e){r({friendlyMsg:e.friendlyMsg,error:e,type:o.SyncerResponseType.ERROR})},t.postReAuthRequest=function(){postMessage({type:o.SyncerResponseType.REAUTH})}},8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NONE=0]="NONE",e[e.AND=1]="AND",e[e.OR=2]="OR"}(t.SearchType||(t.SearchType={}))},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OFF="0",e.WORKING="1",e.FAIL_GET_SPREADSHEET_SHEETS="2",e.FAIL_GET_RANGE="3",e.FAIL_UPDATE_RANGE="4",e.FAIL_DELETE_ROW="5",e.RETURN_ROWS="6",e.DEMO="7"}(t.TestMode||(t.TestMode={}))}});
//# sourceMappingURL=syncWebWorker.js.map