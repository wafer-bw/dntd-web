{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"m\"","webpack:///./src/types/index.ts","webpack:///./src/controllers/index.ts","webpack:///./src/index.ts","webpack:///./src/components/index.ts","webpack:///./src/models/index.ts","webpack:///./src/factories/index.ts","webpack:///./src/types/errors.ts","webpack:///./src/types/search.ts","webpack:///./src/types/testing.ts","webpack:///./src/types/syncer.ts","webpack:///./src/errors/index.ts","webpack:///./src/factories/tagFactory.ts","webpack:///./src/views/index.ts","webpack:///./src/views/shelfView.ts","webpack:///./src/components/googleComponent.ts","webpack:///./src/controllers/urlController.ts","webpack:///./src/controllers/textController.ts","webpack:///./src/controllers/entryController.ts","webpack:///./src/models/UrlModel.ts","webpack:///./src/models/TagModel.ts","webpack:///./src/models/EntryModel.ts","webpack:///./src/models/ShelfModel.ts","webpack:///./src/models/SyncerModel.ts","webpack:///./src/models/GoogleModel.ts","webpack:///./src/models/JournalModel.ts","webpack:///./src/models/LibraryModel.ts","webpack:///./src/models/ServiceWorkerModel.ts","webpack:///./src/errors/FriendlyError.ts","webpack:///./src/factories/shelfFactory.ts","webpack:///./src/factories/entryFactory.ts","webpack:///./src/controllers/caretController.ts","webpack:///./src/controllers/googleController.ts","webpack:///./src/mocks/index.ts","webpack:///./src/mocks/Gapi.ts","webpack:///./src/controllers/syncerController.ts","webpack:///./src/controllers/libraryController.ts","webpack:///./src/controllers/journalController.ts","webpack:///./src/components/entriesComponent.ts","webpack:///./src/components/shelvesComponent.ts","webpack:///./src/components/journalsComponent.ts","webpack:///./src/components/syncStateComponent.ts","webpack:///./src/components/addShelvesComponent.ts","webpack:///./src/components/breadcrumbComponent.ts","webpack:///./src/views/signinView.ts","webpack:///./src/views/libraryView.ts","webpack:///./src/views/journalView.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","serviceWorkerModel","ServiceWorkerModel","googleModel","GoogleModel","syncerModel","SyncerModel","libraryModel","LibraryModel","urlModel","UrlModel","root","document","getElementById","route","signinView","libraryView","shelfView","journalView","SyncerError","Error","errorMsg","friendlyMsg","needsReAuth","pause","super","this","payload","undefined","error","type","SyncerPayloadType","ERROR","SearchType","TestMode","SyncerResponseType","SyncerState","cleanTagString","str","textController","escape","endsWith","substring","length","toLowerCase","tagFactory","createTag","raw","flag","separator","val","clean","cleanKey","cleanVal","renderedKey","renderedVal","replace","TagModel","view","breadcrumbComponent","googleComponent","syncStateComponent","journalsComponent","isSignedIn","onclick","googleController","signOut","class","signIn","async","defer","src","onload","initGapi","getActiveShelf","id","shelfId","shelves","urlController","redirect","hash","getActiveJournal","journalId","shelf","journals","getBreadcrumbTrail","breadcrumb","split","filter","crumb","trail","slice","join","title","parseInt","push","href","unsafe","content","tagPattern","entryController","save","entry","entryIdx","force","saved","savedClean","tags","tagMatches","Map","tag","has","frq","set","getTags","syncerController","updateRow","journal","update","safe","tokens","text","token","trim","matchesIter","matchAll","match","sort","a","b","index","getTagMatches","rendered","chars","splice","render","URL","window","location","hash_","DEMO","test","param","instanceOfTestMode","OFF","values","includes","entryId","readableRendered","requestsCounter","requests","state","SYNCED","worker","Promise","resolve","reject","postMessage","scope","clientId","user","getAuthResponse","access_token","journalTitle","entries","entryCounter","idx","entryFactory","createEntry","fromIdx","toIdx","shelfIds","forEach","ids","localStorage","setItem","getItem","navigator","FriendlyError","addEventListener","serviceWorker","register","console","warn","redraw","shelfFactory","createShelf","spreadsheetId","spreadsheet","properties","sheets","ShelfModel","sheet","sheetId","JournalModel","getJournals","EntryModel","caretController","getCaretPosition","elem","sel","getSelection","cum_length","anchorNode","innerText","extentNode","nodes_to_find","contains","found","node_walk","node","func","result","firstChild","nextSibling","textContent","anchorOffset","extentOffset","setCaretPosition","el","pos","childNodes","nodeType","range","createRange","setStart","collapse","removeAllRanges","addRange","signedIn","gapi_","auth2","getAuthInstance","currentUser","updateAuth","libraryController","loadShelves","removeShelves","testMode","gapi","MockGapi","load","init","client_id","then","listen","MockAuth2","_api","_callback","MockGoogleAuth","_params","MockCurrentUser","MockGoogleUser","expires_in","MockIsSignedIn","Worker","pushSyncerTask","AUTH_UPDATE","onmessage","msg","data","delete","SYNC_STATE","message","TOKEN_REQUEST","onMessage","unpause","UNPAUSE","getRows","sheetTitle","GET_ROWS","rows","deleteRow","DELETE_ROW","UPDATE_ROW","getSheets","GET_SHEETS","updateTestMode","TEST_MODE_UPDATE","getSpreadsheet","GET_SPREADSHEET","spreadsheetIdPattern","reloadLoaded","Array","from","keys","catch","finally","getSpreadsheetIdsFromUrls","urls","addShelves","buildTags","reverse","journalController","addEntry","updateEntry","deleteEntry","moveEntry","caret","entriesList","map","entryContent","deleteEntryButton","entryVnode","contenteditable","onkeydown","event","keyCode","shiftKey","preventDefault","target","blur","onEntryKeydown","oninput","onEntryInput","onupdate","onEntryUpdate","onblur","onEntryBlur","entryContentSettings","trust","delShelfButton","retryShelfLoadButton","shelfNode","link","journalList","syncStateText","txt","class_","stateColorClass","DOWNLOADING","PAUSED","UPLOADING","syncStateIcon","unpauseSync","newShelfUrls","addingShelves","addShelvesButton","addShelvesTextbox","placeholder","addShelvesComponent","shelvesComponent","entriesComponent"],"mappings":"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","file":"dntd.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = m;","export * from \"./caret\"\nexport * from \"./errors\"\nexport * from \"./search\"\nexport * from \"./testing\"\nexport * from \"./syncer\"\n","export * from \"./urlController\"\r\nexport * from \"./textController\"\r\nexport * from \"./entryController\"\r\nexport * from \"./caretController\"\r\nexport * from \"./googleController\"\r\nexport * from \"./syncerController\"\r\nexport * from \"./libraryController\"\r\nexport * from \"./journalController\"\r\n","import m from \"mithril\"\nimport { signinView, libraryView, shelfView, journalView } from \"./views\"\nimport { ServiceWorkerModel, SyncerModel, LibraryModel, GoogleModel, UrlModel } from \"./models\"\n\nexport const serviceWorkerModel = new ServiceWorkerModel()\nexport const googleModel = new GoogleModel()\nexport const syncerModel = new SyncerModel()\nexport const libraryModel = new LibraryModel()\nexport const urlModel = new UrlModel()\n\nconst root = document.getElementById(\"root\")\n\nif (root !== null) {\n    m.route(root, \"/\", {\n        \"/\": signinView,                                   // TODO decide what this should be\n        \"/signin\": signinView,\n        \"/library\": libraryView,\n        \"/library/:shelfId\": shelfView,\n        \"/library/:shelfId/:journalId\": journalView,\n        // \"/demo\" : app,                                   // TODO\n        // \"/about\": about,                                 // TODO\n    })\n}\n","export * from \"./googleComponent\"\nexport * from \"./entriesComponent\"\nexport * from \"./shelvesComponent\"\nexport * from \"./journalsComponent\"\nexport * from \"./syncStateComponent\"\nexport * from \"./addShelvesComponent\"\nexport * from \"./breadcrumbComponent\"\n","export * from \"./UrlModel\"\r\nexport * from \"./TagModel\"\r\nexport * from \"./EntryModel\"\r\nexport * from \"./ShelfModel\"\r\nexport * from \"./SyncerModel\"\r\nexport * from \"./GoogleModel\"\r\nexport * from \"./JournalModel\"\r\nexport * from \"./LibraryModel\"\r\nexport * from \"./ServiceWorkerModel\"\r\n","export * from \"./tagFactory\"\nexport * from \"./shelfFactory\"\nexport * from \"./entryFactory\"\n","import { ErrorPayload, SyncerPayloadType } from \".\"\n\nexport interface GapiErrorResponseBody {\n    code: number,\n    message: string,\n    status: string\n}\n\nexport interface GapiErrorResponse {\n    error: GapiErrorResponseBody\n}\n\nexport class SyncerError extends Error { // TODO: see if this can be moved to src/errors/\n    public payload: ErrorPayload\n\n    constructor(errorMsg: string, public friendlyMsg: string, public needsReAuth: boolean, pause?: boolean) {\n        super(errorMsg)\n        this.payload = {\n            pause: (pause !== undefined) ? pause : true,\n            error: this,\n            friendlyMsg: this.friendlyMsg,\n            type: SyncerPayloadType.ERROR,\n        }\n    }\n}\n","export enum SearchType {\n    NONE,\n    AND,\n    OR,\n}\n","export enum TestMode {\n    OFF = \"0\",\n    WORKING = \"1\",\n    FAIL_GET_SPREADSHEET_SHEETS = \"2\",\n    FAIL_GET_RANGE = \"3\",\n    FAIL_UPDATE_RANGE = \"4\",\n    FAIL_DELETE_ROW = \"5\",\n    RETURN_ROWS = \"6\",\n    DEMO = \"7\"\n}\n","import { TestMode } from \"./testing\"\n\nexport type SyncerPayload = (\n    GetRowsPayload | GetSheetsPayload | GetSpreadsheetPayload | UpdateRowPayload |\n    ExtendSheetPayload | DeleteRowPayload | TestModeUpdatePayload | AuthUpdatePayload |\n    UnpausePayload | SyncStatePayload | ErrorPayload | TokenRequestPayload\n)\n\nexport enum SyncerPayloadType {\n    AUTH_UPDATE,\n    DELETE_ROW,\n    UPDATE_ROW,\n    GET_ROWS,\n    GET_SHEETS,\n    TEST_MODE_UPDATE,\n    UNPAUSE,\n    GET_SPREADSHEET,\n    EXTEND_SHEET,\n    CREATE_ROW,\n    MOVE_ROW,\n    ERROR,\n    TOKEN_REQUEST,\n    SYNC_STATE,\n}\n\nexport enum SyncerResponseType {\n    SYNCER_STATE,\n    ERROR,\n    REAUTH,\n}\n\nexport enum SyncerState {\n    PAUSED = \"cloud_off\",\n    UPLOADING = \"cloud_upload\",\n    DOWNLOADING = \"cloud_download\",\n    SYNCED = \"cloud_done\",\n}\n\nexport interface TestModeUpdatePayload {\n    type: SyncerPayloadType.TEST_MODE_UPDATE\n    testMode: TestMode\n}\n\nexport interface AuthUpdatePayload {\n    type: SyncerPayloadType.AUTH_UPDATE\n    token: string\n}\n\nexport interface UnpausePayload {\n    type: SyncerPayloadType.UNPAUSE\n}\n\nexport interface DeleteRowPayload {\n    type: SyncerPayloadType.DELETE_ROW\n    idx: number\n    spreadsheetId: string\n    sheetId: number\n}\n\nexport interface ExtendSheetPayload {\n    type: SyncerPayloadType.EXTEND_SHEET\n    spreadsheetId: string\n    sheetId: number\n}\n\nexport interface UpdateRowPayload {\n    type: SyncerPayloadType.UPDATE_ROW\n    idx: number\n    spreadsheetId: string\n    sheetId: number\n    sheetTitle: string\n    content: string\n}\n\nexport interface GetSpreadsheetPayload {\n    type: SyncerPayloadType.GET_SPREADSHEET\n    spreadsheetId: string\n    spreadsheet?: gapi.client.sheets.Spreadsheet\n}\n\nexport interface GetRowsPayload {\n    type: SyncerPayloadType.GET_ROWS\n    spreadsheetId: string\n    sheetId: number\n    sheetTitle: string\n    rows: string[]\n}\n\nexport interface GetSheetsPayload {\n    type: SyncerPayloadType.GET_SHEETS\n    spreadsheetId: string\n    sheets: gapi.client.sheets.Sheet[]\n}\n\nexport interface SyncStatePayload {\n    type: SyncerPayloadType.SYNC_STATE\n    length: number\n    state: SyncerState\n}\n\nexport interface ErrorPayload {\n    type: SyncerPayloadType.ERROR\n    error: Error\n    pause: boolean\n    friendlyMsg: string\n}\n\nexport interface TokenRequestPayload {\n    type: SyncerPayloadType.TOKEN_REQUEST\n}\n","export * from \"./FriendlyError\"\n","import { textController } from \"../controllers\"\r\nimport { TagModel } from \"../models\"\r\n\r\nexport const tagFactory = {\r\n    createTag: createTag\r\n}\r\n\r\nfunction createTag(raw: string, flag: string, key: string, separator?: string | null, val?: string | null) {\r\n    separator = (separator !== undefined) ? separator : null\r\n    val = (val !== undefined) ? val : null\r\n    let clean = cleanTagString(raw)\r\n    let cleanKey = cleanTagString(key)\r\n    let cleanVal = (val !== null) ? cleanTagString(val) : null\r\n\r\n    let renderedKey = \"<span onclick=\\\"tagOnClick(event, '\"\r\n        + flag\r\n        + cleanKey\r\n        + ((separator !== null) ? separator : \"\")\r\n        + \"')\\\" class=\\\"\"\r\n        + ((separator !== null) ? \"tagKey\" : (val === null) ? \"simpleTag\" : \"roundTagVal\")\r\n        + \"\\\">\"\r\n        + flag\r\n        + key\r\n        + \"</span>\"\r\n\r\n    let renderedVal = \"\"\r\n\r\n    if (separator !== undefined) {\r\n        renderedVal = \"<span onclick=\\\"tagOnClick(event, '\"\r\n            + flag\r\n            + cleanKey\r\n            + separator\r\n            + ((cleanVal !== null) ? cleanVal.replace(/'/, \"\\\\'\") : \"\")\r\n            + \"')\\\" class=\\\"tagVal\\\">\"\r\n            + separator\r\n            + ((val !== null) ? val : \"\")\r\n            + \"</span>\"\r\n    }\r\n\r\n    return new TagModel(raw, flag, key, separator, val, clean, cleanKey, cleanVal, renderedKey + renderedVal)\r\n\r\n}\r\n\r\nfunction cleanTagString(str: string) {\r\n    str = textController.escape(str)\r\n    str = (str.endsWith(\"'s\")) ? str.substring(0, str.length - 2) : str\r\n    str = str.toLowerCase()\r\n    return str\r\n}\r\n","export * from \"./shelfView\"\r\nexport * from \"./signinView\"\r\nexport * from \"./libraryView\"\r\nexport * from \"./journalView\"\r\n","import m from \"mithril\"\nimport { googleComponent, journalsComponent, syncStateComponent, breadcrumbComponent } from \"../components\"\n\nexport function shelfView() {\n\n    function view() {\n        return m(\"#shelf\", [\n            m(breadcrumbComponent),\n            m(googleComponent),\n            m(syncStateComponent),\n            m(journalsComponent),\n        ])\n    }\n\n    return {\n        view: view\n    }\n\n}","import m from \"mithril\"\nimport { googleModel } from \"..\"\nimport { googleController } from \"../controllers\"\n\nexport function googleComponent() {\n\n    function view() {\n        return m(\"#googleApi\", [\n            preambleMessage(),\n            signInOutButton(),\n            m(\"script\", gapiScriptSettings()),\n        ])\n    }\n\n    function gapiScriptSettings() {\n        return {\n            async: true,\n            defer: true,\n            src: googleModel.src,\n            onload: () => {\n                if (!googleModel.isSignedIn) {\n                    googleController.initGapi()\n                }\n            }\n        }\n    }\n\n    function signInOutButton() {\n        return (googleModel.isSignedIn)\n            ? m(\"button\", { onclick: () => googleController.signOut(), class: \"authButton\" }, \"Sign Out\")\n            : m(\"button\", { onclick: () => googleController.signIn(), class: \"authButton\" }, \"Sign In\")\n    }\n\n    function preambleMessage() {\n        return (googleModel.isSignedIn !== undefined && !googleModel.isSignedIn)\n            ? m(\".preamble\", \"PREAMBLE MSG\") // TODO: fill out\n            : null\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\nimport { libraryModel, urlModel } from \"..\"\nimport { ShelfModel, JournalModel } from \"../models\"\n\nexport const urlController = {\n    redirect: redirect,\n    getActiveShelf: getActiveShelf,\n    getActiveJournal: getActiveJournal,\n    getBreadcrumbTrail: getBreadcrumbTrail,\n}\n\nfunction redirect(hash: string) {\n    urlModel.hash = hash\n}\n\nfunction getActiveShelf(): ShelfModel | undefined {\n    let id = urlModel.shelfId\n    if (id === undefined) return undefined\n    return libraryModel.shelves.get(id)\n}\n\nfunction getActiveJournal(): JournalModel | undefined {\n    let id = urlModel.journalId\n    let shelf =  getActiveShelf()\n    if (id === undefined || shelf === undefined) return undefined\n    return shelf.journals.get(id)\n}\n\nfunction getBreadcrumbTrail() {\n    // TODO: add dropdowns on each shelf and journal crumb\n    let breadcrumb: m.Vnode[] = []\n    let hash = urlModel.hash.split(\"/\").filter(crumb => crumb !== \"#\" && crumb !== \"\")\n    let shelfId: string | undefined = undefined\n    for (let i = 0; i < hash.length; i++) {\n        let crumb = hash[i]\n        let trail = \"#/\" + hash.slice(0, i + 1).join(\"/\")\n        if (i === 1) {\n            shelfId = crumb\n            crumb = libraryModel.shelves.get(crumb)?.title || crumb\n        } else if (i === 2 && shelfId !== undefined) {\n            crumb = libraryModel.shelves.get(shelfId)?.journals.get(parseInt(crumb))?.title || crumb\n        }\n        if (i !== 0) breadcrumb.push(m(\"span\", \" / \"))\n        if (i === hash.length - 1) {\n            breadcrumb.push(m(\"span\", `${crumb}`))\n        } else {\n            breadcrumb.push(m(\"a\", { href: trail }, `${crumb}`))\n        }\n    }\n    return breadcrumb\n}\n","export const textController = {\n    escape: escape,\n    clean: clean,\n}\n\nfunction escape(unsafe: string): string {\n    return unsafe\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n}\n\nfunction clean(content: string): string {\n    return content.toLowerCase()\n}\n","import { tagFactory } from \"../factories\"\nimport { EntryModel, TagModel } from \"../models\"\nimport { textController, syncerController } from \".\"\n\nconst tagPattern = /(\\@)([\\w-']+)+(:)?([\\w-'\\*]+)?/g\n\nexport const entryController = {\n    save: save,\n    update: update,\n\n}\n\nfunction save(entry: EntryModel, entryIdx: number, content: string, force?: boolean) {\n    if (entry.raw !== content || force) {\n        entry.saved = content\n        entry.savedClean = textController.clean(entry.savedClean)\n        entry.tags = getTags(entry.tagMatches)\n        syncerController.updateRow(entry.shelf.id, entry.journal.id, entry.journal.title, entryIdx, content)\n    }\n}\n\nfunction update(entry: EntryModel, content: string) {\n    entry.raw = content\n    entry.clean = textController.clean(content)\n    entry.safe = textController.escape(entry.raw)\n    entry.tokens = tokenize(entry.clean)\n    entry.tagMatches = getTagMatches(entry.safe)\n    entry.rendered = render(entry.safe, entry.tagMatches)\n}\n\nfunction render(text: string, tagMatches: { tag: TagModel, match: RegExpMatchArray }[]): string {\n    for (let { tag, match } of tagMatches) {\n        let chars = text.split(\"\")\n        chars.splice(match.index!, match[0].length, tag.rendered)\n        text = chars.join(\"\")\n    }\n    return text\n}\n\nfunction getTags(tagMatches: { tag: TagModel, match: RegExpMatchArray }[]): Map<string, TagModel> {\n    let tags: Map<string, TagModel> = new Map()\n    for (let { tag } of tagMatches) {\n        if (tags.has(tag.clean)) {\n            tags.get(tag.clean)!.frq += 1\n        } else {\n            tags.set(tag.clean, tag)\n        }\n    }\n    return tags\n}\n\nfunction getTagMatches(text: string): { tag: TagModel, match: RegExpMatchArray }[] {\n    let tagMatches = []\n    let matchesIter = text.matchAll(tagPattern)\n    for (let match of matchesIter) {\n        let tag = tagFactory.createTag(match[0], match[1], match[2], match[3], match[4])\n        tagMatches.push({ tag: tag, match: match })\n    }\n    tagMatches.sort((a, b) => (a.match.index! > b.match.index!) ? -1 : 1)\n    return tagMatches\n}\n\nfunction tokenize(text: string): string[] {\n    let tokens = text.split(\" \")\n    return tokens.filter(token => {\n        return token !== undefined && token.trim() !== \"\" && token !== \"-\"\n    })\n}\n","import m from \"mithril\"\nimport { TestMode } from \"../types\"\n\nexport class UrlModel {\n\n    get hash(): string {\n        let url = new URL(window.location.href)\n        return url.hash\n    }\n    set hash(hash_: string) {\n        window.location.hash = hash_\n    }\n\n    get testMode(): TestMode {\n        if (this.hash === \"#!demo\") return TestMode.DEMO\n        let test = m.route.param(\"test\")\n        return (test !== null && this.instanceOfTestMode(test)) ? test : TestMode.OFF\n    }\n\n    private instanceOfTestMode(str: string): str is TestMode {\n        return ((<any>Object).values(TestMode).includes(str))\n    }\n\n    get shelfId(): string | undefined {\n        let id = m.route.param(\"shelfId\")\n        return (id === \"\") ? undefined : id\n    }\n    // TODO: set\n\n    get journalId(): number | undefined {\n        let id = m.route.param(\"journalId\")\n        return (id === \"\") ? undefined : parseInt(id)\n    }\n    // TODO: set\n}\n","export class TagModel {\n    public frq: number\n\n    constructor(\n        public raw: string,\n        public flag: string,\n        public key: string,\n        public separator: string | null,\n        public val: string | null,\n        public clean: string,\n        public cleanKey: string,\n        public cleanVal: string | null,\n        public rendered: string\n    ) { \n        this.frq = 1\n    }\n\n}\n","import { TagModel } from \".\"\nimport { ShelfModel, JournalModel } from \"../models\"\n\nexport interface IndexedEntry { // TODO see if this can be deleted\n    idx: number,\n    entry: EntryModel,\n}\n\nexport class EntryModel {\n    public id: number\n    public shelf: ShelfModel\n    public journal: JournalModel\n\n    public raw: string = \"\"\n    public safe: string = \"\"\n    public saved: string = \"\"\n    public clean: string = \"\"\n    public tokens: string[] = []\n    public rendered: string = \"\"\n    public savedClean: string = \"\"\n    public readableRendered: string = \"\"\n    public tags: Map<string, TagModel> = new Map()\n    public tagMatches: { tag: TagModel, match: RegExpMatchArray }[] = []\n\n    constructor(shelf: ShelfModel, journal: JournalModel, entryId: number) {\n        this.id = entryId\n        this.shelf = shelf\n        this.journal = journal\n    }\n\n}\n","import { JournalModel } from \".\"\n\nexport class ShelfModel {\n    public id: string\n    public error: string | undefined\n    public title: string | undefined\n    public journals: Map<number, JournalModel> = new Map()\n\n    constructor(id: string, title?: string, error?: string) {\n        this.id = id\n        this.error = error\n        this.title = title\n    }\n\n}\n","import { SyncerState, SyncerPayload, ErrorPayload } from \"../types\"\r\n\r\nexport class SyncerModel {\r\n    public requestsCounter: number\r\n    public requests: Map<string, Function>\r\n    public state: SyncerState\r\n\r\n    constructor() {\r\n        this.requestsCounter = 0\r\n        this.requests = new Map()\r\n        this.state = SyncerState.SYNCED\r\n    }\r\n\r\n    public pushSyncerTask<P extends SyncerPayload>(payload: P, worker: Worker): Promise<P> {\r\n        let id = `payload-${this.requestsCounter++}`\r\n        return new Promise((resolve, reject) => {\r\n            this.requests.set(id, ({ payload, error }: { payload: P, error: ErrorPayload }) => {\r\n                (error) ? reject(error) : resolve(payload)\r\n            })\r\n            worker.postMessage({ id, payload })\r\n        })\r\n    }\r\n\r\n}\r\n","import { MockGapi, MockGoogleUser } from \"../mocks\"\n\nexport class GoogleModel {\n    public src: string\n    public scope: string\n    public clientId: string\n    public isSignedIn: boolean | undefined\n    public gapi_: MockGapi | typeof gapi | undefined\n    public user: gapi.auth2.GoogleUser | MockGoogleUser | undefined\n\n    constructor(isSignedIn?: boolean) {\n        this.isSignedIn = isSignedIn\n        this.src = \"https://apis.google.com/js/api.js\"\n        this.scope = [\n            \"https://www.googleapis.com/auth/spreadsheets\",\n        ].join(\" \")\n        this.clientId = \"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com\"\n    }\n\n    get token(): string | undefined {\n        if (!this.user) return\n        let auth = this.user.getAuthResponse()\n        return auth.access_token\n    }\n}\n","import { EntryModel, TagModel } from \".\"\nimport { entryFactory } from \"../factories\"\nimport { ShelfModel } from \"./ShelfModel\"\n\nexport class JournalModel {\n    public id: number\n    public title: string\n    public shelf: ShelfModel\n    public entryCounter: number\n    public tags: Map<string, TagModel>\n    public entries: { id: number, entry: EntryModel }[]\n\n    constructor(shelf: ShelfModel, journalId: number, journalTitle: string) {\n        this.id = journalId\n        this.entries = []\n        this.title = journalTitle\n        this.tags = new Map()\n        this.entryCounter = 0\n        this.shelf = shelf\n    }\n\n    public addEntry(idx: number, content: string) {\n        let id = this.entryCounter += 1\n        let entry = entryFactory.createEntry(this.shelf, this, id, idx, content)\n        this.entries.splice(idx, 0, { id, entry })\n    }\n\n    public updateEntry(idx: number, content: string) {\n        this.entries[idx].entry.saved = content\n    }\n\n    public deleteEntry(idx: number) {\n        this.entries.splice(idx, 1)[0]\n    }\n\n    public moveEntry(fromIdx: number, toIdx: number) {\n        let entry = this.entries.splice(fromIdx, 1)[0]\n        this.entries.splice(toIdx, 0, entry)\n    }\n\n}\n","import { ShelfModel } from \".\"\n\nexport class LibraryModel {\n    public shelves: Map<string, ShelfModel | undefined>\n\n    constructor() {\n        this.shelves = new Map()\n        this.shelfIds.forEach(id => this.shelves.set(id, undefined))\n    }\n\n    set shelfIds(ids: string[]) {\n        localStorage.setItem(\"spreadsheetIds\", ids.join(\",\"))\n    }\n    get shelfIds(): string[] {\n        let ids = localStorage.getItem(\"spreadsheetIds\")\n        return (ids === null) ? [] : ids.split(\",\")\n    }\n\n}\n","import { FriendlyError } from \"../errors\"\n\nexport class ServiceWorkerModel {\n    constructor() {\n        if (\"serviceWorker\" in navigator) {\n            window.addEventListener(\"load\", async () => {\n                await navigator.serviceWorker.register(\"../serviceWorker.js\")\n            })\n        } else {\n            throw new FriendlyError(\"serviceWorker not supported\", \"Your browser is not supported.\")\n        }\n    }\n}\n","import m from \"mithril\"\n\nexport class FriendlyError extends Error {\n    constructor(errorMsg: string, public friendlyMsg: string) {\n        super(errorMsg)\n        console.warn(errorMsg)\n        // journal.errors.push(friendlyMsg) // TODO reassign\n        m.redraw()\n    }\n}\n","import { ShelfModel, JournalModel } from \"../models\"\n\nexport const shelfFactory = {\n    createShelf: createShelf,\n}\n\nfunction createShelf(spreadsheetId: string, spreadsheet?: gapi.client.sheets.Spreadsheet, error?: string) {\n    if (\n        spreadsheet !== undefined &&\n        spreadsheet.spreadsheetId !== undefined &&\n        spreadsheet.properties !== undefined &&\n        spreadsheet.properties.title !== undefined &&\n        spreadsheet.sheets !== undefined\n    ) {\n        let shelf = new ShelfModel(spreadsheet.spreadsheetId, spreadsheet.properties.title)\n        let journals = getJournals(shelf, spreadsheet.sheets)\n        journals.forEach(journal => shelf.journals.set(journal.id, journal))\n    }\n    return new ShelfModel(spreadsheetId, undefined, error)\n}\n\nfunction getJournals(shelf: ShelfModel, sheets: gapi.client.sheets.Sheet[]) {\n    let journals: JournalModel[] = []\n    sheets.forEach(sheet => {\n        if (\n            sheet.properties !== undefined &&\n            sheet.properties.title !== undefined &&\n            sheet.properties.sheetId !== undefined\n        ) {\n            let journal = new JournalModel(\n                shelf, sheet.properties.sheetId, sheet.properties.title\n            )\n            if (journal === undefined) return\n            journals.push(journal)\n        }\n    })\n    return journals\n}\n","import { entryController } from \"../controllers\"\nimport { EntryModel, ShelfModel, JournalModel } from \"../models\"\n\nexport const entryFactory = {\n    createEntry: createEntry\n}\n\nfunction createEntry(shelf: ShelfModel, journal: JournalModel, entryId: number, entryIdx: number, content: string) {\n    let entry = new EntryModel(shelf, journal, entryId)\n    entryController.update(entry, content)\n    entryController.save(entry, entryIdx, content, true)\n    return entry\n}\n","export const caretController = {\n    getCaretPosition: getCaretPosition,\n    setCaretPosition: setCaretPosition,\n}\n\nfunction node_walk(node: any, func: any): void {\n    var result = func(node)\n    for (node = node.firstChild; result !== false && node; node = node.nextSibling)\n        result = node_walk(node, func)\n    return\n}\n\nfunction getCaretPosition(elem: any) {\n    var sel: any = window.getSelection()\n    var cum_length = [0, 0]\n\n    if (sel.anchorNode == elem) {\n        cum_length = [sel.anchorNode.innerText.length, sel.extentNode.innerText.length]\n    } else {\n        var nodes_to_find = [sel.anchorNode, sel.extentNode]\n        if (!elem.contains(sel.anchorNode) || !elem.contains(sel.extentNode)) {\n            return undefined\n        } else {\n            var found = [0, 0]\n            var i\n            node_walk(elem, function (node: any): void {\n                for (i = 0; i < 2; i++) {\n                    if (node == nodes_to_find[i]) {\n                        found[i] = 1\n                        if (found[i == 0 ? 1 : 0]) {\n                            return\n                        }\n                    }\n                }\n                if (node.textContent && !node.firstChild) {\n                    for (i = 0; i < 2; i++) {\n                        if (!found[i]) {\n                            cum_length[i] += node.textContent.length\n                        }\n                    }\n                }\n            })\n            cum_length[0] += sel.anchorOffset\n            cum_length[1] += sel.extentOffset\n        }\n    }\n    if (cum_length[0] <= cum_length[1]) {\n        return cum_length\n    }\n    return [cum_length[1], cum_length[0]]\n}\n\nfunction setCaretPosition(el: any, pos: any): any {\n    if (el !== null && pos !== null) {\n        for (var node of el.childNodes) {\n            if (node.nodeType == 3) {\n                if (node.length >= pos) {\n                    let range = document.createRange()\n                    let sel: any = window.getSelection()\n                    range.setStart(node, pos)\n                    range.collapse(true)\n                    sel.removeAllRanges()\n                    sel.addRange(range)\n                    return -1\n                } else {\n                    pos -= node.length\n                }\n            } else {\n                pos = setCaretPosition(node, pos)\n                if (pos == -1) {\n                    return -1\n                }\n            }\n        }\n        return pos\n    }\n}\n","import m from \"mithril\"\r\nimport { MockGapi } from \"../mocks\"\r\nimport { TestMode } from \"../types\"\r\nimport { googleModel, urlModel } from \"..\"\r\nimport { syncerController, libraryController } from \"../controllers\"\r\n\r\nexport const googleController = {\r\n    signIn: signIn,\r\n    signOut: signOut,\r\n    initGapi: initGapi,\r\n}\r\n\r\nfunction signOut() {\r\n    googleModel.gapi_!.auth2.getAuthInstance().signOut()\r\n}\r\n\r\nfunction signIn() {\r\n    googleModel.gapi_!.auth2.getAuthInstance().signIn()\r\n}\r\n\r\nfunction initGapi() {\r\n    let gapi_ = (urlModel.testMode === TestMode.OFF) ? gapi : new MockGapi()\r\n    googleModel.gapi_ = gapi_\r\n    googleModel.gapi_.load('auth2', () => {\r\n        googleModel.gapi_!.auth2.init({\r\n            scope: googleModel.scope, client_id: googleModel.clientId\r\n        }).then(() => {\r\n            googleModel.gapi_!.auth2.getAuthInstance().isSignedIn.listen(isSignedIn)\r\n            isSignedIn((googleModel.gapi_!.auth2.getAuthInstance().isSignedIn.get()))\r\n        })\r\n    })\r\n\r\n}\r\n\r\nasync function isSignedIn(signedIn: boolean) {\r\n    googleModel.isSignedIn = signedIn\r\n    if (googleModel.isSignedIn) {\r\n        googleModel.user = googleModel.gapi_!.auth2.getAuthInstance().currentUser.get()\r\n        syncerController.updateAuth(googleModel.token)\r\n        libraryController.loadShelves()\r\n    } else {\r\n        libraryController.removeShelves()\r\n    }\r\n    m.redraw()\r\n\r\n    // if (getTestMode() === TestMode.DEMO) {\r\n    //     journal.isSignedIn = true\r\n    //     journal.load(\"https://docs.google.com/spreadsheets/d/demo/edit\")\r\n    //     return []\r\n    // }\r\n}\r\n","export * from \"./Gapi\"\n","export class MockGapi {\n    public auth2 = new MockAuth2()\n    public load(_api: string, _callback: () => void) {\n        _callback()\n    }\n}\n\nclass MockAuth2 {\n    public getAuthInstance() {\n        return new MockGoogleAuth()\n    }\n    public async init(_params: any) { }\n}\n\nclass MockCurrentUser {\n    public get() { return new MockGoogleUser() }\n}\n\nexport class MockGoogleUser {\n    public getAuthResponse() {\n        return {\n            expires_in: 9999,\n            access_token: \"faketoken\"\n        }\n    }\n    public async reloadAuthResponse() {\n        return {\n            expires_in: 9999,\n            access_token: \"faketoken\"\n        }\n    }\n}\n\nclass MockGoogleAuth {\n    public isSignedIn = new MockIsSignedIn()\n    public signOut() { }\n    public signIn() { }\n    public currentUser = new MockCurrentUser()\n}\n\nclass MockIsSignedIn {\n    public listen = (_callback: any) => { }\n    public get = () => { return true }\n}\n","import m from \"mithril\"\r\nimport { FriendlyError } from \"../errors\"\r\nimport { googleModel, syncerModel } from \"..\"\r\nimport { SyncerPayloadType, TestMode, SyncerPayload, ErrorPayload } from \"../types\"\r\n\r\nconst worker = new Worker(\"./js/syncWebWorker.js\")\r\nworker.onmessage = (msg: MessageEvent) => onMessage(msg)\r\n\r\nexport const syncerController = {\r\n    unpause: unpause,\r\n    getRows: getRows,\r\n    deleteRow: deleteRow,\r\n    updateRow: updateRow,\r\n    getSheets: getSheets,\r\n    updateAuth: updateAuth,\r\n    updateTestMode: updateTestMode,\r\n    getSpreadsheet: getSpreadsheet,\r\n}\r\n\r\nasync function updateTestMode(testMode: TestMode) {\r\n    return await syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.TEST_MODE_UPDATE,\r\n        testMode: testMode,\r\n    }, worker)\r\n}\r\n\r\nfunction updateAuth(token: string | undefined) {\r\n    if (token === undefined) return\r\n    return syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.AUTH_UPDATE,\r\n        token: token,\r\n    }, worker)\r\n}\r\n\r\nfunction getSpreadsheet(spreadsheetId: string) {\r\n    return syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.GET_SPREADSHEET,\r\n        spreadsheetId: spreadsheetId,\r\n        spreadsheet: undefined\r\n    }, worker)\r\n}\r\n\r\nfunction getSheets(spreadsheetId: string) {\r\n    return syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.GET_SHEETS,\r\n        spreadsheetId: spreadsheetId,\r\n        sheets: []\r\n    }, worker)\r\n}\r\n\r\nfunction getRows(spreadsheetId: string, sheetId: number, sheetTitle: string) {\r\n    return syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.GET_ROWS,\r\n        spreadsheetId: spreadsheetId,\r\n        sheetTitle: sheetTitle,\r\n        sheetId: sheetId,\r\n        rows: []\r\n    }, worker)\r\n}\r\n\r\nasync function deleteRow(idx: number, spreadsheetId: string, sheetId: number) {\r\n    return await syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.DELETE_ROW,\r\n        spreadsheetId: spreadsheetId,\r\n        sheetId: sheetId,\r\n        idx: idx,\r\n    }, worker)\r\n}\r\n\r\nasync function updateRow(shelfId: string, journalId: number, journalTitle: string, idx: number, content: string) {\r\n    return await syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.UPDATE_ROW,\r\n        spreadsheetId: shelfId,\r\n        sheetTitle: journalTitle,\r\n        sheetId: journalId,\r\n        content: content,\r\n        idx: idx,\r\n    }, worker)\r\n}\r\n\r\n// TODO: updateRow\r\n\r\nasync function unpause() {\r\n    return await syncerModel.pushSyncerTask({\r\n        type: SyncerPayloadType.UNPAUSE\r\n    }, worker)\r\n}\r\n\r\nfunction onMessage(msg: MessageEvent) {\r\n    let { id, payload, error }: { id: string | null, payload: SyncerPayload, error: ErrorPayload } = msg.data\r\n    if (id !== null && syncerModel.requests.has(id)) {\r\n        syncerModel.requests.get(id)!({ payload, error })\r\n        syncerModel.requests.delete(id)\r\n    } else {\r\n        switch (payload.type) {\r\n            case SyncerPayloadType.SYNC_STATE:\r\n                syncerModel.state = payload.state\r\n                m.redraw()\r\n                break\r\n            case SyncerPayloadType.ERROR:\r\n                new FriendlyError(payload.error.message, payload.friendlyMsg)\r\n                break\r\n            case SyncerPayloadType.TOKEN_REQUEST:\r\n                updateAuth(googleModel.token)\r\n                break\r\n        }\r\n    }\r\n}\r\n\r\n","import m from \"mithril\"\nimport { libraryModel } from \"..\"\nimport { ErrorPayload } from \"../types\"\nimport { FriendlyError } from \"../errors\"\nimport { shelfFactory } from \"../factories\"\nimport { syncerController } from \"../controllers\"\n\nconst spreadsheetIdPattern = /\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/g\n\nexport const libraryController = {\n    addShelves: addShelves,\n    loadShelves: loadShelves,\n    removeShelves: removeShelves,\n    getSpreadsheetIdsFromUrls: getSpreadsheetIdsFromUrls,\n}\n\nfunction addShelves(urls: string) {\n    let ids = getSpreadsheetIdsFromUrls(urls)\n    ids = ids.filter(id => !libraryModel.shelves.has(id))\n    ids.forEach(id => libraryModel.shelves.set(id, undefined))\n    libraryModel.shelfIds = Array.from(libraryModel.shelves.keys())\n    loadShelves(false, ids)\n}\n\nfunction removeShelves(ids?: string[]) {\n    if (ids === undefined) ids = Array.from(libraryModel.shelves.keys())\n    ids = ids.filter(id => libraryModel.shelves.has(id))\n    ids.forEach(id => libraryModel.shelves.delete(id))\n    libraryModel.shelfIds = Array.from(libraryModel.shelves.keys())\n}\n\nfunction loadShelves(reloadLoaded?: boolean, ids?: string[]) {\n    if (ids === undefined) ids = Array.from(libraryModel.shelves.keys())\n    if (reloadLoaded) {\n        ids.forEach(id => libraryModel.shelves.set(id, undefined))\n        m.redraw()\n    }\n    ids.filter(id => !libraryModel.shelves.get(id))\n        .forEach(id => syncerController.getSpreadsheet(id)\n        .then(payload => {\n            let shelf = shelfFactory.createShelf(id, payload.spreadsheet)\n            libraryModel.shelves.set(shelf.id, shelf)\n        })\n        .catch((error: ErrorPayload) => {\n            new FriendlyError(error.error.message, error.friendlyMsg)\n            let shelf = shelfFactory.createShelf(id, undefined, error.friendlyMsg)\n            libraryModel.shelves.set(id, shelf)\n        })\n        .finally(() => {\n            m.redraw()\n        })\n    )\n}\n\nfunction getSpreadsheetIdsFromUrls(urls: string | undefined): string[] {\n    let ids: string[] = []\n    if (urls) {\n        Array.from(urls.matchAll(spreadsheetIdPattern)).forEach(m => ids.push(m[1]))\n    }\n    return ids\n}\n","import { JournalModel, TagModel } from \"../models\"\nimport { tagFactory } from \"../factories/tagFactory\"\n\nexport const journalController = {\n    addEntry: addEntry,\n    updateEntry: updateEntry,\n    deleteEntry: deleteEntry,\n    moveEntry: moveEntry,\n}\n\nfunction addEntry(journal: JournalModel, idx: number, content: string) {\n    journal.addEntry(idx, content)\n    journal.tags = buildTags(journal)\n}\n\nfunction updateEntry(journal: JournalModel, idx: number, content: string) {\n    if (journal.entries[idx].entry.saved === content) return\n    journal.updateEntry(idx, content)\n    journal.tags = buildTags(journal)\n}\n\nfunction deleteEntry(journal: JournalModel, idx: number) {\n    journal.deleteEntry(idx)\n    journal.tags = buildTags(journal)\n}\n\nfunction moveEntry(journal: JournalModel, fromIdx: number, toIdx: number) {\n    if (fromIdx === toIdx) return\n    journal.moveEntry(fromIdx, toIdx)\n    journal.tags = buildTags(journal)\n}\n\nfunction buildTags(journal: JournalModel): Map<string, TagModel> {\n    let tags: Map<string, TagModel> = new Map()\n    let entries = Array.from(journal.entries.values())\n    for (let { entry } of entries.reverse()) {\n        for (let [key, tag] of entry.tags) {\n            if (tags.has(key)) {\n                tags.get(key)!.frq += tag.frq\n            } else {\n                tags.set(key, tagFactory.createTag(tag.raw, tag.flag, tag.key, tag.separator, tag.val))\n            }\n        }\n    }\n    return tags\n}\n","import m from \"mithril\"\nimport { Caret } from \"../types\"\nimport { JournalModel, EntryModel } from \"../models\"\nimport { caretController, urlController, entryController, journalController } from \"../controllers\"\n\nexport function entriesComponent() {\n    var caret: Caret = { pos: null, el: null }\n\n    function view() {\n        let shelf = urlController.getActiveShelf()\n        let journal = urlController.getActiveJournal()\n        if (!shelf || !journal) return null // TODO: redirect\n\n        return m(\"#entries\", [\n            m(\".tempguidancePre\", \"Entries\"),\n            entriesList(journal),\n        ])\n    }\n\n    function entriesList(journal: JournalModel) {\n        return journal.entries.map(({ entry }, entryIdx) => entryVnode(entry, entryIdx))\n    }\n\n    function entryVnode(entry: EntryModel, entryIdx: number): m.Vnode {\n        return m(\".entryWrap\", { id: `entry-${entry.id}` }, [\n            entryContent(entry, entryIdx),\n            deleteEntryButton(entry, entryIdx),\n        ])\n    }\n\n    function deleteEntryButton(entry: EntryModel, entryIdx: number) {\n        return m(\"button\", {\n            class: \"del\",\n            onclick: async () => journalController.deleteEntry(entry.journal, entryIdx)\n        }, \"del\")\n    }\n\n    function entryContent(entry: EntryModel, entryIdx: number) {\n        return m(\"div\", entryContentSettings(entry, entryIdx), m.trust(entry.rendered))\n    }\n\n    function onEntryKeydown(event: any) {\n        event.redraw = false\n        if (event.keyCode == 13 && !event.shiftKey) {\n            event.preventDefault()\n            event.target.blur()\n        }\n    }\n\n    function onEntryInput(event: any, entry: EntryModel) {\n        let pos = caretController.getCaretPosition(event.target)\n        caret = { pos: (pos) ? pos[1] : null, el: event.target }\n        entryController.update(entry, event.target.innerText)\n    }\n\n    function onEntryUpdate(event: any) {\n        event.redraw = false\n        caretController.setCaretPosition(caret.el, caret.pos)\n        caret = { pos: null, el: null }\n    }\n\n    async function onEntryBlur(event: any, entry: EntryModel, entryIdx: number) {\n        event.redraw = false\n        entryController.save(entry, entryIdx, event.target.innerText)\n    }\n\n    function entryContentSettings(entry: EntryModel, entryIdx: number) {\n        return {\n            id: `entry-${entryIdx}-content`,\n            contenteditable: \"true\",\n            class: \"entry breakwrap column\",\n            onkeydown: (event: any) => onEntryKeydown(event),\n            oninput: (event: any) => onEntryInput(event, entry),\n            onupdate: (event: any) => onEntryUpdate(event),\n            onblur: (event: any) => onEntryBlur(event, entry, entryIdx),\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\nimport { libraryModel } from \"..\"\nimport { ShelfModel } from \"../models\"\nimport { libraryController } from \"../controllers\"\n\nexport function shelvesComponent() {\n\n    function view() {\n        let shelves = Array.from(libraryModel.shelves.entries())\n        return m(\"#shelvesList\", shelves.map(([id, shelf]) => shelfNode(id, shelf)))\n    }\n\n    function delShelfButton(id: string) {\n        return m(\"button\", {\n            class: \"del\",\n            onclick: () => libraryController.removeShelves([id])\n        }, \"del\")\n    }\n\n    function retryShelfLoadButton(id: string) {\n        return m(\"button\", {\n            onclick: () => libraryController.loadShelves(true, [id])\n        }, \"retry\")\n    }\n\n    function shelfNode(id: string, shelf: ShelfModel | undefined) {\n        if (shelf === undefined) {\n            return m(\"li\", [\n                delShelfButton(id),\n                m(\"span\", id)\n            ])\n        } else if (shelf.error !== undefined) {\n            return m(\"li\", [\n                delShelfButton(id),\n                m(\"span\", `${id} ${shelf.error}`),\n                retryShelfLoadButton(id)\n            ])\n        } else {\n            return m(\"li\", [\n                delShelfButton(id),\n                m(\"a\", { href: `#/library/${id}` }, shelf.title)\n            ])\n        }\n    }\n\n    return {\n        view: view,\n    }\n\n}","import m from \"mithril\"\nimport { urlController } from \"../controllers\"\n\nexport function journalsComponent() {\n\n    function view() {\n        return m(\"#journals\", journalList())\n    }\n\n    function journalList() {\n        let shelf = urlController.getActiveShelf()\n        if (shelf === undefined) {\n            urlController.redirect(\"/library\")\n            return\n        }\n        return Array.from(shelf.journals.values()).map(journal => {\n            let link = `#/library/${journal.shelf.id}/${journal.id}`\n            return m(\"li\", m(\"a\", { href: link }, journal.title))\n        })\n    }\n\n    return {\n        view: view,\n    }\n\n}","import m from \"mithril\"\nimport { syncerModel } from \"..\"\nimport { SyncerState } from \"../types\"\nimport { syncerController } from \"../controllers\"\n\nexport function syncStateComponent() {\n\n    function view() {\n        return m(\"#status\", m(\"span\", syncState()))\n    }\n\n    function syncState() {\n        return m(\"span\", [\n            syncStateIcon(),\n            syncStateText(),\n            unpauseSync()\n        ])\n    }\n\n    function syncStateText() {\n        let txt = \"\"\n        let class_ = `syncState ${stateColorClass()}`\n\n        switch (syncerModel.state) {\n            case SyncerState.DOWNLOADING:\n                txt = \"Downloading journal data from drive...\"\n                break\n            case SyncerState.PAUSED:\n                txt = \"Warning! - Syncing is paused.\"\n                break\n            case SyncerState.SYNCED:\n                txt = \"All changes saved.\"\n                break\n            case SyncerState.UPLOADING:\n                txt = \"Uploading changes to drive...\"\n                break\n        }\n        return m(\"span\", { id: \"syncStateText\", class: class_ }, txt)\n    }\n\n    function syncStateIcon() {\n        let class_ = `material-icons material-icons-outlined syncState ${stateColorClass()}`\n        return m(\"i\", { id: \"syncStateIcon\", class: class_ }, syncerModel.state)\n    }\n\n    function unpauseSync() {\n        if (syncerModel.state === SyncerState.PAUSED) {\n            return m(\"button\", {\n                id: \"unpauseSync\",\n                class: \"syncState\",\n                onclick: () => syncerController.unpause()\n            }, \"Unpause Syncing\")\n        }\n        return\n    }\n\n    function stateColorClass() {\n        switch (syncerModel.state) {\n            case SyncerState.PAUSED:\n                return \"error\"\n            case SyncerState.SYNCED:\n                return \"okay\"\n            default:\n                return \"warn\"\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\r\nimport { libraryController } from \"../controllers\"\r\n\r\nexport function addShelvesComponent() {\r\n\r\n    let newShelfUrls = \"\"\r\n    let addingShelves = false\r\n\r\n    function view() {\r\n        return m(\"#addShelves\", [\r\n            addShelvesButton(),\r\n            addShelvesTextbox(),\r\n        ])\r\n    }\r\n\r\n    function addShelvesButton() {\r\n        return m(\"button\", {\r\n            id: \"addShelvesButton\",\r\n            onclick: async () => {\r\n                if (addingShelves) libraryController.addShelves(newShelfUrls)\r\n                newShelfUrls = \"\"\r\n                addingShelves = !addingShelves\r\n            }\r\n        }, (addingShelves) ? \"  \" : \"+/-\")\r\n    }\r\n\r\n    function addShelvesTextbox() {\r\n        if (!addingShelves) return null\r\n        return m(\"textarea\", {\r\n            id: \"addShelvesText\",\r\n            placeholder: \"Enter list of Google Sheets Spreadsheet URLs here\",\r\n            oninput: (event: any) => newShelfUrls = event.target.value\r\n        })\r\n    }\r\n\r\n    return {\r\n        view: view,\r\n    }\r\n\r\n}","import m from \"mithril\"\nimport { urlController } from \"../controllers\"\n\nexport function breadcrumbComponent() {\n\n    function view() {\n        return m(\"#breadcrumb\", urlController.getBreadcrumbTrail())\n    }\n\n    return {\n        view: view,\n    }\n\n}","import m from \"mithril\"\r\nimport { googleModel } from \"..\"\r\nimport { googleComponent } from \"../components\"\r\n\r\nexport function signinView() {\r\n\r\n    function view() {\r\n        return m(\"#auth\", [\r\n            m(googleComponent),\r\n        ])\r\n    }\r\n\r\n    function onupdate() {\r\n        if (googleModel.isSignedIn) {\r\n            window.location.hash = \"/library\" // TODO: redirect to correct place\r\n        }\r\n    }\r\n\r\n    return {\r\n        view: view,\r\n        onupdate: onupdate,\r\n    }\r\n\r\n}","import m from \"mithril\"\nimport { \n    googleComponent, shelvesComponent, syncStateComponent, addShelvesComponent\n} from \"../components\"\n\nexport function libraryView() {\n\n    function view() {\n        return m(\"#library\", [\n            m(googleComponent),\n            m(syncStateComponent),\n            m(addShelvesComponent),\n            m(shelvesComponent),\n        ])\n    }\n\n    return {\n        view: view\n    }\n\n}","import m from \"mithril\"\nimport { urlController } from \"../controllers\"\nimport { googleComponent, breadcrumbComponent, entriesComponent } from \"../components\"\n\nexport function journalView() {\n\n    function view() {\n        let shelf = urlController.getActiveShelf()\n        let journal = urlController.getActiveJournal()\n\n        return m(\"#shelf\", [\n            m(breadcrumbComponent),\n            m(googleComponent),\n            m(\"span\", `Shelf: ${shelf?.title}, Journal: ${journal?.title}`),\n            m(entriesComponent)\n        ])\n    }\n\n    return {\n        view: view\n    }\n\n}\n"],"sourceRoot":""}