{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index.ts","webpack:///external \"m\"","webpack:///./src/helpers/index.ts","webpack:///./src/types/index.ts","webpack:///./src/classes/index.ts","webpack:///./src/workers/sync/index.ts","webpack:///./src/types/search.ts","webpack:///./src/types/testing.ts","webpack:///./src/types/syncerTasks.ts","webpack:///./src/types/syncerResponses.ts","webpack:///./src/workers/sync/syncTasks.ts","webpack:///./src/workers/sync/typeGuards.ts","webpack:///./src/workers/sync/syncResponses.ts","webpack:///./src/mocks/index.ts","webpack:///./src/mocks/Gapi.ts","webpack:///./src/mocks/syncTasks.ts","webpack:///./src/classes/Tag.ts","webpack:///./src/helpers/misc.ts","webpack:///./src/helpers/errors.ts","webpack:///./src/helpers/textOps.ts","webpack:///./src/helpers/caretOps.ts","webpack:///./src/helpers/patterns.ts","webpack:///./src/helpers/localStorageOps.ts","webpack:///./src/classes/Entry.ts","webpack:///./src/classes/Sheet.ts","webpack:///./src/classes/Syncer.ts","webpack:///./src/classes/Search.ts","webpack:///./src/classes/Journal.ts","webpack:///./src/classes/Spreadsheet.ts","webpack:///./src/classes/ServiceWorker.ts","webpack:///./src/components/index.ts","webpack:///./src/components/refines.ts","webpack:///./src/components/errors.ts","webpack:///./src/components/spinner.ts","webpack:///./src/components/compose.ts","webpack:///./src/components/entries.ts","webpack:///./src/components/toggles.ts","webpack:///./src/components/searchbar.ts","webpack:///./src/components/googleAPI.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","serviceWorker","ServiceWorker","testMode","getTestMode","syncer","Syncer","search","Search","journal","Journal","document","getElementById","mount","view","spinner","googleAPI","errors","searchbar","toggles","refines","class","entries","compose","Tag","Entry","Sheet","Spreadsheet","syncRate","ms","Promise","resolve","setTimeout","SyncerError","Error","msg","needsReAuth","super","SearchType","TestMode","SyncerTaskType","SyncerResponseType","extendSheetLength","token","task","url","spreadsheetId","opts","method","cache","headers","Authorization","response","fetch","ok","json","sheets","error","JSON","stringify","status","range","sheetTitle","data","values","map","row","idx","URL","params","valueInputOption","keys","forEach","searchParams","append","body","majorDimension","content","toString","message","includes","this","extendSheet","sheetId","startRowIndex","endRowIndex","startColumnIndex","requests","deleteRange","shiftDimension","appendDimension","dimension","length","type","ROWS","SHEETS","QUEUE_STATE","ERROR","REAUTH","GET_SHEETS","AUTH_UPDATE","GET_ROWS","UPDATE_ROW","DELETE_ROW","TEST_MODE_UPDATE","UNPAUSE","postResponse","postMessage","rows","paused","auth2","MockAuth2","_api","_callback","MockGoogleAuth","_params","MockCurrentUser","MockGoogleUser","expires_in","access_token","isSignedIn","MockIsSignedIn","currentUser","listen","_token","_task","FAIL_GET_SPREADSHEET_SHEETS","FAIL_GET_RANGE","RETURN_ROWS","FAIL_UPDATE_RANGE","FAIL_DELETE_ROW","raw","flag","separator","val","frq","undefined","clean","cleanTagString","cleanKey","cleanVal","hideKeys","replace","renderVal","renderKey","str","escapeHtml","endsWith","substring","toLowerCase","window","location","href","pathname","DEMO","test","OFF","FriendlyError","errorMessage","friendlyMessage","push","console","warn","redraw","unsafe","elem","sel","getSelection","cum_length","anchorNode","innerText","extentNode","nodes_to_find","contains","found","node_walk","node","func","result","firstChild","nextSibling","textContent","anchorOffset","extentOffset","setCaretPosition","el","pos","childNodes","nodeType","createRange","setStart","collapse","removeAllRanges","addRange","tagPattern","spreadsheetIdPattern","id","localStorage","setItem","getItem","urls","hide","parseInt","removeItem","saved","tags","Map","hovered","focused","tokens","rendered","savedClean","tagMatches","readableRendered","rawText","savedText","getTags","safe","getTokens","getTagMatches","render","text","tag","match","chars","split","splice","index","join","has","set","matchesIter","matchAll","sort","a","b","filter","trim","title","spreadsheet","getRows","switch","entry","Array","from","reverse","user","worker","Worker","updateTestMode","onmessage","onMessage","pushSyncerTask","instanceOfQueueStateResponse","loading","instanceOfSheetsResponse","spreadsheets","load","instanceOfRowsResponse","instanceOfErrorResponse","instanceOfReauthResponse","reloadAuthResponse","then","auth","updateAuth","catch","err","barQuery","searchType","NONE","refinesQuery","Set","vals","simpleKeys","query","AND","OR","sourceEntries","sheet","every","some","startsWith","entryInFocus","hideTagRefines","hideEntriesKeys","showAddSpreadsheetTextbox","spreadsheetUrls","getStoredHideTagRefines","getStoredHideEntriesKeys","incomingSpreadsheetIds","getSpreadsheetIdsFromUrls","loadNewSpreadsheets","removeOldSpreadsheets","getStoredSpreadsheetId","getStoredSpreadsheetSheetId","reset","setStoredSpreadsheetId","setStoredSpreadsheetSheetId","spreadsheetIds","spreadsheet_id","delStoredSpreadsheetSheetId","delete","ids","matches","deleteRow","updateRow","getSheets","properties","navigator","addEventListener","register","expanded","simpleRefinesVnodes","simple","buildRefines","size","refineKeyVnode","refineValVnode","complexRefinesVnodes","complex","count","onclick","event","metaKey","ctrlKey","add","refineTagKeyOnClick","tagRefineKeySettings","checked","tagRefineValSettings","tagClass","hideClass","refineTagValOnClick","simpleRefines","complexRefines","errorDismissButtonSettings","spinnerVnode","unpauseVnode","unpause","caret","composePrefix","composeContent","composeSuffix","prefixSettings","entrySettings","suffixSettings","composeNodeSettings","extraSettings","baseSettings","contenteditable","onkeydown","keyCode","shiftKey","preventDefault","newEntry","saveEntry","composeKeydown","oninput","getCaretPosition","target","composeInput","onupdate","assign","trust","entriesVnodes","searchEntries","entryVnode","entryContent","deleteEntryButton","deleteEntry","blur","onEntryKeydown","onEntryInput","onblur","onEntryBlur","onmouseover","onEntryMouseover","onmouseout","onEntryMouseout","onfocus","onEntryFocus","entryContentSettings","for","disabled","setStoredHideEntriesKeys","setStoredHideTagRefines","placeholder","onSearchInput","onSearchKeydown","scope","gapi_","initClient","init","client_id","getAuthInstance","updateSigninStatus","signedIn","getAuthResponse","getStoredSpreadsheetUrls","initJournal","unload","addSpreadsheetButton","setStoredSpreadsheetUrls","onchange","selected","substr","isActive","signOut","signIn","async","defer","src","onload","gapi","MockGapi"],"mappings":"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","file":"dntd.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import m from \"mithril\"\nimport { getTestMode } from \"./helpers\"\nimport { Journal, Search, Syncer, ServiceWorker } from \"./classes\"\nimport { googleAPI, compose, entries, searchbar, toggles, spinner, refines, errors } from \"./components\"\n\nexport const serviceWorker = new ServiceWorker()\nexport const testMode = getTestMode()\nexport const syncer = new Syncer(testMode)\nexport const search = new Search()\nexport const journal = new Journal()\n\nlet mountPoint = document.getElementById(\"dntd\")\nif (mountPoint !== null) { m.mount(document.getElementById(\"dntd\")!, app) }\n\nfunction app() {\n\n    function view() {\n        return [\n            m(spinner),\n            m(googleAPI),\n            m(\"#errorsWrap\", m(errors)),\n            (journal.isActive)\n                ? [\n                    m(\"#searchWrap\", [\n                        m(searchbar),\n                        m(toggles)\n                    ]),\n                    m(refines),\n                    m(\"#entriesWrap\", entriesWrappSettings(), [\n                        m(entries),\n                        m(compose),\n                    ]),\n                ]\n                : [],\n        ]\n    }\n\n    function entriesWrappSettings() {\n        return { class: (journal.hideTagRefines) ? \"fullWidth\" : \"\" }\n    }\n\n    return { view: view }\n}\n","module.exports = m;","export * from \"./misc\"\nexport * from \"./errors\"\nexport * from \"./textOps\"\nexport * from \"./caretOps\"\nexport * from \"./patterns\"\nexport * from \"./localStorageOps\"\n","export * from \"./caret\"\nexport * from \"./errors\"\nexport * from \"./search\"\nexport * from \"./testing\"\nexport * from \"./syncerTasks\"\nexport * from \"./syncerResponses\"\n","export { Tag } from \"./Tag\"\nexport { Entry } from \"./Entry\"\nexport { Sheet } from \"./Sheet\"\nexport { Syncer } from \"./Syncer\"\nexport { Search } from \"./Search\"\nexport { Journal } from \"./Journal\"\nexport { Spreadsheet } from \"./Spreadsheet\"\nexport { ServiceWorker } from \"./ServiceWorker\"\n","export * from \"./syncTasks\"\nexport * from \"./typeGuards\"\nexport * from \"./syncWebWorker\"\nexport * from \"./syncResponses\"\n\nexport const syncRate = 500 // ms\n\nexport async function sleep(ms: number) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport class SyncerError extends Error {\n    constructor(msg: string, public needsReAuth: boolean) {\n        super(msg)\n    }\n}\n","export enum SearchType {\n    NONE,\n    AND,\n    OR,\n}\n","export enum TestMode {\n    OFF = \"0\",\n    WORKING = \"1\",\n    FAIL_GET_SPREADSHEET_SHEETS = \"2\",\n    FAIL_GET_RANGE = \"3\",\n    FAIL_UPDATE_RANGE = \"4\",\n    FAIL_DELETE_ROW = \"5\",\n    RETURN_ROWS = \"6\",\n    DEMO = \"7\"\n}\n","import { TestMode } from \"./testing\"\n\nexport type SyncerTask = AuthUpdateTask | DeleteRowTask | UpdateRowTask | GetRowsTask | GetSheetsTask | TestModeUpdateTask | UnpauseTask\n\nexport enum SyncerTaskType {\n    AUTH_UPDATE,\n    DELETE_ROW,\n    UPDATE_ROW,\n    GET_ROWS,\n    GET_SHEETS,\n    TEST_MODE_UPDATE,\n    UNPAUSE\n}\n\nexport interface GetSheetsTask {\n    type: SyncerTaskType.GET_SHEETS\n    spreadsheetId: string\n}\n\nexport interface TestModeUpdateTask {\n    type: SyncerTaskType.TEST_MODE_UPDATE\n    testMode: TestMode\n}\n\nexport interface AuthUpdateTask {\n    type: SyncerTaskType.AUTH_UPDATE\n    token: string\n}\n\nexport interface DeleteRowTask {\n    type: SyncerTaskType.DELETE_ROW\n    idx: number\n    spreadsheetId: string\n    sheetId: number\n}\n\nexport interface UpdateRowTask {\n    type: SyncerTaskType.UPDATE_ROW\n    idx: number\n    spreadsheetId: string\n    sheetId: number\n    sheetTitle: string\n    content: string\n}\n\nexport interface GetRowsTask {\n    type: SyncerTaskType.GET_ROWS\n    spreadsheetId: string\n    sheetId: number\n    sheetTitle: string\n}\n\nexport interface UnpauseTask {\n    type: SyncerTaskType.UNPAUSE\n}","export type SyncerResponse = (\n    RowsResponse | SheetsResponse | QueueStateResponse | ErrorResponse | ReauthResponse\n)\n\nexport enum SyncerResponseType {\n    ROWS,\n    SHEETS,\n    QUEUE_STATE,\n    ERROR,\n    REAUTH,\n}\n\nexport interface RowsResponse {\n    type: SyncerResponseType.ROWS\n    spreadsheetId: string\n    sheetId: number\n    rows: string[]\n}\n\nexport interface SheetsResponse {\n    type: SyncerResponseType.SHEETS\n    spreadsheetId: string\n    sheets: gapi.client.sheets.Sheet[]\n}\n\nexport interface QueueStateResponse {\n    type: SyncerResponseType.QUEUE_STATE\n    length: number\n    paused: boolean\n}\n\nexport interface ErrorResponse {\n    type: SyncerResponseType.ERROR\n    error: Error\n}\n\nexport interface ReauthResponse {\n    type: SyncerResponseType.REAUTH\n}\n","import { SyncerError } from \".\"\nimport {\n    GetRowsTask, UpdateRowTask, DeleteRowTask, GapiErrorResponse, GetSheetsTask\n} from \"../../types\"\n\nexport class SyncerTasks {\n\n    public extendSheetLength = 100\n\n    public async getSheets(token: string, task: GetSheetsTask) {\n        let url = `https://sheets.googleapis.com/v4/spreadsheets/${task.spreadsheetId}`\n        let headers = { Authorization: `Bearer ${token}` }\n        let opts: RequestInit = { method: \"GET\", cache: \"no-cache\", headers: headers }\n        let response = await fetch(url, opts)\n        if (!response.ok) {\n            let error: GapiErrorResponse = await response.json()\n            throw new SyncerError(`Failed to get spreadsheet details.\\n${JSON.stringify(error)}`, response.status === 401)\n        } else {\n            let data: gapi.client.sheets.Spreadsheet = await response.json()\n            return data.sheets || []\n        }\n    }\n\n    public async getRows(token: string, task: GetRowsTask) {\n        let range = `${task.sheetTitle}!A:A`\n        let url = `https://sheets.googleapis.com/v4/spreadsheets/${task.spreadsheetId}/values/${range}`\n        let headers = { Authorization: `Bearer ${token}` }\n        let opts: RequestInit = { method: \"GET\", cache: \"no-cache\", headers: headers }\n        let response = await fetch(url, opts)\n        if (!response.ok) {\n            let error: GapiErrorResponse = await response.json()\n            throw new SyncerError(`Failed to get sheet rows.\\n${JSON.stringify(error)}`, response.status === 401)\n        } else {\n            let data: gapi.client.sheets.ValueRange = await response.json()\n            let rows: string[] = (data.values) ? data.values.map(row => row[0]) : []\n            return rows\n        }\n    }\n\n    public async updateRow(token: string, task: UpdateRowTask) {\n        let range = `${task.sheetTitle}!A${task.idx + 1}:A${task.idx + 1}`\n        let url = new URL(`https://sheets.googleapis.com/v4/spreadsheets/${task.spreadsheetId}/values/${range}`)\n        let headers = { Authorization: `Bearer ${token}` }\n        let params: Record<string, string> = { valueInputOption: \"RAW\" }\n        Object.keys(params).forEach(key => url.searchParams.append(key, params[key]))\n        let body = JSON.stringify({ range: range, majorDimension: \"ROWS\", values: [[task.content]] })\n        let opts: RequestInit = { method: \"PUT\", cache: \"no-cache\", headers: headers, body: body }\n        let response = await fetch(url.toString(), opts)\n        let data = await response.json()\n        if (!response.ok) {\n            if (data.error.message.includes(\"exceeds grid limits\")) {\n                await this.extendSheet(token, task.spreadsheetId, task.sheetId)\n                let secondResponse = await fetch(url.toString(), opts)\n                if (!secondResponse.ok) {\n                    let error: GapiErrorResponse = await response.json()\n                    throw new SyncerError(`Failed to update row:\\n${JSON.stringify(error)}`, response.status === 401)\n                } else {\n                    return\n                }\n            }\n            throw new SyncerError(`Failed to update row:\\n${JSON.stringify(data)}`, response.status === 401)\n        }\n    }\n\n    public async deleteRow(token: string, task: DeleteRowTask) {\n        let range = { sheetId: task.sheetId, startRowIndex: task.idx, endRowIndex: task.idx + 1, startColumnIndex: 0 }\n        let url = new URL(`https://sheets.googleapis.com/v4/spreadsheets/${task.spreadsheetId}:batchUpdate`)\n        let headers = { Authorization: `Bearer ${token}` }\n        let body = JSON.stringify({ requests: [{ deleteRange: { range: range, shiftDimension: \"ROWS\" } }] })\n        let opts: RequestInit = { method: \"POST\", cache: \"no-cache\", headers: headers, body: body }\n        let response = await fetch(url.toString(), opts)\n        if (!response.ok) {\n            let error: GapiErrorResponse = await response.json()\n            throw new SyncerError(`Failed to delete row.\\n${JSON.stringify(error)}`, response.status === 401)\n        }\n    }\n\n    private async extendSheet(token: string, spreadsheetId: string, sheetId: number) {\n        let url = new URL(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}:batchUpdate`)\n        let headers = { Authorization: `Bearer ${token}` }\n        let body = JSON.stringify({ requests: [{ appendDimension: { sheetId: sheetId, dimension: \"ROWS\", length: this.extendSheetLength } }] })\n        let opts: RequestInit = { method: \"POST\", mode: \"cors\", cache: \"no-cache\", headers: headers, body: body }\n        let response = await fetch(url.toString(), opts)\n        if (!response.ok) {\n            let error: GapiErrorResponse = await response.json()\n            throw new SyncerError(`Failed to extend sheet.\\n${JSON.stringify(error)}`, response.status === 401)\n        }\n    }\n\n}\n","import { SyncerError } from \".\"\nimport {\n    SyncerTask, AuthUpdateTask, SyncerTaskType, GetRowsTask, UpdateRowTask,\n    DeleteRowTask,SyncerResponse, RowsResponse, SyncerResponseType,\n    SheetsResponse, QueueStateResponse, GetSheetsTask, TestModeUpdateTask,\n    ErrorResponse, UnpauseTask, ReauthResponse\n} from \"../../types\"\n\nexport function instanceOfSyncerError(error: Error | SyncerError): error is SyncerError {\n    return \"needsReAuth\" in error\n}\n\nexport function instanceOfRowsResponse(response: SyncerResponse): response is RowsResponse {\n    return \"type\" in response && response.type === SyncerResponseType.ROWS\n}\n\nexport function instanceOfSheetsResponse(response: SyncerResponse): response is SheetsResponse {\n    return \"type\" in response && response.type === SyncerResponseType.SHEETS\n}\n\nexport function instanceOfQueueStateResponse(response: SyncerResponse): response is QueueStateResponse {\n    return \"type\" in response && response.type === SyncerResponseType.QUEUE_STATE\n}\n\nexport function instanceOfErrorResponse(response: SyncerResponse): response is ErrorResponse {\n    return \"type\" in response && response.type === SyncerResponseType.ERROR\n}\n\nexport function instanceOfReauthResponse(response: SyncerResponse): response is ReauthResponse {\n    return \"type\" in response && response.type === SyncerResponseType.REAUTH\n}\n\nexport function instanceOfGetSheetsTask(task: SyncerTask): task is GetSheetsTask {\n    return \"type\" in task && task.type === SyncerTaskType.GET_SHEETS\n}\n\nexport function instanceOfAuthUpdateTask(task: SyncerTask): task is AuthUpdateTask {\n    return \"type\" in task && task.type === SyncerTaskType.AUTH_UPDATE\n}\n\nexport function instanceOfGetRowsTask(task: SyncerTask): task is GetRowsTask {\n    return \"type\" in task && task.type === SyncerTaskType.GET_ROWS\n}\n\nexport function instanceOfUpdateRowTask(task: SyncerTask): task is UpdateRowTask {\n    return \"type\" in task && task.type === SyncerTaskType.UPDATE_ROW\n}\n\nexport function instanceOfDeleteRowTask(task: SyncerTask): task is DeleteRowTask {\n    return \"type\" in task && task.type === SyncerTaskType.DELETE_ROW\n}\n\nexport function instanceOfTestModeUpdateTask(task: SyncerTask): task is TestModeUpdateTask {\n    return \"type\" in task && task.type === SyncerTaskType.TEST_MODE_UPDATE\n}\n\nexport function instanceOfUnpauseTask(task: SyncerTask): task is UnpauseTask {\n    return \"type\" in task && task.type === SyncerTaskType.UNPAUSE\n}\n","import { SyncerError } from \".\"\nimport { \n    SyncerResponse, SyncerResponseType, GetRowsTask, GetSheetsTask\n} from \"../../types\"\n\nexport function postSheets(task: GetSheetsTask, sheets: gapi.client.sheets.Sheet[]) {\n    postResponse({\n        spreadsheetId: task.spreadsheetId,\n        sheets: sheets,\n        type: SyncerResponseType.SHEETS\n    })\n}\n\nexport function postRows(task: GetRowsTask, rows: string[]) {\n    postResponse({\n        spreadsheetId: task.spreadsheetId,\n        sheetId: task.sheetId,\n        rows: rows,\n        type: SyncerResponseType.ROWS\n    })\n}\n\nexport function postQueueState(length: number, paused: boolean) {\n    postResponse({\n        length: length,\n        paused: paused,\n        type: SyncerResponseType.QUEUE_STATE\n    })\n}\n\nexport function postError(error: Error | SyncerError) {\n    postResponse({\n        error: error,\n        type: SyncerResponseType.ERROR\n    })\n}\n\nexport function postReAuthRequest() {\n    postMessage({ type: SyncerResponseType.REAUTH })\n}\n\nfunction postResponse(response: SyncerResponse) {\n    postMessage(response)\n}\n","export * from \"./Gapi\"\nexport * from \"./syncTasks\"\n","export class MockGapi {\n    public auth2 = new MockAuth2()\n    public load(_api: string, _callback: () => void) {\n        _callback()\n    }\n}\n\nclass MockAuth2 {\n    public getAuthInstance() {\n        return new MockGoogleAuth()\n    }\n    public async init(_params: any) { }\n}\n\nclass MockCurrentUser {\n    public get() { return new MockGoogleUser() }\n}\n\nexport class MockGoogleUser {\n    public getAuthResponse() {\n        return {\n            expires_in: 9999,\n            access_token: \"faketoken\"\n        }\n    }\n    public async reloadAuthResponse() {\n        return {\n            expires_in: 9999,\n            access_token: \"faketoken\"\n        }\n    }\n}\n\nclass MockGoogleAuth {\n    public isSignedIn = new MockIsSignedIn()\n    public signOut() { }\n    public signIn() { }\n    public currentUser = new MockCurrentUser()\n}\n\nclass MockIsSignedIn {\n    public listen = (_callback: any) => { }\n    public get = () => { return true }\n}\n","import {\n    GetRowsTask, UpdateRowTask, DeleteRowTask, GetSheetsTask, TestMode\n} from \"../types\"\n\nexport class SyncerTasksMock {\n\n    public extendSheetLength = 100\n\n    constructor(private testMode: TestMode) { }\n\n    public async getSheets(_token: string, _task: GetSheetsTask) {\n        if (this.testMode === TestMode.FAIL_GET_SPREADSHEET_SHEETS) {\n            throw new Error(\"mock fail\")\n        }\n        return [{\n            \"properties\": {\n                \"sheetId\": 0,\n                \"title\": \"Sheet1\",\n                \"index\": 0,\n                \"sheetType\": \"GRID\",\n                \"gridProperties\": {\n                    \"rowCount\": 100,\n                    \"columnCount\": 26\n                }\n            }\n        },\n        {\n            \"properties\": {\n                \"sheetId\": 1,\n                \"title\": \"Sheet2\",\n                \"index\": 0,\n                \"sheetType\": \"GRID\",\n                \"gridProperties\": {\n                    \"rowCount\": 100,\n                    \"columnCount\": 26\n                }\n            }\n        }]\n    }\n\n    public async getRows(_token: string, _task: GetRowsTask) {\n        if (this.testMode === TestMode.FAIL_GET_RANGE) {\n            throw new Error(\"mock fail\")\n        } else if (this.testMode === TestMode.RETURN_ROWS) {\n            return [\"aaa\", \"bbb\", \"ccc\", \"@tag\", \"@key:value\"]\n        }\n        return []\n    }\n\n    public async updateRow(_token: string, _task: UpdateRowTask) {\n        if (this.testMode === TestMode.FAIL_UPDATE_RANGE) {\n            throw new Error(\"mock fail\")\n        }\n    }\n\n    public async deleteRow(_token: string, _task: DeleteRowTask) {\n        if (this.testMode === TestMode.FAIL_DELETE_ROW) {\n            throw new Error(\"mock fail\")\n        }\n    }\n\n}\n","import { escapeHtml } from \"../helpers\"\n\nexport class Tag {\n    public frq: number\n    public raw: string\n    public key: string\n    public flag: string\n    public clean: string\n    public cleanKey: string\n    public val: string | null\n    public cleanVal: string | null\n    public separator: string | null\n\n    constructor(raw: string, flag: string, key: string, separator: string | undefined | null, val: string | undefined | null) {\n        this.frq = 1\n        this.raw = raw\n        this.flag = flag\n        this.key = key\n        this.separator = (separator !== undefined) ? separator : null\n        this.val = (val !== undefined) ? val : null\n        this.clean = this.cleanTagString(this.raw)\n        this.cleanKey = this.cleanTagString(this.key)\n        this.cleanVal = (this.val !== null) ? this.cleanTagString(this.val) : null\n    }\n\n    public renderKey(): string {\n        return \"<span onclick=\\\"tagOnClick(event, '\"\n            + this.flag\n            + this.cleanKey\n            + ((this.separator) ? this.separator : \"\")\n            + \"')\\\" class=\\\"\"\n            + ((this.separator) ? \"tagKey\" : (this.val === null) ? \"simpleTag\" : \"roundTagVal\")\n            + \"\\\">\"\n            + this.flag\n            + this.key\n            + \"</span>\"\n    }\n\n    public renderVal(hideKeys?: boolean): string {\n        return \"<span onclick=\\\"tagOnClick(event, '\"\n            + this.flag\n            + this.cleanKey\n            + this.separator\n            + this.cleanVal?.replace(/'/, \"\\\\'\")\n            + \"')\\\" class=\\\"\"\n            + ((hideKeys) ? \"roundTagVal\" : \"tagVal\")\n            + \"\\\">\"\n            + ((hideKeys) ? \"\" : this.separator)\n            + (this.val || \"\")\n            + \"</span>\"\n    }\n\n    public render(hideKeys?: boolean): string {\n        if (this.separator) {\n            return (hideKeys) ? this.renderVal(hideKeys) : this.renderKey() + this.renderVal(hideKeys)\n        } else {\n            return this.renderKey()\n        }\n    }\n\n    private cleanTagString(str: string) {\n        str = escapeHtml(str)\n        str = (str.endsWith(\"'s\")) ? str.substring(0, str.length - 2) : str\n        str = str.toLowerCase()\n        return str\n    }\n}\n","import { TestMode } from \"../types\"\n\nexport function getTestMode(): TestMode {\n    let url = new URL(window.location.href)\n    if (url.pathname === \"/demo\") {\n        return TestMode.DEMO\n    }\n    let test = url.searchParams.get(\"test\")\n    return (test !== null && instanceOfTestMode(test)) ? test : TestMode.OFF\n\n}\n\nfunction instanceOfTestMode(str: string): str is TestMode {\n    return ((<any>Object).values(TestMode).includes(str))\n}\n","import m from \"mithril\"\nimport { journal } from \"..\"\n\nexport class FriendlyError extends Error {\n    constructor(errorMessage: string, public friendlyMessage: string) {\n        super(errorMessage)\n        journal.errors.push(friendlyMessage)\n        console.warn(errorMessage)\n        m.redraw()\n    }\n}\n","export function escapeHtml(unsafe: string): string {\n    return unsafe\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n}\n","function node_walk(node: any, func: any): void {\n    var result = func(node)\n    for (node = node.firstChild; result !== false && node; node = node.nextSibling)\n        result = node_walk(node, func)\n    return\n}\n\nexport function getCaretPosition(elem: any) {\n    var sel: any = window.getSelection()\n    var cum_length = [0, 0]\n\n    if (sel.anchorNode == elem) {\n        cum_length = [sel.anchorNode.innerText.length, sel.extentNode.innerText.length]\n    } else {\n        var nodes_to_find = [sel.anchorNode, sel.extentNode]\n        if (!elem.contains(sel.anchorNode) || !elem.contains(sel.extentNode)) {\n            return undefined\n        } else {\n            var found = [0, 0]\n            var i\n            node_walk(elem, function (node: any): void {\n                for (i = 0; i < 2; i++) {\n                    if (node == nodes_to_find[i]) {\n                        found[i] = 1\n                        if (found[i == 0 ? 1 : 0]) {\n                            return\n                        }\n                    }\n                }\n                if (node.textContent && !node.firstChild) {\n                    for (i = 0; i < 2; i++) {\n                        if (!found[i]) {\n                            cum_length[i] += node.textContent.length\n                        }\n                    }\n                }\n            })\n            cum_length[0] += sel.anchorOffset\n            cum_length[1] += sel.extentOffset\n        }\n    }\n    if (cum_length[0] <= cum_length[1]) {\n        return cum_length\n    }\n    return [cum_length[1], cum_length[0]]\n}\n\nexport function setCaretPosition(el: any, pos: any): any {\n    if (el !== null && pos !== null) {\n        for (var node of el.childNodes) {\n            if (node.nodeType == 3) {\n                if (node.length >= pos) {\n                    let range = document.createRange()\n                    let sel: any = window.getSelection()\n                    range.setStart(node, pos)\n                    range.collapse(true)\n                    sel.removeAllRanges()\n                    sel.addRange(range)\n                    return -1\n                } else {\n                    pos -= node.length\n                }\n            } else {\n                pos = setCaretPosition(node, pos)\n                if (pos == -1) {\n                    return -1\n                }\n            }\n        }\n        return pos\n    }\n}\n","export const tagPattern = /(\\@)([\\w-']+)+(:)?([\\w-'\\*]+)?/g\nexport const spreadsheetIdPattern = /\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/g\n","export function setStoredSpreadsheetId(id: string) {\n    localStorage.setItem(\"spreadsheetId\", id)\n}\nexport function getStoredSpreadsheetId(): string | undefined {\n    return localStorage.getItem(\"spreadsheetId\") || undefined\n}\n\nexport function setStoredSpreadsheetUrls(urls: string) {\n    localStorage.setItem(\"spreadsheetUrls\", urls)\n}\nexport function getStoredSpreadsheetUrls(): string | undefined {\n    return localStorage.getItem(\"spreadsheetUrls\") || undefined\n}\n\nexport function setStoredHideEntriesKeys(hide: boolean) {\n    localStorage.setItem(\"hideEntriesKeys\", (hide) ? \"1\": \"0\")\n}\nexport function getStoredHideEntriesKeys(): boolean {\n    return localStorage.getItem(\"hideEntriesKeys\") === \"1\"\n}\n\nexport function setStoredHideTagRefines(hide: boolean) {\n    localStorage.setItem(\"hideTagRefines\", (hide) ? \"1\": \"0\")\n}\nexport function getStoredHideTagRefines(): boolean {\n    return localStorage.getItem(\"hideTagRefines\") === \"1\"\n}\n\nexport function getStoredSpreadsheetSheetId(spreadsheetId: string | undefined): number | undefined {\n    let sheetId = localStorage.getItem(`${spreadsheetId}-sheetId`) || undefined\n    return (sheetId !== undefined) ? parseInt(sheetId) : undefined\n}\nexport function setStoredSpreadsheetSheetId(spreadsheetId: string, sheetId: number) {\n    localStorage.setItem(`${spreadsheetId}-sheetId`, sheetId.toString())\n}\nexport function delStoredSpreadsheetSheetId(spreadsheetId: string | undefined) {\n    localStorage.removeItem(`${spreadsheetId}-sheetId`)\n}\n","import { Tag } from \"./Tag\"\nimport { tagPattern, escapeHtml } from \"../helpers\"\n\nexport type TagsMap = Map<string, Tag>\n\ninterface TagMatch {\n    tag: Tag,\n    match: RegExpMatchArray\n}\n\nexport interface IndexedEntry {\n    idx: number,\n    entry: Entry,\n}\n\nexport class Entry {\n    public tags: TagsMap = new Map()\n    public hovered: boolean = false\n    public focused: boolean = false\n    public clean: string = \"\"\n    public tokens: string[] = []\n    public rendered: string = \"\"\n    public savedClean: string = \"\"\n    private tagMatches: TagMatch[] = []\n    public readableRendered: string = \"\"\n    private rawText: string = \"\"\n    private savedText: string = \"\"\n\n    constructor(raw?: string | undefined, saved?: string | undefined) {\n        this.raw = (raw) ? raw : \"\"\n        this.saved = (saved !== undefined) ? saved : this.raw\n    }\n\n    public get saved(): string {\n        return this.savedText\n    }\n    public set saved(str: string) {\n        this.savedText = str\n        this.savedClean = str.toLowerCase()\n        this.tags = this.getTags(this.tagMatches)\n    }\n\n    public get raw(): string {\n        return this.rawText\n    }\n    public set raw(raw: string) {\n        this.rawText = raw\n        this.clean = this.raw.toLowerCase()\n        let safe = escapeHtml(this.rawText)\n        this.tokens = this.getTokens(this.clean)\n        this.tagMatches = this.getTagMatches(safe)\n        this.rendered = this.render(safe, this.tagMatches)\n        this.readableRendered = this.render(safe, this.tagMatches, true)\n    }\n\n    private render(text: string, tagMatches: TagMatch[], hideKeys?: boolean): string {\n        for (let { tag, match } of tagMatches) {\n            let chars = text.split(\"\")\n            chars.splice(match.index!, match[0].length, tag.render(hideKeys))\n            text = chars.join(\"\")\n        }\n        return text\n    }\n\n    private getTags(tagMatches: TagMatch[]): TagsMap {\n        let tags: TagsMap = new Map()\n        for (let { tag } of tagMatches) {\n            if (tags.has(tag.clean)) {\n                tags.get(tag.clean)!.frq += 1\n            } else {\n                tags.set(tag.clean, tag)\n            }\n        }\n        return tags\n    }\n\n    private getTagMatches(text: string): TagMatch[] {\n        let tagMatches = []\n        let matchesIter = text.matchAll(tagPattern)\n        for (let match of matchesIter) {\n            let tag = new Tag(match[0], match[1], match[2], match[3], match[4])\n            tagMatches.push({ tag: tag, match: match })\n        }\n        tagMatches.sort((a, b) => (a.match.index! > b.match.index!) ? -1 : 1)\n        return tagMatches\n    }\n\n    private getTokens(text: string): string[] {\n        let tokens = text.split(\" \")\n        return tokens.filter(token => {\n            return token !== undefined && token.trim() !== \"\" && token !== \"-\"\n        })\n    }\n\n}\n","import { Entry, Tag } from \".\"\nimport { TagsMap } from \"../classes/Entry\"\nimport { syncer, journal } from \"../index\"\nimport { Spreadsheet } from \"./Spreadsheet\"\n\nexport class Sheet {\n    public id: number\n    public title: string\n    public spreadsheet: Spreadsheet\n    public entries: Entry[] = []\n\n    constructor(id: number, title: string, spreadsheet: Spreadsheet) {\n        this.id = id\n        this.title = title\n        this.spreadsheet = spreadsheet\n        spreadsheet.sheets.set(this.id, this)\n        syncer.getRows(this.spreadsheet.id, this.id, this.title)\n    }\n\n    public async load(rows: string[]) {\n        rows.map(row => this.entries.push(new Entry(row)))\n        journal.switch()\n    }\n\n    get tags(): TagsMap {\n        let tags: TagsMap = new Map()\n        for (let entry of Array.from(this.entries.values()).reverse()) {\n            for (let [key, tag] of entry.tags) {\n                if (tags.has(key)) {\n                    tags.get(key)!.frq += tag.frq\n                } else {\n                    tags.set(key, new Tag(tag.raw, tag.flag, tag.key, tag.separator, tag.val))\n                }\n            }\n        }\n        return tags\n    }\n\n}\n","import m from \"mithril\"\nimport { journal, syncer } from \"..\"\nimport { MockGoogleUser } from \"../mocks\"\nimport { FriendlyError } from \"../helpers\"\nimport { SyncerTask, SyncerTaskType, SyncerResponse, TestMode } from \"../types\"\nimport {\n    instanceOfQueueStateResponse, instanceOfRowsResponse, instanceOfSheetsResponse,\n    instanceOfErrorResponse, instanceOfReauthResponse\n} from \"../workers/sync\"\n\nexport class Syncer {\n    public worker: Worker\n    public paused: boolean = false\n    public user: gapi.auth2.GoogleUser | MockGoogleUser | null = null\n\n    constructor(testMode: TestMode) {\n        this.worker = new Worker(\"./js/syncWebWorker.js\")\n        this.updateTestMode(testMode)\n        this.worker.onmessage = (msg: MessageEvent) => this.onMessage(msg)\n    }\n\n    public updateTestMode(testMode: TestMode) {\n        this.pushSyncerTask({ testMode: testMode, type: SyncerTaskType.TEST_MODE_UPDATE })\n    }\n\n    public updateAuth(token: string) {\n        this.pushSyncerTask({ token: token, type: SyncerTaskType.AUTH_UPDATE })\n    }\n\n    public getSheets(spreadsheetId: string) {\n        this.pushSyncerTask({\n            spreadsheetId: spreadsheetId,\n            type: SyncerTaskType.GET_SHEETS\n        })\n    }\n\n    public getRows(spreadsheetId: string, sheetId: number, sheetTitle: string) {\n        this.pushSyncerTask({\n            spreadsheetId: spreadsheetId,\n            sheetId: sheetId,\n            sheetTitle: sheetTitle,\n            type: SyncerTaskType.GET_ROWS\n        })\n    }\n\n    public deleteRow(idx: number, spreadsheetId: string, sheetId: number) {\n        this.pushSyncerTask({\n            idx: idx,\n            spreadsheetId: spreadsheetId,\n            sheetId: sheetId,\n            type: SyncerTaskType.DELETE_ROW\n        })\n    }\n\n    public updateRow(idx: number, spreadsheetId: string, sheetId: number, sheetTitle: string, content: string) {\n        this.pushSyncerTask({\n            idx: idx,\n            spreadsheetId: spreadsheetId,\n            sheetId: sheetId,\n            sheetTitle: sheetTitle,\n            content: content,\n            type: SyncerTaskType.UPDATE_ROW\n        })\n    }\n\n    public unpause() {\n        this.pushSyncerTask({ type: SyncerTaskType.UNPAUSE })\n    }\n\n    private pushSyncerTask(task: SyncerTask) {\n        this.worker.postMessage(task)\n    }\n\n    private onMessage(msg: MessageEvent) {\n        let response: SyncerResponse = msg.data\n        if (instanceOfQueueStateResponse(response)) {\n            if (response.paused && !syncer.paused) {\n                syncer.paused = true\n                m.redraw()\n            } else if (!response.paused && syncer.paused) {\n                syncer.paused = false\n                m.redraw()\n            }\n            if (journal.loading !== (response.length > 0)) {\n                journal.loading = (response.length > 0)\n                m.redraw()\n            }\n        } else if (instanceOfSheetsResponse(response)) {\n            if (journal.spreadsheets.has(response.spreadsheetId)) {\n                journal.spreadsheets.get(response.spreadsheetId)!.load(response.sheets)\n            }\n        } else if (instanceOfRowsResponse(response)) {\n            if (\n                journal.spreadsheets.has(response.spreadsheetId)\n                && journal.spreadsheets.get(response.spreadsheetId)!.sheets.has(response.sheetId)\n            ) {\n                journal.spreadsheets.get(response.spreadsheetId)!.sheets.get(response.sheetId)!.load(response.rows)\n            }\n        } else if (instanceOfErrorResponse(response)) {\n            syncer.paused = true\n            new FriendlyError(response.error.message, \"Unable to sync\")\n        } else if (instanceOfReauthResponse(response)) {\n            if (syncer.user !== null) {\n                syncer.user.reloadAuthResponse().then((auth) => {\n                    syncer.updateAuth(auth.access_token)\n                }).catch((err) => {\n                    new FriendlyError(err, \"You're signed out and need to sign back in.\")\n                })\n            }\n        }\n    }\n}\n","import { journal } from \"..\"\nimport { Entry, Tag } from \".\"\nimport { SearchType } from \"../types\"\nimport { IndexedEntry } from \"../classes/Entry\"\n\ninterface Refines {\n    keys: Set<string>,\n    vals: Map<string, Tag>,\n    simpleKeys: Map<string, Tag>\n}\n\nexport class Search {\n    public barQuery: Entry = new Entry(\"\")\n    public searchType: SearchType = SearchType.NONE\n    public refinesQuery: Refines = { keys: new Set(), vals: new Map(), simpleKeys: new Map() }\n\n    get query(): Entry {\n        return new Entry([\n            this.barQuery.raw,\n            ...Array.from(this.refinesQuery.keys.values()),\n            ...Array.from(this.refinesQuery.vals.keys()),\n            ...Array.from(this.refinesQuery.simpleKeys.keys())\n        ].join(\" \"))\n    }\n\n    public reset() {\n        this.barQuery = new Entry(\"\")\n        this.refinesQuery = { keys: new Set(), vals: new Map(), simpleKeys: new Map() }\n    }\n\n    public entries(): IndexedEntry[] | null {\n        let entries: IndexedEntry[] | null = null\n        if (this.query.tokens.length === 0) {\n            this.searchType = SearchType.NONE\n        } else {\n            this.searchType = SearchType.AND\n            entries = this.search()\n            if (entries.length === 0) {\n                this.searchType = SearchType.OR\n                entries = this.search()\n            }\n        }\n        return entries\n    }\n\n    private search(): IndexedEntry[] {\n        let query = this.query\n        let entries: IndexedEntry[] = []\n        let sourceEntries = journal.spreadsheet!.sheet!.entries\n        for (let [idx, entry] of sourceEntries.entries()) {\n            switch (this.searchType) {\n                case SearchType.AND:\n                    if (query.tokens.every(token => this.match(token, entry))) {\n                        entries.push({idx: idx, entry: entry})\n                    }\n                    break\n                case SearchType.OR:\n                    if (query.tokens.some(token => this.match(token, entry))) {\n                        entries.push({idx: idx, entry: entry})\n                    }\n                    break\n            }\n        }\n        return entries\n    }\n\n    private match(token: string, entry: Entry) {\n        if (token.startsWith(\"-@\") && !token.endsWith(\":\")) {\n            return entry.tags.get(token.substring(1)) === undefined\n        } else if (token.startsWith(\"-\")) {\n            return !entry.savedClean.includes(token.substring(1))\n        } else if (token.startsWith(\"@\") && !token.endsWith(\":\")) {\n            return entry.tags.get(token) !== undefined\n        } else {\n            return entry.savedClean.includes(token)\n        }\n    }\n}\n","import m from \"mithril\"\nimport { Spreadsheet } from \".\"\nimport { search, syncer } from \"..\"\nimport {\n    spreadsheetIdPattern, getStoredHideTagRefines, getStoredHideEntriesKeys,\n    setStoredSpreadsheetId, setStoredSpreadsheetSheetId, delStoredSpreadsheetSheetId,\n    getStoredSpreadsheetId, getStoredSpreadsheetSheetId\n} from \"../helpers\"\n\nexport class Journal {\n    public errors: string[] = []\n    public loading: boolean = false\n    public isSignedIn: boolean = false\n    public entryInFocus: boolean = false\n    public hideTagRefines: boolean = false\n    public hideEntriesKeys: boolean = false\n    public spreadsheet: Spreadsheet | null = null\n    public showAddSpreadsheetTextbox: boolean = false\n    public spreadsheets: Map<string, Spreadsheet> = new Map()\n\n    constructor() { }\n\n    public async load(spreadsheetUrls: string | undefined) {\n        this.hideTagRefines = getStoredHideTagRefines()\n        this.hideEntriesKeys = getStoredHideEntriesKeys()\n        let incomingSpreadsheetIds = this.getSpreadsheetIdsFromUrls(spreadsheetUrls)\n        await this.loadNewSpreadsheets(incomingSpreadsheetIds)\n        await this.removeOldSpreadsheets(incomingSpreadsheetIds)\n        this.switch()\n    }\n\n    public unload() {\n        this.removeOldSpreadsheets([])\n        this.errors = []\n        this.loading = false\n        this.isSignedIn = false\n        this.entryInFocus = false\n        this.hideTagRefines = false\n        this.hideEntriesKeys = false\n        this.spreadsheet = null\n        this.showAddSpreadsheetTextbox = false\n        this.spreadsheets = new Map()\n    }\n\n    get isActive(): boolean {\n        return this.spreadsheet !== null && this.spreadsheet.sheet !== null && this.isSignedIn\n    }\n\n    public switch(spreadsheetId?: string | undefined, sheetId?: number | undefined) {\n        if (spreadsheetId !== undefined && sheetId !== undefined && this.spreadsheet?.id === spreadsheetId && this.spreadsheet?.sheet?.id === sheetId) {\n            return\n        }\n\n        if (spreadsheetId === undefined && sheetId === undefined) {\n            spreadsheetId = getStoredSpreadsheetId()\n            sheetId = getStoredSpreadsheetSheetId(spreadsheetId)\n        }\n\n        search.reset()\n\n        this.spreadsheet = (spreadsheetId !== undefined && this.spreadsheets.has(spreadsheetId))\n            ? this.spreadsheets.get(spreadsheetId)!\n            : Array.from(this.spreadsheets.values())[0] || null\n\n        if (this.spreadsheet !== null) {\n            setStoredSpreadsheetId(this.spreadsheet.id)\n            this.spreadsheet.sheet = (sheetId !== undefined && this.spreadsheet.sheets.has(sheetId))\n                ? this.spreadsheet.sheets.get(sheetId)!\n                : Array.from(this.spreadsheet.sheets.values())[0] || null\n\n            if (this.spreadsheet.sheet !== null) {\n                setStoredSpreadsheetSheetId(this.spreadsheet.id, this.spreadsheet.sheet.id)\n            }\n        }\n\n        m.redraw()\n    }\n\n    private async loadNewSpreadsheets(spreadsheetIds: string[]) {\n        for (let id of spreadsheetIds.filter(id => !this.spreadsheets.get(id)).sort(id => (id === getStoredSpreadsheetId() ? -1 : 1))) {\n            new Spreadsheet(id)\n        }\n    }\n\n    private async removeOldSpreadsheets(spreadsheetIds: string[]) {\n        for (let [spreadsheet_id] of Array.from(this.spreadsheets).filter(([spreadsheet_id]) => !spreadsheetIds.includes(spreadsheet_id))) {\n            delStoredSpreadsheetSheetId(spreadsheet_id)\n            if (this.spreadsheet === this.spreadsheets.get(spreadsheet_id)) {\n                this.spreadsheet = null\n            }\n            if (this.spreadsheets.has(spreadsheet_id)) {\n                for (let [id] of this.spreadsheets.get(spreadsheet_id)!.sheets) {\n                    this.spreadsheets.get(spreadsheet_id)!.sheets.delete(id)\n                }\n                this.spreadsheets.delete(spreadsheet_id)\n            }\n        }\n    }\n\n    private getSpreadsheetIdsFromUrls(urls: string | undefined): string[] {\n        if (!urls) { return [] }\n        let ids: string[] = []\n        let matches = urls.matchAll(spreadsheetIdPattern)\n        for (let match of matches) {\n            if (match) { ids.push(match[1]) }\n        }\n        return ids\n    }\n\n    public async deleteEntry(idx: number) {\n        syncer.deleteRow(idx, this.spreadsheet!.id, this.spreadsheet!.sheet!.id)\n        this.spreadsheet!.sheet!.entries.splice(idx, 1)[0]\n    }\n\n    public async saveEntry(idx: number) {\n        let entry = this.spreadsheet!.sheet!.entries[idx]\n        if (entry.raw === entry.saved) { return }\n        syncer.updateRow(idx, this.spreadsheet!.id, this.spreadsheet!.sheet!.id, this.spreadsheet!.sheet!.title, entry.raw)\n        entry.saved = entry.raw\n    }\n}\n","import { Sheet } from \".\"\nimport { journal, syncer } from \"../index\"\nimport { getStoredSpreadsheetSheetId } from \"../helpers\"\n\nexport class Spreadsheet {\n    public sheet: Sheet | null = null\n    public sheets: Map<number, Sheet> = new Map()\n\n    constructor(public id: string) {\n        journal.spreadsheets.set(id, this)\n        syncer.getSheets(id)\n    }\n\n    public async load(sheets: gapi.client.sheets.Sheet[]) {\n        for (let sheet of sheets.sort((sheet) => (sheet.properties?.sheetId === getStoredSpreadsheetSheetId(this.id)) ? -1 : 1)) {\n            if (sheet.properties !== undefined && sheet.properties.title !== undefined && sheet.properties.sheetId !== undefined) {\n                new Sheet(sheet.properties.sheetId, sheet.properties.title, this)\n            }\n        }\n    }\n}\n","import { FriendlyError } from \"../helpers\"\r\n\r\nexport class ServiceWorker {\r\n    constructor() {\r\n        if (\"serviceWorker\" in navigator) {\r\n            window.addEventListener(\"load\", async () => {\r\n                await navigator.serviceWorker.register(\"../serviceWorker.js\")\r\n            })\r\n        } else {\r\n            throw new FriendlyError(\"serviceWorker not supported\", \"Your browser is not supported.\")\r\n        }\r\n    }\r\n}\r\n","export * from \"./refines\"\nexport * from \"./errors\"\nexport * from \"./spinner\"\nexport * from \"./compose\"\nexport * from \"./entries\"\nexport * from \"./toggles\"\nexport * from \"./searchbar\"\nexport * from \"./googleAPI\"\n","import { Tag } from \"../classes\"\nimport m, { Vnode } from \"mithril\"\nimport { journal, search } from \"..\"\n\nexport function refines() {\n    const simpleTagsHeader = \"Simple Tags\"\n    const expanded: Set<string> = new Set()\n\n    function view() {\n        if (journal.hideTagRefines) { return [] }\n        return m(\"#tagsWrap\", m(\"#tags\", [\n            m(\".tempguidancePre\", \"Tags\"),\n            simpleRefinesVnodes(),\n            complexRefinesVnodes(),\n        ]))\n    }\n\n    function simpleRefinesVnodes(): Vnode {\n        const { simple } = buildRefines()\n        return m(\".tagRefineWrap\", (simple.size === 0)? [] : [\n            refineKeyVnode(simpleTagsHeader, simple.size),\n            Array.from(simple, ([key, tag]) => [\n                refineValVnode(key, tag)\n            ])\n        ])\n    }\n\n    function complexRefinesVnodes(): Vnode[] {\n        const { complex } = buildRefines()\n        return Array.from(complex, ([key, tags]) => m(\".tagRefineWrap\", [\n            refineKeyVnode(key, tags.length),\n            tags.map(tag => [refineValVnode(key, tag)])\n        ]))\n    }\n\n    function refineKeyVnode(key: string, count: number) {\n        return m(\"span\", tagRefineKeySettings(key), [\n            (key === simpleTagsHeader) ? [] : m(\"input\", { type: \"checkbox\", checked: search.refinesQuery.keys.has(key) }),\n            (expanded.has(key)) ? m(\"span\", \"▾ \") : m(\"span\", \"▿ \"),\n            m(\"span\", key),\n            m(\"span\", ` (${count})`),\n        ])\n    }\n\n    function refineValVnode(key: string, tag: Tag) {\n        return m(\"div\", { class: `tagRefineValWrap` }, [\n            m(\"span\", tagRefineValSettings(key, tag), [\n                m(\"input\", { type: \"checkbox\", checked: (tag.val === null) ? search.refinesQuery.simpleKeys.has(tag.clean) : search.refinesQuery.vals.has(tag.clean) }),\n                (tag.val !== null) ? m(\"span\", `${tag.cleanVal}`) : m(\"span\", `${tag.flag}${tag.cleanKey}`),\n                m(\"span\", ` (${tag.frq})`),\n            ]),\n        ])\n    }\n\n    function tagRefineKeySettings(key: string) {\n        return {\n            class: \"roundTagKey\",\n            onclick: (event: any) => refineTagKeyOnClick(event, key),\n        }\n    }\n\n    function tagRefineValSettings(key: string, tag: Tag) {\n        let tagClass = (tag.val === null) ? \"simpleTag\" : \"roundTagVal\"\n        let hideClass = \"hide\"\n        if (\n            (tag.val === null && expanded.has(simpleTagsHeader)) ||\n            expanded.has(key) ||\n            search.refinesQuery.vals.has(tag.clean)\n        ) {\n            hideClass = \"\"\n        }\n        return {\n            class: `${tagClass} ${hideClass}`,\n            onclick: () => refineTagValOnClick(tag),\n        }\n    }\n\n    function refineTagKeyOnClick(event: any, key: string) {\n        if (!event.metaKey && !event.ctrlKey) {\n            expanded.has(key) ? expanded.delete(key) : expanded.add(key)\n        } else {\n            if (key === simpleTagsHeader) { return }\n            search.refinesQuery.keys.has(key)\n                ? search.refinesQuery.keys.delete(key)\n                : search.refinesQuery.keys.add(key)\n        }\n    }\n\n    function refineTagValOnClick(tag: Tag) {\n        if (tag.val === null) {\n            search.refinesQuery.simpleKeys.has(tag.clean)\n                ? search.refinesQuery.simpleKeys.delete(tag.clean)\n                : search.refinesQuery.simpleKeys.set(tag.clean, tag)\n        } else {\n            search.refinesQuery.vals.has(tag.clean)\n                ? search.refinesQuery.vals.delete(tag.clean)\n                : search.refinesQuery.vals.set(tag.clean, tag)\n        }\n    }\n\n    function buildRefines() {\n        let simpleRefines: Map<string, Tag> = new Map()\n        let complexRefines: Map<string, Tag[]> = new Map()\n\n        for (let tag of journal.spreadsheet!.sheet!.tags.values()) {\n            if (tag.val === null) {\n                let key = `${tag.flag}${tag.cleanKey}`\n                if (!simpleRefines.has(key)) {\n                    simpleRefines.set(key, tag)\n                }\n            } else {\n                let key = `${tag.flag}${tag.cleanKey}${tag.separator}`\n                if (!complexRefines.has(key)) { complexRefines.set(key, []) }\n                complexRefines.get(key)!.push(tag)\n            }\n        }\n\n        // Clean stale simple tag key (refine val) selections\n        for (let [key,] of search.refinesQuery.simpleKeys) {\n            if (!simpleRefines.has(key)) {\n                search.refinesQuery.simpleKeys.delete(key)\n            }\n        }\n\n        // Clean stale complex tag key selections\n        for (let key of search.refinesQuery.keys) {\n            if (!complexRefines.has(key)) {\n                search.refinesQuery.keys.delete(key)\n            }\n        }\n\n        // Clean stale complex tag val\n        for (let [key,] of search.refinesQuery.vals) {\n            if (!Array.from(complexRefines.values()).some(tags => tags.some(tag => tag.clean === key))) {\n                search.refinesQuery.vals.delete(key)\n            }\n        }\n\n        return {\n            simple: new Map([...simpleRefines.entries()]),\n            complex: new Map([...complexRefines.entries()].sort())\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\nimport { journal } from \"..\"\n\nexport function errors() {\n\n    function view() {\n        if (journal.errors.length === 0) { return [] }\n        return m(\"#errors\", journal.errors.map((error, idx) => [\n            m(\".error\", [\n                m(\"span\", error),\n                m(\"button\", errorDismissButtonSettings(idx), \"dismiss\"),\n            ])\n        ]))\n    }\n\n    function errorDismissButtonSettings(idx: number) {\n        return {\n            class: \"dismissErrorButton\",\n            onclick: () => journal.errors.splice(idx, 1),\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\nimport { journal, syncer } from \"..\"\n\nexport function spinner() {\n\n    function view() {\n        return m(\"#spinner\", [spinnerVnode(), unpauseVnode()])\n    }\n\n    function spinnerVnode() {\n        if (journal.loading && !syncer.paused) {\n            return m(\".spinner\", [m(\"div\"), m(\"div\"), m(\"div\"), m(\"div\")])\n        }\n        return\n    }\n\n    function unpauseVnode() {\n        if (syncer.paused) {\n            return m(\"button\", {\n                id: \"unpauseSync\",\n                onclick: () => syncer.unpause(),\n            }, \"Unpause Syncing\")\n        }\n        return\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\nimport { journal } from \"..\"\nimport { Caret } from \"../types\"\nimport { Entry } from \"../classes\"\nimport { getCaretPosition, setCaretPosition } from \"../helpers\"\n\nexport function compose() {\n    var caret: Caret = { el: null, pos: null }\n\n    const composePrefix = new Entry(\"\")\n    const composeContent = new Entry(\"\")\n    const composeSuffix = new Entry(\"\")\n\n    const prefixSettings = { \"placeholder\": \"Static Entry Prefix\" }\n    const entrySettings = { \"placeholder\": \"Entry Content\" }\n    const suffixSettings = { \"placeholder\": \"Static Entry Suffix\" }\n\n    function view() {\n        return m(\"#compose\", [\n            m(\"#prefix\", composeNodeSettings(composePrefix, prefixSettings), m.trust(composePrefix.rendered)),\n            m(\"#content\", composeNodeSettings(composeContent, entrySettings), m.trust(composeContent.rendered)),\n            m(\"#suffix\", composeNodeSettings(composeSuffix, suffixSettings), m.trust(composeSuffix.rendered)),\n        ])\n    }\n\n    function getComposedEntry() {\n        let els = [\n            document.getElementById(\"prefix\"),\n            document.getElementById(\"content\"),\n            document.getElementById(\"suffix\"),\n        ]\n        return els.map(el => el!.innerText).join(\"\")\n    }\n\n    function composeNodeSettings(entry: Entry, extraSettings: object) {\n        let baseSettings = {\n            contenteditable: \"true\",\n            class: \"entry breakwrap column\",\n            onkeydown: async (event: any) => await composeKeydown(event),\n            oninput: (event: any) => composeInput(event, entry),\n            onupdate: () => composeUpdate(),\n        }\n        return Object.assign(baseSettings, extraSettings)\n    }\n\n    async function composeKeydown(event: any) {\n        if (event.keyCode == 13 && !event.shiftKey) {\n            event.preventDefault()\n            let raw = getComposedEntry()\n            composeContent.raw = \"\"\n            let newEntry = new Entry(raw, \"\")\n            let idx = journal.spreadsheet!.sheet!.entries.length\n            journal.spreadsheet!.sheet!.entries.push(newEntry)\n            m.redraw()\n            await journal.saveEntry(idx)\n            m.redraw()\n        }\n    }\n\n    function composeInput(event: any, entry: Entry) {\n        let pos = getCaretPosition(event.target)\n        caret = (pos)\n            ? { pos: pos[1], el: event.target }\n            : { pos: null, el: null }\n        entry.raw = event.target.innerText\n    }\n\n    function composeUpdate() {\n        setCaretPosition(caret.el, caret.pos)\n        caret = { el: null, pos: null }\n    }\n\n    return { view: view }\n}\n","import { Caret } from \"../types\"\nimport m, { Vnode } from \"mithril\"\nimport { Entry } from \"../classes\"\nimport { journal, search } from \"..\"\nimport { getCaretPosition, setCaretPosition } from \"../helpers\"\n\nexport function entries() {\n    var caret: Caret = { pos: null, el: null }\n\n    function view() {\n        return m(\"#entries\", [\n            m(\".tempguidancePre\", \"Entries\"),\n            entriesVnodes(),\n        ])\n    }\n\n    function entriesVnodes() {\n        let searchEntries = search.entries()\n        if (searchEntries !== null) {\n            return searchEntries.map(({idx, entry}) => entryVnode(idx, entry))\n        }\n\n        let allEntries = Array.from(journal.spreadsheet!.sheet!.entries.entries())\n        return allEntries.map(([idx, entry]) => entryVnode(idx, entry))\n    }\n\n    function entryVnode(idx: number, entry: Entry): Vnode {\n        return m(\".entryWrap\", { id: `entry-${idx}` }, [\n            entryContent(entry, idx),\n            deleteEntryButton(idx),\n        ])\n    }\n\n    function deleteEntryButton(idx: number) {\n        return m(\"button\", {\n            class: \"del\",\n            onclick: async () => {\n                await journal.deleteEntry(idx)\n                m.redraw()\n            }\n        }, \"del\")\n    }\n\n    function entryContent(entry: Entry, idx: number) {\n        return m(\"div\", entryContentSettings(entry, idx), m.trust(\n            (!entry.hovered && !entry.focused && journal.hideEntriesKeys)\n                ? entry.readableRendered\n                : entry.rendered\n        ))\n    }\n\n    function onEntryKeydown(event: any) {\n        if (event.keyCode == 13 && !event.shiftKey) {\n            event.preventDefault()\n            event.target.blur()\n        }\n    }\n\n    function onEntryInput(event: any, entry: Entry) {\n        let pos = getCaretPosition(event.target)\n        caret = { pos: (pos) ? pos[1] : null, el: event.target }\n        entry.raw = event.target.innerText\n    }\n\n    function onEntryUpdate() {\n        setCaretPosition(caret.el, caret.pos)\n        caret = { pos: null, el: null }\n    }\n\n    function onEntryFocus(entry: Entry) {\n        entry.focused = true\n    }\n\n    async function onEntryBlur(entry: Entry, idx: number) {\n        entry.focused = false\n        await journal.saveEntry(idx)\n        m.redraw()\n    }\n\n    function onEntryMouseover(entry: Entry) {\n        entry.hovered = true\n    }\n\n    function onEntryMouseout(entry: Entry) {\n        entry.hovered = false\n    }\n\n    function entryContentSettings(entry: Entry, idx: number) {\n        return {\n            id: `entry-${idx}-content`,\n            contenteditable: \"true\",\n            class: \"entry breakwrap column\",\n            onkeydown: (event: any) => onEntryKeydown(event),\n            oninput: (event: any) => onEntryInput(event, entry),\n            onupdate: () => onEntryUpdate(),\n            onblur: () => onEntryBlur(entry, idx),\n            onmouseover: () => onEntryMouseover(entry),\n            onmouseout: () => onEntryMouseout(entry),\n            onfocus: () => onEntryFocus(entry),\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\r\nimport { journal } from \"..\"\r\nimport {\r\n    getStoredHideEntriesKeys, setStoredHideEntriesKeys, setStoredHideTagRefines\r\n} from \"../helpers\"\r\n\r\nexport function toggles() {\r\n\r\n    function view() {\r\n        return [\r\n            m(\"#hideEntriesKeysToggle\", [\r\n                m(\"label\", { for: \"hideEntriesCheckbox\" }, \"Tag keys:\"),\r\n                m(\"input#hideEntriesCheckbox\", hideEntriesKeysSettings())\r\n            ]),\r\n            m(\"#hideTagRefinesToggle\", [\r\n                m(\"label\", { for: \"hideTagRefinesCheckbox\" }, \"Tag refines:\"),\r\n                m(\"input#hideTagRefinesCheckbox\", hideTagRefinesSettings())\r\n            ])\r\n        ]\r\n    }\r\n\r\n    function hideEntriesKeysSettings() {\r\n        return {\r\n            type: \"checkbox\",\r\n            checked: !getStoredHideEntriesKeys(),\r\n            disabled: (journal.entryInFocus),\r\n            onclick: () => {\r\n                journal.hideEntriesKeys = !journal.hideEntriesKeys\r\n                setStoredHideEntriesKeys(journal.hideEntriesKeys)\r\n            }\r\n        }\r\n    }\r\n\r\n    function hideTagRefinesSettings() {\r\n        return {\r\n            type: \"checkbox\",\r\n            checked: !journal.hideTagRefines,\r\n            onclick: () => {\r\n                journal.hideTagRefines = !journal.hideTagRefines\r\n                setStoredHideTagRefines(journal.hideTagRefines)\r\n            }\r\n        }\r\n    }\r\n\r\n    return { view: view }\r\n}\r\n","import m from \"mithril\"\nimport { search } from \"..\"\nimport { Caret } from \"../types\"\nimport { getCaretPosition, setCaretPosition, escapeHtml } from \"../helpers\"\n\nexport function searchbar() {\n    var caret: Caret = { el: null, pos: null }\n\n    function view() {\n        return m(\"#search\", [\n            m(\"#searchQuery\", searchNodeSettings(), m.trust(search.barQuery.rendered)),\n            m(\"button\", clearSearchNodeSettings(), \"x\")\n        ])\n    }\n\n    function searchNodeSettings() {\n        return {\n            placeholder: \"Search for text or tags\",\n            contenteditable: \"true\",\n            class: `entry breakwrap`,\n            oninput: (event: any) => onSearchInput(event),\n            onupdate: () => onSearchUpdate(),\n            onkeydown: (event: any) => onSearchKeydown(event)\n        }\n    }\n\n    function onSearchInput(event: any) {\n        let pos = getCaretPosition(event.target)\n        caret = (pos) ? { pos: pos[1], el: event.target } : { pos: null, el: null }\n        search.barQuery.raw = escapeHtml(event.target.innerText)\n    }\n\n    function onSearchUpdate() {\n        setCaretPosition(caret.el, caret.pos)\n        caret = { el: null, pos: null }\n    }\n\n    function onSearchKeydown(event: any) {\n        if (event.keyCode == 13 && !event.shiftKey) {\n            event.preventDefault()\n            event.target.blur()\n        }\n    }\n\n    function clearSearchNodeSettings() {\n        return {\n            id: \"clearSearch\",\n            class: \"del\",\n            onclick: () => search.barQuery.raw = \"\"\n        }\n    }\n\n    return { view: view }\n}\n","import m from \"mithril\"\r\nimport { MockGapi } from \"../mocks\"\r\nimport { TestMode } from \"../types\"\r\nimport { journal, testMode, syncer } from \"..\"\r\nimport {\r\n    getStoredSpreadsheetUrls, getStoredSpreadsheetSheetId, setStoredSpreadsheetUrls\r\n} from \"../helpers\"\r\n\r\nconst scope = [\"https://www.googleapis.com/auth/spreadsheets\"].join(\" \")\r\nconst clientId = \"893904323330-moo1k9s19qp40kr747pftdo29ejdef0o.apps.googleusercontent.com\"\r\n\r\nexport function googleAPI() {\r\n    var gapi_: MockGapi | typeof gapi\r\n\r\n    function gapiScriptSettings() {\r\n        return {\r\n            async: true, defer: true, src: \"https://apis.google.com/js/api.js\",\r\n            onload: () => {\r\n                gapi_ = (testMode === TestMode.OFF) ? gapi : new MockGapi()\r\n                gapi_.load('auth2', initClient)\r\n            }\r\n        }\r\n    }\r\n\r\n    function initClient() {\r\n        gapi_.auth2.init({\r\n            scope: scope,\r\n            client_id: clientId\r\n        }).then(() => {\r\n            gapi_.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus)\r\n            updateSigninStatus(gapi_.auth2.getAuthInstance().isSignedIn.get())\r\n        })\r\n    }\r\n\r\n    async function updateSigninStatus(signedIn: boolean) {\r\n        journal.isSignedIn = signedIn\r\n        m.redraw()\r\n        if (journal.isSignedIn) {\r\n            let user = gapi_.auth2.getAuthInstance().currentUser.get()\r\n            syncer.user = user\r\n            let auth = user.getAuthResponse()\r\n            syncer.updateAuth(auth.access_token)\r\n            await initJournal()\r\n        } else {\r\n            journal.unload()\r\n        }\r\n    }\r\n\r\n    async function initJournal() {\r\n        let spreadsheetUrls = getStoredSpreadsheetUrls()\r\n        await journal.load(spreadsheetUrls)\r\n    }\r\n\r\n    function view() {\r\n        if (testMode === TestMode.DEMO) {\r\n            journal.isSignedIn = true\r\n            journal.load(\"https://docs.google.com/spreadsheets/d/demo/edit\")\r\n            return []\r\n        } else {\r\n            return m(\"#googleApi\", [\r\n                (journal.showAddSpreadsheetTextbox) ? [spreadsheetsTextbox(), m(\"br\")] : [],\r\n                (journal.isSignedIn) ? addSpreadsheetButton() : [],\r\n                (journal.spreadsheet !== null) ? spreadsheetsSelect() : [],\r\n                (journal.isActive) ? sheetsSelect() : [],\r\n                signInOutButton(),\r\n                m(\"script\", gapiScriptSettings()),\r\n            ])\r\n        }\r\n    }\r\n\r\n    function signInOutButton() {\r\n        return (journal.isSignedIn)\r\n            ? m(\"button\", {\r\n                onclick: () => {\r\n                    if (testMode === TestMode.RETURN_ROWS) { journal.unload() }\r\n                    gapi_.auth2.getAuthInstance().signOut()\r\n                }, class: \"authButton\"\r\n            }, \"Sign Out\")\r\n            : m(\"button\", { onclick: () => gapi_.auth2.getAuthInstance().signIn(), class: \"authButton\" }, \"Sign In\")\r\n    }\r\n\r\n    function addSpreadsheetButton() {\r\n        return m(\"button\", {\r\n            id: \"addSpreadsheet\",\r\n            onclick: async () => {\r\n                journal.showAddSpreadsheetTextbox = !journal.showAddSpreadsheetTextbox\r\n                if (!journal.showAddSpreadsheetTextbox) {\r\n                    let spreadsheetUrls = getStoredSpreadsheetUrls()\r\n                    await journal.load(spreadsheetUrls)\r\n                }\r\n            },\r\n        }, (journal.showAddSpreadsheetTextbox) ? \" ✓ \" : \"+/-\")\r\n    }\r\n\r\n    function spreadsheetsTextbox() {\r\n        return m(\"textarea\", {\r\n            id: \"spreadsheetURLs\",\r\n            placeholder: \"Enter list of Google Sheets Spreadsheet URLs here\",\r\n            value: getStoredSpreadsheetUrls(),\r\n            oninput: (event: any) => setStoredSpreadsheetUrls(event.target.value),\r\n        })\r\n    }\r\n\r\n    function spreadsheetsSelect() {\r\n        return m(\"select\", {\r\n            onchange: (event: any) => {\r\n                let id = event.target.value\r\n                journal.switch(id, getStoredSpreadsheetSheetId(id))\r\n            },\r\n            id: \"spreadsheetSelect\",\r\n        }, [\r\n            Array.from(journal.spreadsheets).map(([id]) => [\r\n                m(\"option\", {\r\n                    value: id,\r\n                    selected: journal.spreadsheet!.id === id\r\n                }, id.substr(id.length - 6))\r\n            ])\r\n        ])\r\n    }\r\n\r\n    function sheetsSelect() {\r\n        return m(\"select\", {\r\n            onchange: (event: any) => {\r\n                journal.switch(journal.spreadsheet!.id, parseInt(event.target.value))\r\n                m.redraw()\r\n            },\r\n            id: \"sheetSelect\",\r\n        }, [\r\n            Array.from(journal.spreadsheet!.sheets).map(([id, sheet]) => [\r\n                m(\"option\", {\r\n                    value: id,\r\n                    selected: journal.isActive && journal.spreadsheet!.sheet!.id === id\r\n                }, sheet.title)\r\n            ])\r\n        ])\r\n    }\r\n\r\n    return { view: view }\r\n}\r\n"],"sourceRoot":""}